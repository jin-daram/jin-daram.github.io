{"componentChunkName":"component---src-templates-post-jsx","path":"/redis-sentinel/","result":{"data":{"site":{"siteMetadata":{"title":"Let's solve it"}},"markdownRemark":{"id":"d1f5a049-8286-5c64-930b-e22cdf15c246","excerpt":"은  의 고가용성 (High Availabiliity)를 보장하기 위한 시스템입니다. 많은 요청을 처리해야 하는 서비스에서 만약 한 대의 Redis만 사용한다면 과도한 부하로 인해 장애가 발생했을 때, Redis에 의존하는 서비스들은 정상적으로 운영하기 어렵고, 성능이 대폭 감소할 수 있습니다.  고가용성이란?\n고가용성 (HA, High Availabil…","html":"<p><code class=\"language-text\">Redis Sentinel</code> 은 <code class=\"language-text\">Redis</code> 의 <strong>고가용성 (High Availabiliity)</strong>를 보장하기 위한 시스템입니다.</p>\n<p>많은 요청을 처리해야 하는 서비스에서 만약 한 대의 Redis만 사용한다면 과도한 부하로 인해 장애가 발생했을 때, Redis에 의존하는 서비스들은 정상적으로 운영하기 어렵고, 성능이 대폭 감소할 수 있습니다. </p>\n<blockquote>\n<p><strong>고가용성이란?<br></strong>\n고가용성 (HA, High Availability) 란? 쉽게 말해서 어떠한 서버나 시스템이 오랫 동안 정상 운영이 가능한 정도를 이야기 합니다. 장애가 발생하더라도, 이를 빠른 시간 안에 복구하고, 정상적인 서비스를 운영하여 서비스 신뢰성을 복구한다면 고가용성이 높다라고 말할 수 있습니다.</p>\n<p>고가용성을 높이는 방법과 전략에는 여러가지가 있지만, 본 포스트에서는 <code class=\"language-text\">Redis-Sentinel</code> 을 중심적으로 설명하겠습니다.</p>\n</blockquote>\n<h2 id=\"Redis-Sentinel\" style=\"position:relative;\"><a href=\"#Redis-Sentinel\" aria-label=\"Redis Sentinel permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Redis-Sentinel</h2>\n<hr>\n<p>Redis Sentinel 은 앞서 말했듯이 Redis의 고가용성을 보장하기 위한 시스템입니다. 분산 환경에서는 Redis가 여러 노드에 걸쳐 동작됩니다. 모니터링을 통해 <code class=\"language-text\">master</code> 및 <code class=\"language-text\">replica</code> 가 정상적으로 동작하는지 확인하고, 자동으로 장애를 복구할 수 있는 기능을 제공합니다.</p>\n<p>보통의 Sentinel은 3개 이상의 인스턴스를 구성합니다. 이렇게 구성하면 합의를 통해 장애 여부를 판단할 수 있어 더욱 더 안정적인 시스템을 구성할 수 있습니다.</p>\n<h3 id=\"주요-개념\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9A%94-%EA%B0%9C%EB%85%90\" aria-label=\"주요 개념 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>주요 개념</h3>\n<hr>\n<p><strong>Quorum</strong> <br>\nQuorum(합의) 이란 각각의 Sentinel 들이 master 가 죽었다고 판단할 때 <code class=\"language-text\">필요한 최소한의 합의 수</code> 입니다.\n만약 <code class=\"language-text\">Quorum = 3</code> 이라면, 최소 3개의 Sentinel 이 <code class=\"language-text\">master</code> 가 죽었다고 판단해야 장애 복구가 시작 됩니다.</p>\n<p><strong>Failover</strong> <br>\nFailover 란 시스템에 한 구성 요소에 장애가 발생했을 때, 즉시 다른 예비 시스템으로 대체하여 서비스를 계속해서 지속하는 기능입니다. Redis Sentinel 에서는 master 에 장애가 발생하였을 때, 여러 replica 인스턴스 중 1개를 master를 승격 시키는 것을 의미합니다.</p>\n<h3 id=\"What-is-Sentinel\" style=\"position:relative;\"><a href=\"#What-is-Sentinel\" aria-label=\"What is Sentinel permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>What is Sentinel?</h3>\n<hr>\n<p>1개의 Redis 인스턴스만을 사용한다면, 해당 Redis에 부하가 생겨 장애가 발생했을 때, Redis에 의존하는 서비스들은 정상적으로 운영하기 어렵고, 성능이 대폭 감소할 우려가 있습니다. </p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/86496f216a26e2a7e3c0d8546994ccf0/bbbf7/redis-master-slave.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqElEQVR42n1STS8DQRjuHxK/wFEcJA70LMQPaELCzQ+QHpwcSFwdOeDQINRBfLXFso1abD827XY/Zmd3ZvZjZnhXm2gFz+mdmfd5nvdjMh8DSIQ4fdL2S0/nqgbB8cPziVK7rOlHynNR1UpvTSHlYH5m8CClrBrmlVZXW51qyyzrRqXRqbUttdm5eW2ozbb8hwwQnIskYSQQABokbaNHkJxLIaIo+p0MyYwxDhRCuo5r63phanJ3dKSys2O4rmPZlmW5rjtoPuRMKfU8LwxDLmTC2NnSYmF+zlAUTAgoAvlPZwBjIcYeQsjHPkgEjJm2zTmHGHTjJBag+tMZzqJ/ixFGjkOIb1s2BI6VglLfMk0SUBCK43iIzNMlpcxmDW0sX68vXKglnVC/lxEQ/KK0tlfv12aL749O6iX65hloRtnavM3nYca6inJjBysThWqlzkISRTE04hNPLdeXxwu5sUPtvguThRJ7ZWaw5+1lZ3az09BrWrbLiB9ynsAzFAkTgi3APfEjjEi6soRLLvrOkIQ86BTLnuCXpBDix3/4/kg0CO7KDgIG/gREoWNn3XsudQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='Redis Master-Replica' title='' src='/static/86496f216a26e2a7e3c0d8546994ccf0/ca1dc/redis-master-slave.png' srcset='/static/86496f216a26e2a7e3c0d8546994ccf0/e7570/redis-master-slave.png 170w,\n/static/86496f216a26e2a7e3c0d8546994ccf0/f46e7/redis-master-slave.png 340w,\n/static/86496f216a26e2a7e3c0d8546994ccf0/ca1dc/redis-master-slave.png 680w,\n/static/86496f216a26e2a7e3c0d8546994ccf0/02d09/redis-master-slave.png 1020w,\n/static/86496f216a26e2a7e3c0d8546994ccf0/bbbf7/redis-master-slave.png 1280w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>Redis Master-Replica</figcaption>\n  </figure></p>\n<p>이를 해결하기 <code class=\"language-text\">Master-Replica</code> 구조로 Redis 환경을 구성하는데요, 이는 <code class=\"language-text\">Master Redis Instance</code> 를 통해 데이터를 쓰고, 다수의 <code class=\"language-text\">Replica Redis 인스턴스</code>에서 데이터를 읽는 구조인 것 입니다. 상대적으로 읽기 처리를 해야 하는 서비스가 많기 때문에 읽기 전용 <code class=\"language-text\">Replica Redis 인스턴스</code> 를 늘리는 구조입니다.</p>\n<p>데이터가 여러 인스턴스에 복제되어 있어, 읽기 요청 처리를 분산 시킬 수 있어 부하를 줄일 수 있다는 장점이 있습니다.</p>\n<p>그런데 만약 이러한 구조에서 <code class=\"language-text\">Master Redis Instance</code> 에 문제가 생기면 어떻게 될까요?</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/53c34ea4bce50be889c11e42b2574e88/ec6be/net-connected.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 10.588235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdElEQVR42lWNWxKCMAxF2Y2OVqRNS5sALTII7n9D15g/P87kOfd0T5pAZUXIDZFfkPZBnt9IvBlDXPDwgj6IVoYbivaMWz/i6iIud/qj+z3laQfXQ4N2DTwh9URZDpWshh8bkmx2J51J5UF3PlUTGTTDecEXgOVBcg2i1yUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='net connected' title='' src='/static/53c34ea4bce50be889c11e42b2574e88/ca1dc/net-connected.png' srcset='/static/53c34ea4bce50be889c11e42b2574e88/e7570/net-connected.png 170w,\n/static/53c34ea4bce50be889c11e42b2574e88/f46e7/net-connected.png 340w,\n/static/53c34ea4bce50be889c11e42b2574e88/ca1dc/net-connected.png 680w,\n/static/53c34ea4bce50be889c11e42b2574e88/02d09/net-connected.png 1020w,\n/static/53c34ea4bce50be889c11e42b2574e88/9d567/net-connected.png 1360w,\n/static/53c34ea4bce50be889c11e42b2574e88/ec6be/net-connected.png 2352w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>Application 운영 도중 <code class=\"language-text\">Master Redis Instance</code> 에 장에가 발생하면 위와 같이 Connection 끊깁니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/da27ebc45a1d47496a8769dfb0a8b74b/8badf/reconnecting.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 4.117647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAASklEQVR42h2KUQ6AIAzFPI8KBjYYOhA03v9Kz+lHk6bplPYL+bhBUkGxI+QTX/PcsEiHM1/LgKsPZlKE1MDWSMb/cTHMfVRspHgBIf4g9ocRU7MAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='reconnecting' title='' src='/static/da27ebc45a1d47496a8769dfb0a8b74b/ca1dc/reconnecting.png' srcset='/static/da27ebc45a1d47496a8769dfb0a8b74b/e7570/reconnecting.png 170w,\n/static/da27ebc45a1d47496a8769dfb0a8b74b/f46e7/reconnecting.png 340w,\n/static/da27ebc45a1d47496a8769dfb0a8b74b/ca1dc/reconnecting.png 680w,\n/static/da27ebc45a1d47496a8769dfb0a8b74b/02d09/reconnecting.png 1020w,\n/static/da27ebc45a1d47496a8769dfb0a8b74b/9d567/reconnecting.png 1360w,\n/static/da27ebc45a1d47496a8769dfb0a8b74b/8badf/reconnecting.png 2750w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이후, <code class=\"language-text\">Master Redis Instance</code> 가 정상적으로 동적하게 되면 재연결하여 이전처럼 정상적으로 Redis를 사용할 수 있게됩니다. </p>\n<p>하지만 이렇게 <code class=\"language-text\">Master Redis Instance</code> 에 장애가 생기면 사람이 직접 장애를 복구해야 하고, 이로 인해 긴 시간 동안 Redis를 사용 하지 못하면서 DB에 부하가 생겨 **전체 시스템에 장애가 전파될 수도 있습니다. **</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/4d816936d6794f5104f555abd4715bd1/e5adc/problem-ocurred.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 34.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABOElEQVR42k2QS0vDQBSF8/9x69JV68KdSrHQRdFaS20lVaFIH0aF5v2YvCbJJJO5HqMFz2L47nDPfWnUSTZ1GvhlnnKepUmcpmme52EYMsYACJMkybIMEMcxHaUJRRbj66RYecmHkDbj8qdWU1UVnPAAmqZBKqAoClTknIPbttX2kgazze39S7+gyejxUv+yFWVRaDtO1MlxHFQRQgB83wcHQQAuy1J756qf0PVwujw5vZqte4zsSmUxOxxMXddXq5VlWRgVqfDsdrv5fI7X8zxMoe0LOvdpOJhMzy5uxnovIEvAHJmW9dzJNM1fM9oahrFYLLbb7Z/5U9Lo4W283PQE3U1eh0+GS5SxyHVd1gkAc13XADQHY20w1tZaRWFZ21J5QjlNy8paEbVSIlschdvgYP9/wET0DeUSgSxwtgBrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='Master Redis Instance에 장애가 발생한 상황' title='' src='/static/4d816936d6794f5104f555abd4715bd1/ca1dc/problem-ocurred.png' srcset='/static/4d816936d6794f5104f555abd4715bd1/e7570/problem-ocurred.png 170w,\n/static/4d816936d6794f5104f555abd4715bd1/f46e7/problem-ocurred.png 340w,\n/static/4d816936d6794f5104f555abd4715bd1/ca1dc/problem-ocurred.png 680w,\n/static/4d816936d6794f5104f555abd4715bd1/e5adc/problem-ocurred.png 826w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>Master Redis Instance에 장애가 발생한 상황</figcaption>\n  </figure></p>\n<p>하지만 여전히 <code class=\"language-text\">Replica</code> 는 정상적으로 운영이 가능합니다. <code class=\"language-text\">Redis-Sentinel</code> 은 바로 이 여분의 Replica를 Master로 승격시켜, 장애를 복구하는 시스템을 의미합니다. </p>\n<p>하지만 <code class=\"language-text\">Master Redis Instance</code> 에 장애가 발생했다고 어떻게 판단할까요? 그것을 판단하는 것이 바로 <code class=\"language-text\">Sentinel</code> 이란 존재입니다.</p>\n<h3 id=\"Sentinel의-역할\" style=\"position:relative;\"><a href=\"#Sentinel%EC%9D%98-%EC%97%AD%ED%95%A0\" aria-label=\"Sentinel의 역할 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Sentinel의 역할</h3>\n<hr>\n<ul>\n<li><code class=\"language-text\">모니터링</code></li>\n<li><code class=\"language-text\">자동 장애 조치</code></li>\n<li><code class=\"language-text\">알림</code></li>\n</ul>\n<p><code class=\"language-text\">Sentinel</code> 은 대략적으로 위와 같은 역할을 합니다. </p>\n<p><code class=\"language-text\">Master Instance</code>와 <code class=\"language-text\">Replica Instance</code> 를 주기적으로 모니터링하여 장애가 발생했는지 확인합니다. </p>\n<p>이에 <code class=\"language-text\">Master Redis Instance</code> 가 응답하지 않으면 <code class=\"language-text\">주관적 다운</code> 상태로 판단합니다.\n또한 <code class=\"language-text\">Master Redis Instance</code> 가 여러 <code class=\"language-text\">Sentinel</code> 등에 다운됐다고 판단되면 <code class=\"language-text\">Quorum</code> 을 통해 <code class=\"language-text\">객관적 다운</code> 상태로 판단하여, 여러 <code class=\"language-text\">Replica</code> 중 하나를 <code class=\"language-text\">Master</code> 로 승격합니다. </p>\n<p>그리고 나머지 <code class=\"language-text\">Replica</code> 들은 새롭게 승격된 <code class=\"language-text\">Master</code> 를 바라보게 만듭니다. 이 외에도 장애 및 복구와 같은 이벤트가 있을 때, 사용자가 설정한 것을 토대로 알림을 전송해주기도 합니다.</p>\n<h3 id=\"몇-대의-Sentinel이-필요할까\" style=\"position:relative;\"><a href=\"#%EB%AA%87-%EB%8C%80%EC%9D%98-Sentinel%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%A0%EA%B9%8C\" aria-label=\"몇 대의 Sentinel이 필요할까 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>몇 대의 Sentinel이 필요할까?</h3>\n<p>앞서, <code class=\"language-text\">Sentinel</code> 은 여러 <code class=\"language-text\">Sentinel</code> 들에 의해 <code class=\"language-text\">Master</code> 가 다운된 것을 합의한다고 했습니다.\n하지만 <code class=\"language-text\">단일 Sentinel</code> 을 운용하고 만약 그 <code class=\"language-text\">Sentinel</code> 에 네트워크 문제가 발생했다면\n이를 <code class=\"language-text\">Master</code>의 주관적 다운이라고 판단하고 이는 <code class=\"language-text\">단일 Sentinel</code> 이기 때문에 객관적 다운으로 이어집니다. </p>\n<p>그렇게 되면 실제로 장애가 발생하지 않았는데도, <code class=\"language-text\">Replica</code>를 <code class=\"language-text\">Master</code>로 승격시켜버리는 문제가 발생합니다. 이에 Sentinel 은 <code class=\"language-text\">최소 3대</code> 가 존재해야 이를 객관적으로 <code class=\"language-text\">Master</code> 가 다운됐다고 판단할 수 있기에 과반이 형성될 수 있는 <code class=\"language-text\">최소 3대의 Sentinel</code> 을 운용해야 효과적으로 자동 장애 복구 및 감지 기능을 발휘할 수 있습니다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/e5adc/redis-sentinel.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 61.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVR42jWPbVPTQBDH86l96VcQZKQtUqhNC9MC+rLKDLaCtToKFBwFUWrSPNzlLpc0z5dLmnOLurNz+ed3+9+9VeRDlGURuqTMUiHyNImTNM05XywWYRhyztM0TZIkyzIQQOT/UHIp723/wglGLLsO+C+LZdBL5FDt+z74QQghqqoCZxzHjDHwgwCi4KU8+k7PBh/6pBwdfzq4mGuFjDxmI8QeAiEEXWAsCEopaDgxxnmeK4Qv9xPZHU/PHz1+OfzciqWRVkmwmBvmcDgcjUamacIoGAuNptPpYDC4ublxXXdlRkLuW+LkzeT45Mvw9bijJZqQke9ZCGm6puk6PAEeD5Ox4ximOfs9s2wb9MocSDn5Zr2/Nl4JeXqLx5calZJHse/6oR9CgkjjtCiKFfGCyI8CFiy8RVmWipQVEnRWOPPEmAlsCiKrZbSMdW7OMwtSz8yoTCpZWTmaZ6axgiYWBIjiFqxNeqrb6/qHXdZvOioSzrtgvE3VFfEPnxP1NJyYub1D9jreAZA267VpjwpXQbmjsn79bndtWmvc7TZJR+fG2/CsbrQ2vm5tXDe27PYoHM+4DubabXP9qta4b4EZCfzPXPux8+T8Gdw1afevuWG0nl7V1y9rW9YLMN9zbZfubd421y436z932m4P5VhhhafSvuod7PlHXe+wSbqwz2kw2aYdIJDbpHMWfoSFW2QfCoDAsA7tu4IpsDd8LI4QxzbHRFAgyTK1cgy9EXfgCn4BOoJCAUA4qWCVrP4AeI9xnEZb6JkAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='redis-sentinel의 대략적인 구조' title='' src='/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/ca1dc/redis-sentinel.png' srcset='/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/e7570/redis-sentinel.png 170w,\n/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/f46e7/redis-sentinel.png 340w,\n/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/ca1dc/redis-sentinel.png 680w,\n/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/e5adc/redis-sentinel.png 826w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>redis-sentinel의 대략적인 구조</figcaption>\n  </figure></p>\n<h2 id=\"구현해보기\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"구현해보기 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>구현해보기</h2>\n<p>간단하게 Docker를 통해 구현해보도록 하겠습니다. 총 6개의 컨테이너의 분류는 다음과 같습니다.</p>\n<ul>\n<li><code class=\"language-text\">redis-master</code></li>\n<li><code class=\"language-text\">redis-replica-1</code></li>\n<li><code class=\"language-text\">redis-replica-2</code></li>\n<li><code class=\"language-text\">redis-sentinel-1</code></li>\n<li><code class=\"language-text\">redis-sentinel-2</code></li>\n<li><code class=\"language-text\">redis-sentinel-3</code></li>\n</ul>\n<p>먼저 <code class=\"language-text\">redis-master</code> 를 올려주도록 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> redis-master <span class=\"token parameter variable\">--network</span> <span class=\"token punctuation\">{</span>NETWORK_NAME<span class=\"token punctuation\">}</span> <span class=\"token parameter variable\">-p</span> <span class=\"token punctuation\">{</span>PORT<span class=\"token punctuation\">}</span>:6379 redis:<span class=\"token punctuation\">{</span>TAG<span class=\"token punctuation\">}</span> redis-server <span class=\"token parameter variable\">--apendonly</span> <span class=\"token function\">yes</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">--appendonly</code> : 데이터를 영구적으로 저장하기 위한 옵션입니다. <code class=\"language-text\">appendonly.aof</code> 파일에 기록하고 서버 재시작 시 해당 내용을 기반으로 데이터를 복원합니다.</li>\n</ul>\n<p>다음은 <code class=\"language-text\">redis-replica-n</code> 입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> redis-replica-n <span class=\"token parameter variable\">--network</span> <span class=\"token punctuation\">{</span>NETWORK_NAME<span class=\"token punctuation\">}</span> <span class=\"token parameter variable\">-p</span> <span class=\"token punctuation\">{</span>PORT<span class=\"token punctuation\">}</span>:6379 redis:latest redis-server <span class=\"token parameter variable\">--slaveof</span> redis-master <span class=\"token number\">6379</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">--slaveof</code> : 호스트가 <code class=\"language-text\">redis-master</code> 이고 포트가 <code class=\"language-text\">6379</code> 인 마스터를 따른다는 옵션입니다. 즉 해당 Master의 Replica로 설정됩니다.</li>\n</ul>\n<p>원하는 개수의 <code class=\"language-text\">Replica</code> 만큼 생성하면 됩니다.</p>\n<p>이제 마지막으로 <code class=\"language-text\">redis-sentinel</code>을 생성할 차례입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--name</span> sentinel-1 <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--network</span> <span class=\"token punctuation\">{</span>NETWORK_NAME<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">-p</span> <span class=\"token punctuation\">{</span>PORT<span class=\"token punctuation\">}</span>:26379 <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">-v</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>/sentinel.conf:/etc/sentinel/sentinel.conf <span class=\"token punctuation\">\\</span>\nredis:latest <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">sh</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"sleep 5 &amp;&amp; redis-sentinel /etc/sentinel/sentinel.conf\"</span></code></pre></div>\n<p>Sentinel의 경우 옵션을 넣는 파일을 Volume을 잡았다. 이에 <code class=\"language-text\">sentinel.conf</code> 내용은 다음과 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">sentinel monitor mymaster {MASTER_IP} 6379 2\nsentinel down-after-milliseconds mymaster 5000\nsentinel failover-timeout mymaster 10000\n# sentinel auth-pass mymaster {MASTER_PASS}</code></pre></div>\n<ul>\n<li><code class=\"language-text\">monitor mymaster redis-master 6379 2</code> : 내부에서 mymaster 라는 이름으로 redis-master:6379 라는 master를 모니터링 하고, <code class=\"language-text\">최소 2개의 Sentinel</code> 이 <code class=\"language-text\">Master</code> 가 다운되었다고 판단해야 <code class=\"language-text\">Failover</code> 를 수행한다는 설정입니다.</li>\n<li><code class=\"language-text\">down-after-milliseconds mymaster 5000</code> : Master가 5(5000ms)초 동안 응답이 없으면 다운된 것으로 판단합니다. (주관적 판단)</li>\n<li><code class=\"language-text\">failover-timeout mymaster 10000</code> : Failover 시 전체 프로세스에 적용될 Timeout의 설정값 (새 마스터 승격, 클러스터 재구성 등등)</li>\n<li><code class=\"language-text\">auth-pass mymaster {PASSWORD}</code> : Master 생성 시 <code class=\"language-text\">Pass</code>를 설정했다면 기록되는 값</li>\n</ul>\n<p>위 과정을 따랐다면, 총 <code class=\"language-text\">6개의 컨테이너</code>가 성공적으로 동작할 것 입니다.. 이제 Master가 다운되었을 때, 각각의 Sentinel 들이 합의를 통해 Replica 중 하나를 Master로 승격하는지 확인하는 과정이 남았습니다.</p>\n<h2 id=\"확인하기\" style=\"position:relative;\"><a href=\"#%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"확인하기 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>확인하기</h2>\n<p>먼저 <code class=\"language-text\">redis-master</code> 와 <code class=\"language-text\">redis-replica-n</code> 잘 연결되어있는지 확인해봅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> redis-master redis-cli info replication</code></pre></div>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 439px; '>\n      <a class='gatsby-resp-image-link' href='/static/1c5e6457766f68a27036ac7c5a655c66/54b61/replication-result.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 45.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTElEQVR42oWSyYrCUBBF30eIUZwHIqKC4gDO8wi6cUBFF/r//3CbUxLpXoReHOq+VHJzKxU3nU612Wy0Xq/V6/WUyWQUi8UUjUZD8TwvtOfa7bbG47H6/b7Q3W5XzWbTjLPZrAqFgvL5vOlcLvfVVCgWiwY9rrvFYqH9fq/VaiU0iZfLpWazmbbbrcGZKYL+aDQy0NxH5T4mdIPBwJKRCk1CKqmpw+FQk8nE+uVy2SiVSlar1apqtZpSqZTi8bjhTqeTpZvP5zocDsbj8dD7/dbr9dLlctHxeDRut5vO57Ou16vu97udn8+nvTgSiXwMMSI+SWigSYT2fV+JRELpdNpSJJPJP9ALNIsEx9yMhwlwBkbEhM3x9mC7YXwN+eCw2+3s1wk+MqOziFarpUqlYil/PxiGazQa36V0Oh2r9XpdXOfMr4EZ4/1nhuEPsFQWbpaw+DIAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='redis-master 컨테이너의 Replication 정보' title='' src='/static/1c5e6457766f68a27036ac7c5a655c66/54b61/replication-result.png' srcset='/static/1c5e6457766f68a27036ac7c5a655c66/e7570/replication-result.png 170w,\n/static/1c5e6457766f68a27036ac7c5a655c66/f46e7/replication-result.png 340w,\n/static/1c5e6457766f68a27036ac7c5a655c66/54b61/replication-result.png 439w' sizes='(max-width: 439px) 100vw, 439px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>redis-master 컨테이너의 Replication 정보</figcaption>\n  </figure></p>\n<p>해당 명령어를 통해 <code class=\"language-text\">Master Redis Instance</code> 와 연결된 <code class=\"language-text\">Replication Redis Instance</code> 들의 정보를 확인할 수 있습니다.</p>\n<p>그리고 Sentinel 목록 중 하나의 컨테이너에서 마스터를 잘 바라보고 있는지 확인합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sentinel-n redis-cli <span class=\"token parameter variable\">-p</span> <span class=\"token punctuation\">{</span>PORT<span class=\"token punctuation\">}</span> sentinel get-master-addr-by-name <span class=\"token punctuation\">{</span>MASTER_NAME<span class=\"token punctuation\">}</span></code></pre></div>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 117px; '>\n      <a class='gatsby-resp-image-link' href='/static/c3ebd2f68241e67ff5735e67d25c31c3/b6338/get-master-addr-by-name-result.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 28.205128205128204%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVR42nWP24qCYBSFfQUPqVlEocFQGhGUmUdEjbLmJiyiCIKGnqCbevg17g0TMxdz8fH/sPdaey0hiiLM53NY/T7yPMdqtcJisUCapiiKArZtYzQaIc0yFOsS/XrPdV2QzjRNJEmCz+0WUZbjw3Yg7Pd7FkuShPF4jOVyiaqqsNlscDqdWDwYDPB1u+H1fGI4HOJ6veLxeMAwDJB+XZawanNJFCGEYQjHcaBpGpt2Oh0EQQDLstiMjpAJJfF9H9PpFLPZDJ7nYTKZII5j6LoOpdHgAwJVpKEsy1z5crlwVUpIs/P5zGR1ZbFOoCgK7xL0pxDNZpMhY2G323FlSkiUdfz7/Y7j8cj1qdLhcODlVqv1Fv+GZj8IvV4P7Xb7bUh0u12GFqgGvaqq/hH+xzfkSrvxK32IoQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='결과로 Master Redis Instance의 IP 주소가 나온다.' title='' src='/static/c3ebd2f68241e67ff5735e67d25c31c3/b6338/get-master-addr-by-name-result.png' srcset='/static/c3ebd2f68241e67ff5735e67d25c31c3/b6338/get-master-addr-by-name-result.png 117w' sizes='(max-width: 117px) 100vw, 117px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>결과로 Master Redis Instance의 IP 주소가 나온다.</figcaption>\n  </figure></p>\n<p> 이제 Master를 다운 시켜서 각각의 Sentinel 들의 합의를 통해 Replica 중 하나를 Master 로 승격시키는 지 확인해봅시다. <code class=\"language-text\">Master</code> 를 다운 시키기 위해서 <code class=\"language-text\">redis-master</code> 컨테이너를 정지 시켜 봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> stop redis-master</code></pre></div>\n<p>그리고 여러 <code class=\"language-text\">Sentinel 컨테이너</code> 중 하나의 로그를 살펴봅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> logs <span class=\"token parameter variable\">-f</span> sentinel-1</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">10:X 16 Jun 2025 06:52:14.841 # +vote-for-leader c193c15f0a95f7b655f6ab0225f0042a958d11e1 1\n10:X 16 Jun 2025 06:52:15.785 # +odown master mymaster 172.18.0.2 6379 #quorum 3/2\n10:X 16 Jun 2025 06:52:15.785 * Next failover delay: I will not start a failover before Mon Jun 16 06:52:35 2025\n10:X 16 Jun 2025 06:52:16.014 # +config-update-from sentinel c193c15f0a95f7b655f6ab0225f0042a958d11e1 172.18.0.5 26379 @ mymaster 172.18.0.2 6379\n10:X 16 Jun 2025 06:52:16.014 # +switch-master mymaster 172.18.0.2 6379 172.18.0.4 6379</code></pre></div>\n<p><code class=\"language-text\">redis-master</code> 컨테이너를 중지시키게 되면, 각각의 <code class=\"language-text\">Sentinel</code> 이 투표를 통해 <code class=\"language-text\">redis-master</code> 가 다운됐다는 것을 공식적으로 확인합니다. 그리고 투표의 값이 우리가 <a href=\"\">설정한 임계값</a> 을 넘어가게 되면, (로그에서는 3/2로 과반을 넘었다.) <code class=\"language-text\">Replica Redis Instance</code> 중 하나를 <code class=\"language-text\">Master Redis Instance</code> 로 승격시킵니다.</p>\n<p>승격이 완료된 뒤에 <code class=\"language-text\">Sentinel</code> 에서 다음 명령어를 통해 바라보고 있는 Master 를 확인할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">redis-cli <span class=\"token operator\">></span> SENTINEL get-master-addr-by-name <span class=\"token punctuation\">{</span>모니터링_하고_있는_Master_이름<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같이 다른 <code class=\"language-text\">Replica Redis Instance</code> 의 주소가 저장되어 있는 것을 확인할 수 있습니다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/7c85dc0fbb0c3db261009e2a1930daf5/e5adc/new-structure.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 61.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACRklEQVR42j1Qa0/bUAzNv97H/YFJA6bRFpFSkqZVC2zal3VDYkChdBNjbUHjNVGged3k5kHeyW0Sz9Vg1pGvfexjy5eDZytf8D+FJI4C186TKI1CtDiO0fu+/9IDXAZwpzkTKzxNYewmt7KFjJaWv0IYmvGJGY8i0JAqizCKgiCwLAv1OKUsS44UsHNJ+59P2iQ/3P2xNZLlHA7ckifQcaHjQF2DvSfI0kTTdUqp67roCSFZlnFmWrQjkAaTs1evP+yfNkJQ4uLYA0HO3uyPlgeXkpYfepAksW3b4/G41+tdXV3h/oVYZ9BW2d7X4e7ez/0vg+ZDNGOLzQ292JzFgpxs6gVuTpKEGIasKNP7qappGC/EHsDwt3p8Ln9k0L8mx6MHB+AiKD9Z0HMXwGASQjGfu5brOV7gBp7tPTlPeZ5z+BU6o9O5MYvkKSMKM/FvgiK6T5XHREXcJ0qQhyWUaqbPEkVOVPSEmchw1twWzI5odSR3W7K7vCHqzDj0BjwVW+42Yt0U+/5QybS6KTWdLWwT7I5AO5RZnJ4Zot2t3m4sjSu12w3ebD6m8jf/qCo33l2srZzX1jThwB9M08e62apc88uTSu2ugWKdkWdx5ab+9uw91ngq/RPX5MbKpLo8qqypmyi+Sx82aGv1ml8arVb/1AWro2eEs+eOSLuis9VydyRnmzclvKfvDddpExnEutk88r/jwQ2zjQ3I4LIm7VrM5vBufNRU11OipcRkFJmoiNWM4Gw9NbCEKZIGo9iAJHrK7BLKv9ACbgFFzsf8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='새롭게 승격된 Master Redis Instance의 구조' title='' src='/static/7c85dc0fbb0c3db261009e2a1930daf5/ca1dc/new-structure.png' srcset='/static/7c85dc0fbb0c3db261009e2a1930daf5/e7570/new-structure.png 170w,\n/static/7c85dc0fbb0c3db261009e2a1930daf5/f46e7/new-structure.png 340w,\n/static/7c85dc0fbb0c3db261009e2a1930daf5/ca1dc/new-structure.png 680w,\n/static/7c85dc0fbb0c3db261009e2a1930daf5/e5adc/new-structure.png 826w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>새롭게 승격된 Master Redis Instance의 구조</figcaption>\n  </figure></p>\n<p>정확히 확인하기 위해서, 새롭게 승격된 <code class=\"language-text\">Master Redis Instance</code> 에 접속하여 <code class=\"language-text\">info replication</code> 명령어를 확인하면 <code class=\"language-text\">role:master</code> 임을 확인할 수 있습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 654px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/66db108af6504f0cf3f75173e786b57f/ba4a2/after-master-down-sentinel-master-addr.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 9.411764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAX0lEQVR42k2KOQoAIRAEPQITRRPPASMzYf3/63qZgV0MCvoo9ZyDvTdaa4gxgoiQUkIpRfDeY4yBWquQcxaHc+9dHP7nnAghQK21ZHDOQWsNay2MMT+83Z3/2/k6w+4LdDguyyk9QtgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='after master down sentinel master addr' title='' src='/static/66db108af6504f0cf3f75173e786b57f/ba4a2/after-master-down-sentinel-master-addr.png' srcset='/static/66db108af6504f0cf3f75173e786b57f/e7570/after-master-down-sentinel-master-addr.png 170w,\n/static/66db108af6504f0cf3f75173e786b57f/f46e7/after-master-down-sentinel-master-addr.png 340w,\n/static/66db108af6504f0cf3f75173e786b57f/ba4a2/after-master-down-sentinel-master-addr.png 654w' sizes='(max-width: 654px) 100vw, 654px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>그리고 이전에 중지된 <code class=\"language-text\">redis-master</code> 를 정상적으로 복구 시키게 되면 현재 <code class=\"language-text\">Master Redis Instance</code> 의 <code class=\"language-text\">Replica</code>로 붙게 됩니다.</p>\n<p>자세한 코드 내용은 <a href=\"https://github.com/jin-daram/tech-blog-code-lab\">블로그 코드 저장소</a> 에서 내용을 확인하실 수 있습니다.</p>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>마무리</h2>\n<p>이렇게 <code class=\"language-text\">Redis Sentinel</code> 에 대해 알아보고, 직접 테스트하여 <code class=\"language-text\">Quorum</code>, <code class=\"language-text\">Failover</code> 의 처리를 눈으로 확인해보았습니다. 학습하면서 알게 된 사실인데, Master-Replica 구조로 Redis를 구성했을 때, 읽기 요청 시 자동으로 로드밸런싱을 해주는 것이 아니더군요. <em>( <code class=\"language-text\">Lettuce</code>와 같은 Redis Client 에서도 지원을 안하는 것 같았습니다. )</em></p>\n<p>그래서 <a href=\"https://github.com/twitter/twemproxy\">Twemproxy</a> 나 <a href=\"https://github.com/joyieldInc/predixy\">Predixy</a> 와 같은 프록시를 거쳐야 한다는 것을 알았습니다. <a href=\"https://github.com/redis/lettuce/issues/834\">참조</a> </p>\n<blockquote>\n<p>Lettuce selects a slave per slot hash and uses the selected slave for read operations until the next topology refresh. This is by design to reduce CPU overhead.</p>\n</blockquote>\n<p>이를 통해 Redis의 구성이 변경되지 않는 한 <em>(e.g 새로운 Replica Redis가 추가된다거나 등)</em> 지정된 Replica에 대해서만 읽기 요청을 보낸다는 것 같았습니다.</p>\n<p>사실 이러한 설정은 굉장히 복잡하고, 네트워크도 설정해야 하니, 수지타산을 고려하여 이런 것들을 상대적으로 쉽게 설정할 수 있는 <code class=\"language-text\">AWS ElastiCache</code> 와 같은 서비스를 이용하는 것도 좋을 것 같습니다.</p>","frontmatter":{"title":"Redis-Sentinel에 대해 알아보고 직접 구현해보기","date":"June 16, 2025","update":"June 16, 2025","tags":["Redis","Redis-Sentinel","분산"],"series":null},"fields":{"slug":"/redis-sentinel/","readingTime":{"minutes":14.815}}},"seriesList":{"edges":[{"node":{"id":"ce12447b-479a-5517-9dc7-ee7766b5c879","fields":{"slug":"/intellij-zoom-issue/"},"frontmatter":{"title":"IntelliJ Mouse Wheel Zoom 이슈"}}},{"node":{"id":"d1f5a049-8286-5c64-930b-e22cdf15c246","fields":{"slug":"/redis-sentinel/"},"frontmatter":{"title":"Redis-Sentinel에 대해 알아보고 직접 구현해보기"}}},{"node":{"id":"6f0ed8e8-1d26-5974-90cd-d2f211d24484","fields":{"slug":"/jvm/"},"frontmatter":{"title":"JVM의 JIT Compiler의 기본"}}},{"node":{"id":"d6ba8e3a-5d02-592c-a5ec-fda80e8df2e3","fields":{"slug":"/about/"},"frontmatter":{"title":"This is about page ✋"}}}]},"previous":{"fields":{"slug":"/nestjs-tx-implement/"},"frontmatter":{"title":"NestJS @Transactional 구현하기"}},"next":{"fields":{"slug":"/query-plan-analysis/"},"frontmatter":{"title":"실무에서 쿼리 플랜을 통한 성능 개선 경험 (feat. 134배 향상)"}}},"pageContext":{"id":"d1f5a049-8286-5c64-930b-e22cdf15c246","series":null,"previousPostId":"8b24dc12-b156-5227-b6ce-2b729788058c","nextPostId":"4f994ee6-e418-58a7-8365-6da206920a84"}},"staticQueryHashes":[],"slicesMap":{}}