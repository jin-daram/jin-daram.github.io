<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[RSS Feed of Let's solve it]]></title><description><![CDATA[문제들을 한번 해결해봅시다.]]></description><link>https://jindaram.site</link><generator>GatsbyJS</generator><lastBuildDate>Mon, 14 Jul 2025 08:44:19 GMT</lastBuildDate><item><title><![CDATA[JVM의 JIT Compiler의 기본]]></title><description><![CDATA[및  에서 관련 글을 읽은 후 공부한 내용을 정리한 내용입니다. 부정확하거나 사실과 다른 내용이 있을 수 있습니다. Just In Time Java는 일반적으로 바이트코드(.class)를 생성하고, 이 바이트코드를 JVM…]]></description><link>https://jindaram.site/jvm/</link><guid isPermaLink="false">https://jindaram.site/jvm/</guid><pubDate>Mon, 14 Jul 2025 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;JVM 밑바닥까지 파헤치기 - 저우즈밍&lt;/code&gt; 및 &lt;code class=&quot;language-text&quot;&gt;알리바바 Cloud Tech Blog&lt;/code&gt; 에서 관련 글을 읽은 후 공부한 내용을 정리한 내용입니다. 부정확하거나 사실과 다른 내용이 있을 수 있습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Just-In-Time&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Just-In-Time&quot; aria-label=&quot;Just In Time permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Just In Time&lt;/h2&gt;
&lt;p&gt;Java는 일반적으로 바이트코드(.class)를 생성하고, 이 바이트코드를 JVM 위에서 해석한 후 기계여러 변환하여 실행한다. 그런데 바이트코드를 매번 해석하게 되면 느릴 수 밖에 없다.&lt;/p&gt;
&lt;p&gt;이 때 등장하는 게 바로 &lt;code class=&quot;language-text&quot;&gt;JIT Compiler&lt;/code&gt; 이다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;JVM은 처음에 &lt;code class=&quot;language-text&quot;&gt;Interpreter&lt;/code&gt; 방식으로 코드를 해석한다. 이는 실행 시간을 빠르지만 코드 자채의 실행 속도는 느리다.&lt;/li&gt;
&lt;li&gt;그래서 특정 메소드나 Loop가 자주 실행되면 중요한 코드라고 판단한다.&lt;/li&gt;
&lt;li&gt;해당 부분은 적절한 최적화 기법을 거쳐 &lt;code class=&quot;language-text&quot;&gt;Native Machine Code&lt;/code&gt; 로 변환한다.&lt;/li&gt;
&lt;li&gt;변환된 코드는 &lt;code class=&quot;language-text&quot;&gt;Code Cache&lt;/code&gt;에 저장되어 빠르게 재사용 된다.&lt;/li&gt;
&lt;/ol&gt;
&lt;br&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;JIT Compiler&lt;/code&gt; 에는 2 종류의 컴파일러가 존재한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;C1 (Client Compiler)&lt;/strong&gt; : 빠르게 컴파일 되지만 최적화는 약하다. 빠른 반응이 필요한 앱에 적합&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;C2 (Server Compiler)&lt;/strong&gt; : 컴파일은 느리지만, 고성능 최적화를 적용하기 때문에 성능은 굉장히 빠르다. 이는 서버와 같이 장기적으로 실행되는 Application에 적용되는 것이 적합하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;Tiered-Compilation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Tiered-Compilation&quot; aria-label=&quot;Tiered Compilation permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Tiered Compilation&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;계층형 컴파일 전략은 JVM의 JIT 컴파일 전략 중 하나이다. 쉽게 설명하자면 Interpreter -&gt; C1 -&gt; C2 순서로 점차 성능을 끌어올리는 계층형 컴파일 방식이다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Interpreter&lt;/code&gt; : 빠르게 실행되지만 실행은 느림&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;C1 Compiler&lt;/code&gt; : 빠르게 컴파일 하지만 최적화는 약함&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;C2 Compiler&lt;/code&gt; : 고성능 촤적화를 하지만 컴파일 느림&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이것들은 전부 적절히 섞어서 빠른 시간 + 높은 성능을 내도록 하는 것이 바로 &lt;code class=&quot;language-text&quot;&gt;Tiered Compilation&lt;/code&gt; 이다.
기본적으로 순차적으로 실행되지만 점진적으로 실행 통계를 수집하여 충분한 실행 통계가 수집되면 순서대로 컴파일 하게 되는 구조이다.&lt;/p&gt;
&lt;h3 id=&quot;Interpreter-인터프리터&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Interpreter-%EC%9D%B8%ED%84%B0%ED%94%84%EB%A6%AC%ED%84%B0&quot; aria-label=&quot;Interpreter 인터프리터 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Interpreter (인터프리터)&lt;/h3&gt;
&lt;p&gt;인터프리터는 흔히 우리가 알고 있는 &lt;code class=&quot;language-text&quot;&gt;바이트 코드를 한 줄 한 줄 읽으면서 해석하여 실행하는 엔진&lt;/code&gt;이다. 초기 실행 속도는 빠르지만 성능은 낮다.&lt;/p&gt;
&lt;h3 id=&quot;Client-Compiler-C1-Compiler&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Client-Compiler-C1-Compiler&quot; aria-label=&quot;Client Compiler C1 Compiler permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Client Compiler (C1 Compiler)&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;Client Compiler (이하 C1) 는 JVM 내부에서 동작하는 &lt;code class=&quot;language-text&quot;&gt;C1 Compiler&lt;/code&gt; 를 가리키는 정확한 명칭입니다. &lt;code class=&quot;language-text&quot;&gt;C1&lt;/code&gt; 은 빠른 컴파일을 목적으로 사용합니다만, Server Client에 비해 좋지 않은 성능을 가지고 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt; 의 최적화 된 성능은 클라이언트 컴파일러보다 성능이 30% 향상됩니다. 하지만 &lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt; 로 바로 컴파일 해버리면 너무 고성능 최적화를 하기 위해 초기 컴파일 시간이 오래 걸리게 됩니다. 그렇기 때문에 &lt;code class=&quot;language-text&quot;&gt;Interpreter&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;C2 Compiler&lt;/code&gt; 의 중간 단계의 성격을 띄는 C1 가 등장하게 되었습니다.&lt;/p&gt;
&lt;p&gt;C1은 &lt;code class=&quot;language-text&quot;&gt;Inlining&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Costant Folding&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Dead Code Elimination&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Loop Unrolling&lt;/code&gt; 등과 같은 기본적인 최적화만 적용하고, &lt;code class=&quot;language-text&quot;&gt;Native Machine Code&lt;/code&gt; 로 변환되어 &lt;code class=&quot;language-text&quot;&gt;Code Cache&lt;/code&gt; 에 저장됩니다. &lt;/p&gt;
&lt;h3 id=&quot;Server-Compiler-C2-Compiler&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Server-Compiler-C2-Compiler&quot; aria-label=&quot;Server Compiler C2 Compiler permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Server Compiler (C2 Compiler)&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Server Compiler&lt;/code&gt;는 &lt;code class=&quot;language-text&quot;&gt;C2 Compiler (이하 C2)&lt;/code&gt; 를 의미합니다. &lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt; 는 HotSpot JVM의 고성능 Just-In-Time 컴파일러로 자주 실행되는 메소드를 최적화 된 Native Machine Code로 컴파일 하여 실행 성능을 극대화 하는 컴파일러 입니다.
충분한 Profiling 정보를 기반으로 최적화가 진행되며 Method inlining, Loop Peeling, Escape Analysis 등 좀 더 상세하고 성능이 더 발휘할 수 있는 최적화 기법이 사용됩니다. C1 에서도 사용하는 Inlining, Loop Unrolling 등 도 해당 단계에서는 좀 더 심층적으로 적용하여 최적화 합니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt;는 고급 최적화 기법을 적용하기 때문에, &lt;code class=&quot;language-text&quot;&gt;C1&lt;/code&gt; 보다 장기적인 실행 성능이 우수합니다. 특히 반복 루프나 힙 최적화가 중요한 상황에서 체감 성능 차이가 수십 % 이상 벌어지기도 합니다.
&lt;code class=&quot;language-text&quot;&gt;C2&lt;/code&gt;에 의해 컴파일 된 Native Machine Code도 Code Cache 공간에 저장됩니다. 하지만 컴파일 시간이 길고, 다른 Compiler 및 Interpreter 보다 더 많은 자원 사용량을 가지며 디버깅 시에 실제 흐름이 왜곡될 수 있다는 단점을 가집니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Graal Compiler&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;JDK 9 부터 도입된 최신 JIT(Just-In-Time) 컴파일러로, 기존 C2 컴파일러보다 더 유연하고 확장성이 높다. 기존 C1/C2 Compiler는 C++로 작성되었지만, Graal은 Java로 작성되었습니다. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;Code-Cache&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Code-Cache&quot; aria-label=&quot;Code Cache permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Code Cache&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Code Cache&lt;/code&gt; 는 JVM에서 JIT 컴파일 된 기계어를 저장하는 메모리 공간입니다.&lt;/p&gt;
&lt;p&gt;바이트 코드를 매번 다시 컴파일 하지 않고, 한번 컴파일 된 코드를 재사용 위한 목적으로 정의된 공간입니다.
위에서 설명하였듯이 JVM은 처음 코드를 Interpreter를 통해 실행하다가, 점차 실행 통계가 많이 쌓이면 그 통계를 기준으로 C1 -&gt; C2 컴파일을 통해 코드를 최적화 합니다.&lt;/p&gt;
&lt;p&gt;그리고 그 최적화 된 코드를 매번 컴파일 하기보다
어떤 코드가 들어왔을 때, 해당 코드에 대해 최적화 된 코드를 이미 컴파일 했었다면 이는 Code Cache로 부터 가져와, 빠르게 Native Code를 실행 시킵니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Non-method Segment&lt;/code&gt; : -XX:NonNMethodCodeHeapSize 으로 조정된 내부 JVM 작업 관련 코드를 저장합니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Profiled-Code Segment&lt;/code&gt; : 짧은 라이프 사이클을 가지는 (언제든지 C2로 업그레이드 할 수 있는) C1 컴파일러에 의해 컴파일 된 코드를 포함합니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Non-Profiled Segment&lt;/code&gt; : 긴 라이프 사이클을 가지는 C2 컴파일러로 컴파일 된 코드를 저장합니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Code Cache의 내부는 대체적으로 위와 같은 영역으로 구분됩니다. Code Cache는 초기 할당 크기를 가지고 시작하지만, 영역이 더 필요한 경우 확장하기도 합니다. 기본적으로 초기 할당 사이즈는 &lt;code class=&quot;language-text&quot;&gt;2,496KB&lt;/code&gt; 이고 최대 사이즈는 &lt;code class=&quot;language-text&quot;&gt;240MB&lt;/code&gt; 입니다.
각각 &lt;code class=&quot;language-text&quot;&gt;-XX:InitialCodeCacheSize=N&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;-XX:ReservedCodeCacheSize=M&lt;/code&gt; 으로 직접 설정할 수 있습니다. 또한 현재 사용하고 있는 크기를 &lt;code class=&quot;language-text&quot;&gt;-XX:PrintCodeCache&lt;/code&gt; 옵션을 통해 확인할 수 있습니다.&lt;/p&gt;
&lt;h3 id=&quot;JIT-성능-최적화-기법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#JIT-%EC%84%B1%EB%8A%A5-%EC%B5%9C%EC%A0%81%ED%99%94-%EA%B8%B0%EB%B2%95&quot; aria-label=&quot;JIT 성능 최적화 기법 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;JIT 성능 최적화 기법&lt;/h3&gt;
&lt;h4 id=&quot;Method-Inlining&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Method-Inlining&quot; aria-label=&quot;Method Inlining permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Method Inlining&lt;/h4&gt;
&lt;hr&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Human&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; age&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getAge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; age&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setAge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; age&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;age &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; age&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;개발을 하다보면, 위와 같은 유사한 구조를 지닌 클래스를 많이 작성합니다. 이는 일부 캡슐화를 지킨 기본 구조 입니다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Human&lt;/span&gt; human &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Human&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
human&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;human&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;하지만 이러한 코드를 호출하는 비용은 상대적으로 높습니다. 그 이유는 여러 Stack Frame을 스위칭하기 때문입니다. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Stack Frame 이란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Stack은 각각의 Thread가 별도로 가지는 지역변수, 매개변수 등등의 값을 저장하는 공간입니다. Stack Frame은 메소드가 호출될 때마다 생기는 메모리 블록으로 그 메서드의 지역 변수, 매개 변수, 반환 주소, 호출자 정보 등을 담고 있는 스택의 한 칸 이라고 생각하면 좋습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;위 &lt;code class=&quot;language-text&quot;&gt;setName()&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;getAge()&lt;/code&gt; 메소드를 호출하게 되면 총 2개의 &lt;code class=&quot;language-text&quot;&gt;Stack Frame&lt;/code&gt; 이 생겨납니다.&lt;/p&gt;
&lt;p&gt;이렇게 되면 Stack Frame Switching 이 발생하여 연산 자원을 더 사용하게 됩니다.
Stack Frame을 생성하지 않고 두 메서드에 접근하는 방법은 다음과 같습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
human&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;human&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;age&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;컴파일러는 &lt;code class=&quot;language-text&quot;&gt;getAge()&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;setName()&lt;/code&gt; 메소드르 통해 Human 필드에 접근하는 것을 위와 같이 필드에 직접 접근 하는 것으로 최적화 합니다. &lt;/p&gt;
&lt;h4 id=&quot;Loop-Unrolling&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Loop-Unrolling&quot; aria-label=&quot;Loop Unrolling permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Loop Unrolling&lt;/h4&gt;
&lt;hr&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0L&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MAX&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 두 코드의 속도는 다를까요 같을까요? 정답은 &lt;strong&gt;Loop Counter가 Integer인 경우가 더 빠릅니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;CPU가 계산하기 가장 최적화인 파이프라인은 바로 명령어를 순차적으로 처리하는 것 입니다. &lt;/p&gt;
&lt;p&gt;하지만 반복문의 경우 하나의 반복이 끝난다면 다음 반복을 시작해야 할지 말지에 대해 성능적 부담을 느끼게 됩니다. &lt;/p&gt;
&lt;p&gt;현재의 파이프라인 상태를 보존하고, 역전된 위치를 보존하고, 반복문의 내용을 메인 메모리로부터 다시 읽어야 하고, 실행을 위해 다시 파이프라인에 올리는 등의 작업이 이루어져야 합니다. (Interpreter를 통해 코드를 해석하는 경우)&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Loop Unrolling&lt;/code&gt; 은 JVM이 성능 최적화를 위해 자주 쓰는 최적화 기법입니다. 하지만 Loop Counter를 long 타입으로 사용하는 코드에서는 거의 적용이 되지 않습니다. 그 이유는 long 타입에 대한 최적화가 부족하기 때문입니다.
대부분의 &lt;code class=&quot;language-text&quot;&gt;Loop Unrolling&lt;/code&gt; 은 int 타입에 최적화 되어 있습니다.&lt;/p&gt;
&lt;p&gt;JVM은 int 타입의 변수가 &lt;code class=&quot;language-text&quot;&gt;Overflow&lt;/code&gt; 할 수 있음을 알고 있습니다. 그래서 최적화 과정에서 int Loop는 내부적으로 long 타입으로 캐스팅하여 안전하게 처리합니다. 하지만 &lt;code class=&quot;language-text&quot;&gt;long 타입 Loop&lt;/code&gt; 는 Overflow를 감지하고 보호하려면 128bit 정수 타입이 있어야 하는데, Java엔 기본적으로 그런 타입이 존재하지 않아, &lt;code class=&quot;language-text&quot;&gt;long 타입 Loop&lt;/code&gt;는 안전하게 최적화하기 어렵습니다.&lt;/p&gt;
&lt;p&gt;long 타입 Loop를 사용하게 되면 JVM은 내부적으로 SafePoint Check 를 더 자주하게 됩니다.&lt;/p&gt;
&lt;p&gt;또한 배열에 접근할 때, 전체 범위 검사도 추가되어 결과적으로 Loop가 더 느려지는 결과를 초래하게 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;JIT Compiler&lt;/code&gt; 가 Loop 구문을 최적화 할 때, 루프 반복 횟수가 예측 가능하여야 하고 이에 대해 Overflow 및 다른 부작용 위험이 없을 때 Unrolling을 할 수 있습니다. 하지만 long 타입 Loop의 경우에는 Overflow 시 대처 할 수 있는 방법이 없습니다. 그래서 안전하게 최적화하지 못하기 때문에 성능 저하가 발생하는 것 입니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;SafePoint 란?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;JVM이 &lt;code class=&quot;language-text&quot;&gt;GC&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Deoptimization&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Class Redefinition&lt;/code&gt; 같은 작업을 하기 위해, 모든 &lt;code class=&quot;language-text&quot;&gt;Thread&lt;/code&gt; 를 멈출 수 있도록 준비된 정지 가능한 지점입니다.&lt;/p&gt;
&lt;p&gt;예를 들어 Heap에 생성된 객체가 너무 많아서 &lt;code class=&quot;language-text&quot;&gt;GC&lt;/code&gt; 를 처리해야 한다고 가정했을 때, 어느 한 쓰레드에서 영영 끝나지 않은 Loop 문을 돌고 있습니다. 이 상태에서 &lt;code class=&quot;language-text&quot;&gt;GC&lt;/code&gt; 를 해버리면 프로그램이 매우 불안정해질 수 있습니다. &lt;/p&gt;
&lt;p&gt;그렇기 때문에 쓰레드를 잠시 멈춰도 되는 지점이 있어야 하는데 이를 &lt;code class=&quot;language-text&quot;&gt;SafePoint&lt;/code&gt; 라고 합니다. &lt;code class=&quot;language-text&quot;&gt;int&lt;/code&gt; 타입의 경우, 수가 상대적으로 좁은 범위이기 때문에 빠른 시간 안에 &lt;code class=&quot;language-text&quot;&gt;SafePoint&lt;/code&gt; 에 도달할 수 있고, JVM 기준으로 잘 최적화 되어 있습니다. (e.g. 메서드 호출 지점, 반복문 종료 시점, 예외 처리 진입)&lt;/p&gt;
&lt;p&gt;하지만 long 타입 루프에는 루프가 끝나기 까지 많은 수의 반복을 돌려야 할 수 있습니다. 따라서 SafePoint에 도달하는 시간이 오래 걸릴 수 있습니다. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;STW (Stop The World)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;JVM이 내부 작업을 수행하기 위해 모든 Application Thread의 실행을 일시적으로 멈추는 것을 의미합니다. JVM의 내부 작업, 특히 GC는 애플리케이션 메모리를 직접 다루는 작업입니다. 이때 다른 Thread가 객체를 생성하거나 참조를 변경하면
JVM은 정확하게 어떤 객체가 살아있는지 알 수 없고 잘못된 메모리를 해제하여 프로그램이 불안정 해질 수 있습니다. 그렇기 때문에 JVM에서는 GC를 수행하기 전에 모든 Thread를 일시 중지하고 GC 작업을 안전하게 처리 합니다.
JVM은 아무 타미밍에서 Thread를 멈출 수 없고 멈춰도 안전한 지점인 Safe Point 에서만 STW 를 걸 수 있습니다. 모든 Thread 들이 SafePoint에 도달하기까지 기다리며 도달한 Thread는 대기 상태로 들어가고 마지막 Thread가 도달하면 STW가 시작됩니다.&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[OCR 기반 제목 추출 알고리즘 개선기]]></title><description><![CDATA[재직중인 회사에서 서비스하는 제품 중 OCR을 이용해 문서 파일의 글자를 추출하고, 이를 기반으로 제목을 추정하는 기능이 포함 되어있다. 나는 감사하게도 NAVER CLOVA OCR…]]></description><link>https://jindaram.site/ocr/</link><guid isPermaLink="false">https://jindaram.site/ocr/</guid><pubDate>Wed, 09 Jul 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;재직중인 회사에서 서비스하는 제품 중 OCR을 이용해 문서 파일의 글자를 추출하고, 이를 기반으로 제목을 추정하는 기능이 포함 되어있다.&lt;/p&gt;
&lt;p&gt;나는 감사하게도 NAVER CLOVA OCR과 서비스를 연동하고, 추출된 텍스트를 기반으로 문서 제목을 추정하는 기능 개발/개선에 참여했다.&lt;/p&gt;
&lt;h2 id=&quot;제목-추출-알고리즘의-초기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%9C%EB%AA%A9-%EC%B6%94%EC%B6%9C-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98%EC%9D%98-%EC%B4%88%EA%B8%B0&quot; aria-label=&quot;제목 추출 알고리즘의 초기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;제목 추출 알고리즘의 초기&lt;/h2&gt;
&lt;br&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/070af78ac88545a0d6dcd7cf10d151d1/f97d7/1.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 37.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVR42mWR3WsTQRTF94/2wRefRAQRfK4KQmmrVCtCLZGmYlJbKzGNaUzTtAUfFOvKls0m7c7sfOz+3DsxInjhwB3umXPunInSNMUUBq01Siu8KTlPRnR+7DOIu3S/feTossMw7lPWM+EItygKZrMZSs3PxhhEK5pmU6TKsqrhQz9OBxxctDhOe3S+79GbfOAwPggzX3Oqqgq9iJZlyaLEIGqPmzwdP6J93sRpHzYQN20U1hkus4RnvSfsn7ax2oZ5rnJynQeB/wRfD15w7/0tNofPKQvQhQ5P0LrAW0+cxNxu3WD90/LfuXMuCAhP+oVolmVEW19estS/T2P8CiwYa7DWBjjnucqv6FzscfZrFAwEZz9P2Bk2+Py1GzKXO977eYZvh29YOVqiddqE2tg6G1wXEKJUVWcsEQhnc7TO3d2brB0+pvpzR7acTCZEO4MGK72HvDvZxigb8pGf+xe5up7nVsMpz9bxBg8ad9jorzJTU7SSX9ckScJvklsIoYtc9ukAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;1&apos; title=&apos;&apos; src=&apos;/static/070af78ac88545a0d6dcd7cf10d151d1/ca1dc/1.png&apos; srcset=&apos;/static/070af78ac88545a0d6dcd7cf10d151d1/e7570/1.png 170w,
/static/070af78ac88545a0d6dcd7cf10d151d1/f46e7/1.png 340w,
/static/070af78ac88545a0d6dcd7cf10d151d1/ca1dc/1.png 680w,
/static/070af78ac88545a0d6dcd7cf10d151d1/02d09/1.png 1020w,
/static/070af78ac88545a0d6dcd7cf10d151d1/9d567/1.png 1360w,
/static/070af78ac88545a0d6dcd7cf10d151d1/f97d7/1.png 2000w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;기본적으로 이미지 혹은 PDF 파일을 OCR 처리를 하게 되면 위와 같이 글자로 인식한 부분에 대해서 Bounding Box로 인식된다. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Bounding Box란?&lt;/strong&gt; &lt;br&gt;
한 이미지를 OCR 처리하면 결과로 단어 혹은 문장의 위치 기반의 좌표값이 나온다. 이 때 해당 좌표를 기반으로 사각형을 구성한 것을 Bouding Box 라고 칭한다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;처음에는 단순히가장 상단 그리고 중앙에 있는 Bounding Box 중 높이가 가장 큰 Bounding Box를 제목으로 선정했다. 개발 시에 정해진 문서 양식만 올라온다고 가정했기에, 이렇게 간단한 알고리즘을 구성해서 문제를 해결할 수 있었다.&lt;/p&gt;
&lt;p&gt;하지만 요구사항과 &apos;제목이 중앙에 오는 문서&apos;, &apos;제목이 2줄인 문서&apos;, &apos;소제목이 있는 문서&apos; 등과 같이 업로드 되는 문서의 양식이 다양해지면서 기능 이슈에 대한 피드백이 있었다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 251px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/fe4345dbfe36a4add2a411a1606946ed/c0f59/3.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 73.52941176470587%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0klEQVR42o1T16oCUQz0T6xr7xUVEXXF3rGLgiAiPoj//zAygcixXe5DyNnsnsnMbOKwLAuBQAA+nw88M3j2er3w+/3weDxS4zPPbrdb6rzDusvlegkHi6VSCafTCZvNBuPxGNvtFoPBAPP5HNfrFf1+X/L5fMZisUC320WxWBRgNngBZDGdTgtQvV5HtVpFp9OR3Gg0sFwuUS6XBbTX66HZbKJSqSCbzQrLD4bBYBAMp9MpsiiX0nhmsG5KUwsIRjIfgHwRiUSkYyqVQjweRyKRQCaTkTPZx2Ixec9aMplEOBx+NvvqYaFQwOVyweFwwHq9Fsm73U4yfaXs2+2G+/2O6XQqDQj4DvaUTIbKjGbzbAYbkr0qiEajvxlSMkF1ZEyPdJxMT3W83v/uC6CyyOVykvP5vLBhI36kTJg1voE9AXm51WqhVqvJjHFcOCp894vJn4ChUEjYqEytMf4DaLJ26BrRH/WRNfWK/mmoh8xspKuoa8osY0PPVqsVhsMhRqORjAtXrN1uy/rt93tMJhOxgtvE8/F4lMxR45ZxPgkqkjkuvGzbtvjI9eJH9JGZoGzGZ67dbDaTJgTnzvMOR0kATcmUo6EW6LiYlqhk8zsdvQe/sNInydL5LgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;실제 피드백 내용... 더 많은 피드백이 있었다..&apos; title=&apos;&apos; src=&apos;/static/fe4345dbfe36a4add2a411a1606946ed/c0f59/3.png&apos; srcset=&apos;/static/fe4345dbfe36a4add2a411a1606946ed/e7570/3.png 170w,
/static/fe4345dbfe36a4add2a411a1606946ed/c0f59/3.png 251w&apos; sizes=&apos;(max-width: 251px) 100vw, 251px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;실제 피드백 내용... 더 많은 피드백이 있었다..&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;이전의 단순한 알고리즘으로는 모든 문서의 제목을 정확하게 추출하는 것은 힘들었다. 그리고 그것을 해결화는 과정에서 새로운 이슈도 발생했다.&lt;/p&gt;
&lt;h3 id=&quot;이슈-1--Bounding-Box가-분리되어-나오는-현상&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9D%B4%EC%8A%88-1--Bounding-Box%EA%B0%80-%EB%B6%84%EB%A6%AC%EB%90%98%EC%96%B4-%EB%82%98%EC%98%A4%EB%8A%94-%ED%98%84%EC%83%81&quot; aria-label=&quot;이슈 1  Bounding Box가 분리되어 나오는 현상 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;이슈 1 : Bounding Box가 분리되어 나오는 현상&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NAVER CLOVA OCR&lt;/code&gt; 을 통해 이미지 혹은 PDF 파일에 대해 OCR 처리를 하게 되면 하나의 문장에 대해 정확하게 OCR 되는 경우도 있지만, 하나의 문장이라도 여러 단어와 조사 등으로 나뉘어 OCR 되는 경우가 있었다. &lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 312px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/f94e341cf2d1a7bbcb3478d946d31d94/f00bc/2.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 28.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEklEQVR42nWQS0vDUBCF83/dSjdutNhSS9qGiM1D0RRsUTfeWmxQtOLK2Gt8NEmlxCRQTXyhIqjRPOZ6XalYh7M4fOfMYoYh/w389jAiYuzEMKNuL9SsCFsf2Iqxm/T9xDPjrhEeUnie6FT9+MiiivDZmzZITy4SI4WU4bRcRWQL4vTWwSansFl2srKbr9+KE7MZfrFcWijKK9WOvl2t80Ux39pfLwi55WZtqp0JySszb5YanaXanqwaSFL5Jl5rWDJ6UMalsfYpUk2E9FUaKTuS0OKon9soqz0kHM+80+V7CC7B9okzTO0APB+cJ3L3As8BcX3iBuBegzcE+wocSmgzIB4tP8LN183f//ipkfBP5xPEhTMcuc3pcgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;분리되어 나오는 Bounding Box&apos; title=&apos;&apos; src=&apos;/static/f94e341cf2d1a7bbcb3478d946d31d94/f00bc/2.png&apos; srcset=&apos;/static/f94e341cf2d1a7bbcb3478d946d31d94/e7570/2.png 170w,
/static/f94e341cf2d1a7bbcb3478d946d31d94/f00bc/2.png 312w&apos; sizes=&apos;(max-width: 312px) 100vw, 312px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;분리되어 나오는 Bounding Box&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;위 이미지의 경우, &lt;code class=&quot;language-text&quot;&gt;안전 관리 실무자 선임 문서&lt;/code&gt; 가 제목이지만, 초기의 단순한 알고리즘을 통해 제목을 추출하면 &lt;code class=&quot;language-text&quot;&gt;안전 관리&lt;/code&gt; 혹은 &lt;code class=&quot;language-text&quot;&gt;실무자 선임 문서&lt;/code&gt; 중 하나만 제목으로 채택된다. 그래서 만약 Bounding Box가 분리되어 온다면 한 문장인 경우 서로 병합하여 계산할 필요가 있었다.&lt;/p&gt;
&lt;h4 id=&quot;인접한-Bounding-Box-병합하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9D%B8%EC%A0%91%ED%95%9C-Bounding-Box-%EB%B3%91%ED%95%A9%ED%95%98%EA%B8%B0&quot; aria-label=&quot;인접한 Bounding Box 병합하기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;인접한 Bounding Box 병합하기&lt;/h4&gt;
&lt;p&gt;앞서 이야기 했듯이 OCR 결과는 Bounding Box로 주어진다. 그리고 그 Box에는 &lt;code class=&quot;language-text&quot;&gt;좌・상단&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;좌・하단&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;우・상단&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;우・하단&lt;/code&gt; 좌표를 기반으로 만들어진다. 이 점을 이용하여 각 Box의 높이와 폭을 구할 수 있고, 이를 기반으로 인접한 다른 Bounding Box에 대한 거리 혹은 크기의 차이를 계산할 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 312px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/f94e341cf2d1a7bbcb3478d946d31d94/f00bc/2.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 28.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEklEQVR42nWQS0vDUBCF83/dSjdutNhSS9qGiM1D0RRsUTfeWmxQtOLK2Gt8NEmlxCRQTXyhIqjRPOZ6XalYh7M4fOfMYoYh/w389jAiYuzEMKNuL9SsCFsf2Iqxm/T9xDPjrhEeUnie6FT9+MiiivDZmzZITy4SI4WU4bRcRWQL4vTWwSansFl2srKbr9+KE7MZfrFcWijKK9WOvl2t80Ux39pfLwi55WZtqp0JySszb5YanaXanqwaSFL5Jl5rWDJ6UMalsfYpUk2E9FUaKTuS0OKon9soqz0kHM+80+V7CC7B9okzTO0APB+cJ3L3As8BcX3iBuBegzcE+wocSmgzIB4tP8LN183f//ipkfBP5xPEhTMcuc3pcgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;2&apos; title=&apos;&apos; src=&apos;/static/f94e341cf2d1a7bbcb3478d946d31d94/f00bc/2.png&apos; srcset=&apos;/static/f94e341cf2d1a7bbcb3478d946d31d94/e7570/2.png 170w,
/static/f94e341cf2d1a7bbcb3478d946d31d94/f00bc/2.png 312w&apos; sizes=&apos;(max-width: 312px) 100vw, 312px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;위 이미지를 기준으로 설명해보자면, &lt;code class=&quot;language-text&quot;&gt;안전 관리&lt;/code&gt; Box를 &lt;code class=&quot;language-text&quot;&gt;Prev Box&lt;/code&gt;라고 지칭하고, &lt;code class=&quot;language-text&quot;&gt;실무자 선임 문서&lt;/code&gt; Box 가 비교 대상이 된다. 이 둘을 같은 그룹으로 묶는 (같은 문장이라고 판단하는) 기준은 &lt;code class=&quot;language-text&quot;&gt;안전 관리&lt;/code&gt; Box에 대한 Width 및 Height를 기준으로 인접한 범위로 들 수 있는 범위를 정하고, 적절한 가중치를 더한다. &lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 312px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/0bb7a6c246631886462784823377719d/f00bc/4.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 28.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAu0lEQVR42qWQwQqCQBCGff+gDt6lTdtdMExLojAv4q7Juh46+AxJ57rUzrZtIEEdgj4GZhj+geFzQGtTSikAUBYzaLsZAMtnxtGmKaXfgbuGm/4Bp+e8cd0pQlJKjOezgAgWX/sdJQEmFGOcpmnXdVEUUUrruvY8L89zxtjz+NQ0R0KWcSzbdhGGq/VGHraXM5+MR1m2L8uyKAohRJIkCCFz4/t+VVWcc/v2HzgvFYMSK8MogK+2hoyymh5Ol0bL/hcGiAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;4&apos; title=&apos;&apos; src=&apos;/static/0bb7a6c246631886462784823377719d/f00bc/4.png&apos; srcset=&apos;/static/0bb7a6c246631886462784823377719d/e7570/4.png 170w,
/static/0bb7a6c246631886462784823377719d/f00bc/4.png 312w&apos; sizes=&apos;(max-width: 312px) 100vw, 312px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;쉽게 설명해보자면, 위 이미지에서 빨간색 영역은 &lt;code class=&quot;language-text&quot;&gt;안전 관리&lt;/code&gt; Box의 &lt;code class=&quot;language-text&quot;&gt;Width 20%&lt;/code&gt; 에 해당하는 영역이다. 그리고 해당 &lt;code class=&quot;language-text&quot;&gt;안전 관리&lt;/code&gt; Box의 범위를 끝에서 &lt;code class=&quot;language-text&quot;&gt;빨간색 영역&lt;/code&gt; 만큼 인접한 Bounding Box를 탐색한다. 여기서 노란색 박스가 실제 인접한 Bounding Box가 있는지 탐색하는 영역 범위이다. &lt;/p&gt;
&lt;p&gt;노란색 영역에 다른 Bounding Box가 있다면 그것은 서로 인접해있다는 의미이고, 같은 그룹 (같은 문장)으로 묶어도 된다는 의미이다.&lt;/p&gt;
&lt;p&gt;결과적으로 &lt;code class=&quot;language-text&quot;&gt;안전 관리&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;실무자 선임 문서&lt;/code&gt; 2개의 Bounding Box를 하나로 합쳐 &lt;code class=&quot;language-text&quot;&gt;안전 관리 실무자 선임 문서&lt;/code&gt;의 Box를 새로 생성한다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/10836aa059a74e5d9d396a17025f3531/b3831/5.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 27.647058823529413%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVR42mWOUYuDMBCE8///TS0tFgptD1+riGKiURsQrCSoD6KiNmnXhDvk+pGHnezMMuitUZr3hn/yGzAgHVJGSKW2V8yHWS3LIqV8bQCJ9pZ1As7nn9vtcr3eXfdk29bOsu3j4XhIkhjCZVlijMMwTNOUUhpFUVEUvu8jgkkSx0EQUJoSQmABDrA6jpNlmRAcwpzzruvGcRyGoe/7aZrMgP56rrWlVOtbB8M8z9CQMeZ5Xl3XlUYIAV3gIsrznLEHJhgaPquqaZv6l0bTtq2J8S8+lihMZ+a+Mt8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;alt text&apos; title=&apos;&apos; src=&apos;/static/10836aa059a74e5d9d396a17025f3531/ca1dc/5.png&apos; srcset=&apos;/static/10836aa059a74e5d9d396a17025f3531/e7570/5.png 170w,
/static/10836aa059a74e5d9d396a17025f3531/f46e7/5.png 340w,
/static/10836aa059a74e5d9d396a17025f3531/ca1dc/5.png 680w,
/static/10836aa059a74e5d9d396a17025f3531/02d09/5.png 1020w,
/static/10836aa059a74e5d9d396a17025f3531/9d567/5.png 1360w,
/static/10836aa059a74e5d9d396a17025f3531/b3831/5.png 3342w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;alt text&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;기존에는 위와 같은 문서 제목을 &lt;code class=&quot;language-text&quot;&gt;안전보건교육일지 결 작성 검 토 승 인&lt;/code&gt; 으로 인식되었다. 하지만 해당 병합 방식을 적용하고나서는 &lt;code class=&quot;language-text&quot;&gt;안전보건교육일지&lt;/code&gt; 로 정확하게 인식되었다. &lt;/p&gt;
&lt;p&gt;결국 이러한 병합 방식에서 중요한 것은 인접한 &lt;code class=&quot;language-text&quot;&gt;Bounding Box&lt;/code&gt; 를 탐색하는 범위를 어느 정도로 할 것이냐가 제일 중요하다.&lt;/p&gt;
&lt;p&gt;이 부분에 대해서 &lt;code class=&quot;language-text&quot;&gt;Silver Bullet&lt;/code&gt; 은 찾을 수 없다. 문서 크기에 대해서도 고려해야 하고, 길이와 높이에 대해서도 고려해보아야 한다. 결국 여러 가지 문서를 받아보고, 추출하면서 가중치를 조절하면서 통상적으로 많은 문서를 처리할 수 있는 가중치를 찾아야 한다.&lt;/p&gt;
&lt;p&gt;실제로 해당 기능을 고도화 하기 위해 긴 시간을 들여 가중치를 조절하며 최적의 값을 찾아나갔다. &lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 272px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/e092bd91f23f08ed3bc7e22873215a45/0a1dc/6.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 141.76470588235293%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAAsTAAALEwEAmpwYAAACrElEQVR42mWVx5IiMRBE+f+f4cARLgwQHPA0ZvAeFhbP4AKY2ddKoe7drQgqStmqUpaRiPyE5PstzpYR/hreH/n5T6rVaiwWQ5fL5Wg0OhgMEolEPB4PBwqcgV6vF8Zut1utVs1mM5VKNRoNz/OSyWSv18vlctls9reRcIiIo4QejUaZTAaHdDrdarUKhcKHkXa7XalUOBz8X+fL5fJlBON4PJ5OJy33+/12uz2fz9iHw0E4S/bcbjffGcIQ63a7nU6n3++jWXKsEIHD4ZDMQaCAJq/pdGqdgcjw0whGvV7nMzYh0IoF3jICQixYWGfyUXkw+IZzrVbzjFBw2RjgaOKCLBYL6wwxWHECJKmZSGKgsX8ZoQs4TCYTNJwpQeAMc5zREHNps8R5uVzKeb1eY8/nc/ypnO/8fD7hDBOmAkowLBaLSsFRLZVKDmdJCzebje9M0zinYUR1knAsEZtGukZUVHGkqdZ5PB67JEmBJbmh2QSI7hshBUIMjWjUfNrEI7yKrD6ppCRC5vDXV1FTRygBp9o+k4w6jHYUOEeNECIubCbh6/XqO/ObzWagNED7VFh2cE8YTxgypyzBsQGxbbU5eWBEDUPDSsOoc6DKUgafwMmF8bY5e28hSZizg4Q1nsIBdb3dtMHlryHRmRpd1xL8wWG7NrJ5i+6/70yeYyPswwFDFXKlQjNVlGb6lvv9bmkTXn3SrdCoAYIwquqQWqi8wKl20Gf5s89NpQJpznRndCUpGOP9eDzshDFP6idaIyXOmjyWZKtuIdg8JjZnTtbjoPukxwTRM8DhIHzVYwARcNgRwjqHL5DuUz6f5yaRITdJnVOTpKETvGHEJiqQO1npubfNibvwwcUgN82TG2m9IZozfRJIdSCMp31JKNjdCEzCRngpwVaR3T/GHypQ1BLFGpN7AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;두 줄로 이루어진 제목의 문서 예시&apos; title=&apos;&apos; src=&apos;/static/e092bd91f23f08ed3bc7e22873215a45/0a1dc/6.png&apos; srcset=&apos;/static/e092bd91f23f08ed3bc7e22873215a45/e7570/6.png 170w,
/static/e092bd91f23f08ed3bc7e22873215a45/0a1dc/6.png 272w&apos; sizes=&apos;(max-width: 272px) 100vw, 272px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;두 줄로 이루어진 제목의 문서 예시&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;추가적으로 여러 줄에 걸쳐 구성된 제목의 문서도 X좌표 상에서 인접한 Bounding Box를 찾는 것처럼 Y좌표 상에서 인접한 Bounding Box를 탐색하는 방법으로 여러 줄에 걸친 제목을 병합할 수 있었다.&lt;/p&gt;
&lt;h3 id=&quot;이슈-2--제목-후보-별-점수-스코어링&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9D%B4%EC%8A%88-2--%EC%A0%9C%EB%AA%A9-%ED%9B%84%EB%B3%B4-%EB%B3%84-%EC%A0%90%EC%88%98-%EC%8A%A4%EC%BD%94%EC%96%B4%EB%A7%81&quot; aria-label=&quot;이슈 2  제목 후보 별 점수 스코어링 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;이슈 2 : 제목 후보 별 점수 스코어링&lt;/h3&gt;
&lt;p&gt;두 번째 문제는 바로 문서의 제목이 바로 다양한 위치에 있을 수 있다는 것이었다. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;PPT&lt;/code&gt; 기반으로 작성한 문서의 경우 제목은 중간에 위치해있고, &lt;code class=&quot;language-text&quot;&gt;Word&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Hwp&lt;/code&gt; 를 통해 작성한 문서는 대부분 상단 중앙에 위치해있다. &lt;/p&gt;
&lt;p&gt;이런 모든 케이스를 고려하여 애플리케이션 로직으로만 해결하는 것은 매우 해결하기 어려웠다. 그래서 여러가지 요소들을 종합해서 문장 후보를 선별하고, 그 기준을 통해 점수를 도입하기로 했다.&lt;/p&gt;
&lt;p&gt;각각 평가하고자 하는 요소들은 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;위치&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;크기&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;길이&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;각 세부 요소에 대해서 어떤식으로 기준을 잡았는지에 대해서는 이야기 할 수 없지만, 각각의 문장들을 위치, 크기, 길이에 대해서 제목과 유사한 특징을 가질 수록 높은 점수를 주고 가장 점수가 높은 문장을 제목으로 선정하는 방식이다.&lt;/p&gt;
&lt;p&gt;좀 더 설명해보자면, 3가지의 &lt;code class=&quot;language-text&quot;&gt;위치&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;크기&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;길이&lt;/code&gt; 중 제목으로서 가장 중요하게 평가하는 항목이 있고, 가장 덜 중요한 항목이 있다. &lt;/p&gt;
&lt;p&gt;예를 들어 문서 하단에 제목이 위치하는 문서라고 가정해보자. 만약 위치에 대해 중앙 상단을 중점으로 문서의 제목을 결정한다면 실제 제목이 하단에 존재하더라도, 부가 정보를 중앙 상단에 적어놓았더라면 부가 정보가 제목으로 선정된다. &lt;/p&gt;
&lt;p&gt;이는 잘못된 방식이다. &lt;/p&gt;
&lt;p&gt;이런 케이스를 고려하기 위해서 각 항목마다 적절한 가중 점수를 부여하고, 각 특징에 대해서 점수를 부여하는 방법이다. 중요한 것은 각각의 가중치이라고 할 수 있다. 이는 내부에 정해진 문서 데이터를 기반으로 결정했다.&lt;/p&gt;
&lt;h3 id=&quot;결과&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B2%B0%EA%B3%BC&quot; aria-label=&quot;결과 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;결과&lt;/h3&gt;
&lt;p&gt;두 가지 이슈를 해결하니, 기존에 준비한 수많은 테스트 문서에 대해 대부분 정확히 제목을 인식할 수 있었다. OCR 상에서 정확하게 특정할 수 없는 &lt;code class=&quot;language-text&quot;&gt;특수문자(./])&lt;/code&gt; 에 대한 이슈가 살짝 있었지만&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;대체적으로 성공적인 제목 추출을 보여줬고, 기존에 준비한 100여개의 테스트 문서 중 90% 이상의 제목 추출 정확도를 확인할 수 있었다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;회사에서 진행한 프로젝트의 내용이기 때문에 상세한 내용은 이야기 못해서 아쉽지만, 처음에 한계라고 느꼈던 이슈를 긴 시간 동안의 점진적 개선을 통해 해결한 케이스이기 때문에 소중한 경험이라고 생각하고 있다.&lt;/p&gt;
&lt;p&gt;추가적으로 LLM을 이용하면 더 정확한 제목을 추출할 수 있다.&lt;/p&gt;
&lt;p&gt;그럼 초기부터 LLM을 쓰면 되지 않느냐 라고 생각할 수 있겠지만, 어떠한 기술이나 솔루션을 도입할 때 &lt;code class=&quot;language-text&quot;&gt;Trade Off&lt;/code&gt; 를 항상 생각해봐야 한다. &lt;/p&gt;
&lt;p&gt;서비스 기획 및 개발 초기 당시, LLM을 활용한 제목 추정 기능은 벤처성으로 기획된 프로젝트이기 때문에 계획되지 않았지만, 이후 챗봇 개발 기획 등을 통해 도입할 수 있었다.&lt;/p&gt;
&lt;p&gt;또한 LLM은 Token을 기반으로 비용을 책정하기 때문에, 위 알고리즘을 통해 LLM에 넘기는 파라미터의 Token 수를 줄여 비용 절감을 할 수 있다는 장점으로 이어진다. &lt;/p&gt;
&lt;p&gt;기능이 들어간 서비스의 제목 추출 기능은 현재도 문제 없이 잘 돌아가고 있다. 😀&lt;/p&gt;</content:encoded></item><item><title><![CDATA[문자열이 자소분리가 되어 DB 저장되는 이슈 해결]]></title><description><![CDATA[기존 운영 서비스에서 업로드 된 파일명을 WHERE 조건을 걸어 조회 해야하는 일이 생겼다.
테스트 목적으로 로컬에서 파일을 업로드 하고 조건절에 파일 명을 걸어, SQL…]]></description><link>https://jindaram.site/nfd-nfc/</link><guid isPermaLink="false">https://jindaram.site/nfd-nfc/</guid><pubDate>Tue, 08 Jul 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;기존 운영 서비스에서 업로드 된 파일명을 WHERE 조건을 걸어 조회 해야하는 일이 생겼다.&lt;br&gt;
테스트 목적으로 로컬에서 파일을 업로드 하고 조건절에 파일 명을 걸어, SQL을 날렸는데 분명 동일한 파일 제목인데도 불구하고 조회 결과에 포함되지 않는 문제가 생겼다.&lt;br&gt;&lt;/p&gt;
&lt;p&gt;그러던 중 DB 컬럼 값을 자세히 살펴보니 다음과 같은 기이한 현상이 발생하였다.&lt;br&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/static/1-62f8cfa4af69fd379f77044275a6f044.gif&quot; alt=&quot;비정상적인 상황&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/static/2-e70a1a46a0c1fc737b6c430449e9cac1.gif&quot; alt=&quot;정상적인 상황&quot;&gt;
&lt;br&gt;
정리하자면, 파일명이 자소분리가 된 형태로 DB에 저장되는 아주 당황스러운 상황이 발생했다.&lt;/p&gt;
&lt;h2 id=&quot;원인-분석&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9B%90%EC%9D%B8-%EB%B6%84%EC%84%9D&quot; aria-label=&quot;원인 분석 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;원인 분석&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;Naver OCR의 추정값이 원인인지, DB 인코딩이 원인인지, 처음엔 원인을 몰라서 헤매다가, 여러 가지 상황에서 테스트를 해봤다. &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;기존에 발생한 버그인가?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;기존에는 발생했어도 방법을 찾을 수가 없었다. 저 컬럼의 이름은 originalName 이라는 컬럼인데, 해당 값은 그냥 저장 할 뿐 비즈니스 로직에서 사용하지는 않았다. 그래서 기존에 어떤 형식으로 저장되는지 확인할 수 없었다.&lt;/p&gt;
&lt;p&gt;현상이 최초 발생한 경로는 로컬에서 띄운 Spring Boot의 Swagger API Docs에 접근해서 API를 날린 상태이다. 그 후 개발 서버에 접근해서 클라이언트를 통해 API를 요청했다. &lt;/p&gt;
&lt;p&gt;로컬 서버 버전에서 문제가 생기거나, 로컬 환경과 밀접하여 문제가 생긴 것으로 판단했지만, 개발 서버 클라이언트를 통해 API를 날렸을 때, 동일한 문제가 발생하여 서버의 문제는 아닌 것으로 판단되었다. &lt;/p&gt;
&lt;p&gt;그런 후 브라우저에 관한 문제인가 싶어서, &lt;strong&gt;Safari를 통해 업로드 해봤다.&lt;/strong&gt; 그러자 정상적으로 DB에 데이터가 올라간 것을 확인할 수 있었다.&lt;/p&gt;
&lt;h2 id=&quot;Safari에선-정상적으로-업로드가-이루어지는-기이한-현상&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Safari%EC%97%90%EC%84%A0-%EC%A0%95%EC%83%81%EC%A0%81%EC%9C%BC%EB%A1%9C-%EC%97%85%EB%A1%9C%EB%93%9C%EA%B0%80-%EC%9D%B4%EB%A3%A8%EC%96%B4%EC%A7%80%EB%8A%94-%EA%B8%B0%EC%9D%B4%ED%95%9C-%ED%98%84%EC%83%81&quot; aria-label=&quot;Safari에선 정상적으로 업로드가 이루어지는 기이한 현상 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Safari에선 정상적으로 업로드가 이루어지는 기이한 현상&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;여러 원인을 찾아보던 도중, NFC와 NFD 에 대해 알게 되었고, 이것과 밀접한 관련이 있음을 깨닫게 되었다.&lt;/p&gt;
&lt;h3 id=&quot;NFC와-NFD&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#NFC%EC%99%80-NFD&quot; aria-label=&quot;NFC와 NFD permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;NFC와 NFD&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;Mac 사용자들이라면 가끔 파일 이름이 다음과 같이 저장된 것을 본 경험이 있을 것이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;ㅇㅣㄱㅓㅅㅇㅡㄴ ㅇㅣㄹㅂㅏㄴ ㅁㅜㄴㅅㅓㅇㅣㅁ.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;원래라면 다음과 같은 제목인데 말이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;이것은 일반 문서임.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이러한 차이를 알기 위해서 &lt;strong&gt;NFD (Normalize From Decomposed&lt;/strong&gt;) 과 &lt;strong&gt;NFC(Normalize From Composed)&lt;/strong&gt; 에 대해서 알아두어야 한다.&lt;/p&gt;
&lt;h3 id=&quot;NFC-Normalize-From-Composed&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#NFC-Normalize-From-Composed&quot; aria-label=&quot;NFC Normalize From Composed permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;NFC (Normalize From Composed)&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;사람이 보는 글자와 같다. 즉 하나의 문자로 합쳐진 형태이다.
&lt;code class=&quot;language-text&quot;&gt;가&lt;/code&gt; 라는 문자가 있을 때, 이를 &lt;code class=&quot;language-text&quot;&gt;U+AC00&lt;/code&gt; 으로 표현한다.&lt;/p&gt;
&lt;h3 id=&quot;NFD-Normalization-Form-Decomposed&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#NFD-Normalization-Form-Decomposed&quot; aria-label=&quot;NFD Normalization Form Decomposed permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;NFD (Normalization Form Decomposed)&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;하나의 글자를 초성/중성/종성 등으로 분리한 형태이다.
&lt;code class=&quot;language-text&quot;&gt;가&lt;/code&gt; 라는 문자가 있을 때, 이를 &lt;code class=&quot;language-text&quot;&gt;ㄱ&lt;/code&gt; + &lt;code class=&quot;language-text&quot;&gt;ㅏ&lt;/code&gt; 로 분리하여 정규화한다.&lt;/p&gt;
&lt;p&gt;Mac OS 에서 한글로 이루어진 파일명을 저장했을 때, 자소 분리가 되어 저장된 것은 Mac OS 에서 기본적으로 NFD 유니코드 정규화 방식을 사용하기 때문이다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[!NOTE]
Windows 운영체제는 기본적으로 NFD 유니코드 정규화 방식을 사용한다고 한다.
&lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/intl/using-unicode-normalization-to-represent-strings&quot;&gt;참조 문서&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;MacOS--Safari--MacOS--Chrome&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#MacOS--Safari--MacOS--Chrome&quot; aria-label=&quot;MacOS  Safari  MacOS  Chrome permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;MacOS + Safari / MacOS + Chrome&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;본론으로 돌아와서, MacOS 에서 기본적으로 NFD 정규화 방식을 사용하는 것을 알게 되었다. 다만 Safari로 업로드를 진행 했을 땐, 왜 정상적으로 DB에 값이 저장되는 것일까?&lt;/p&gt;
&lt;p&gt;그 이유는 Safari 에서는 모든 POST 요청을 NFC 방식으로 인코딩하여 보내기 때문이다. &lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://bugs.webkit.org/show_bug.cgi?id=30387&amp;#x26;utm_source=chatgpt.com&quot;&gt;https://bugs.webkit.org/show_bug.cgi?id=30387&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;해당 글에서 명시적으로 Safari가 &lt;code class=&quot;language-text&quot;&gt;NFC normalization&lt;/code&gt; 으로 요청을 보낸다고 한다. 그렇기 때문에 NFD 기반의 Mac OS에서도 우리가 원하는 형태인 &lt;code class=&quot;language-text&quot;&gt;ㄱㅏ&lt;/code&gt; 가 아닌 &lt;code class=&quot;language-text&quot;&gt;가&lt;/code&gt; 의 형태로 데이터를 받을 수 있는 것이다.&lt;/p&gt;
&lt;p&gt;반면 Chrome은 OS의 유니코드 정규화 방식을 따르기 떄문에 Chrome으로 파일을 업로드 할 경우 DB에 Mac OS의 유니코드 정규화 방식은 NFD 문자열로 데이터가 저장되는 것이다.&lt;/p&gt;
&lt;h2 id=&quot;해결-방법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95&quot; aria-label=&quot;해결 방법 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;해결 방법&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;문제의 원인을 찾았으니, 해결 방법을 알아봤다. 광징히 간단하게 해결할 수 있었다.
java.text 에 존재하는  Normalization을 지원하는 라이브러리가 존재하여 해당 Normalizer에 normalize 함수를 통해 NFC 형태로 유니코드 정규화를 처리할 수 있었다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// NFD 기반 문자열&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; nfc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Normalizer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;normalize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Normalizer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Form&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;NFC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;적용한 후 Chrome을 통해 데이터를 업로드하니 NFC 정규화 상태로 저장된 것을 확인할 수 있다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[실무에서 쿼리 플랜을 통한 성능 개선 경험 (feat. 134배 향상)]]></title><description><![CDATA[네이버에서 가장 많이 방문하는 주소는 뭘까요?  보통 https://naver.com 으로 접속하는 경우가 가장 많습니다. 그렇기 때문에 메인 페이지 접속 시 호출되는 API…]]></description><link>https://jindaram.site/query-plan-analysis/</link><guid isPermaLink="false">https://jindaram.site/query-plan-analysis/</guid><pubDate>Tue, 17 Jun 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://naver.com&quot;&gt;네이버&lt;/a&gt;에서 가장 많이 방문하는 주소는 뭘까요? &lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.semrush.com/website/top/south-korea/all/&quot;&gt;보통 https://naver.com 으로 접속하는 경우가 가장 많습니다.&lt;/a&gt; 그렇기 때문에 메인 페이지 접속 시 호출되는 API가 느리다면 사용자 경험에 큰 영향을 줄 수밖에 없습니다.&lt;/p&gt;
&lt;p&gt;실무에서 개발한 서비스도 메인 페이지에서 여러 API를 호출하고 있었고, 단순 캐싱 수준을 넘어 쿼리 플랜에 대한 분석을 통해 개선한 경험을 소개드리려고 합니다. &lt;/p&gt;
&lt;h2 id=&quot;피드-API-개선&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%94%BC%EB%93%9C-API-%EA%B0%9C%EC%84%A0&quot; aria-label=&quot;피드 API 개선 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;피드 API 개선&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;성능을 실질적으로 개선하기 전에 문제의 원인을 분석해볼 수 있는 방법 중 하나가 데이터베이스로 전달되는 쿼리를 분석하는 것 입니다. 데이터베이스로 전달된 쿼리가 옵티마이저에 의해 어떤 실행 계획을 가지고 데이터를 찾았는지 알게 된다면 쿼리 개선에 도움이 될 수 있습니다. &lt;/p&gt;
&lt;p&gt;&lt;em&gt;(쿼리를 보기 좋게 다듬은 결과이며, Spring Boot 기준 Hibernate 에 의해 생성된 쿼리가 전송되기 때문에 아래 쿼리 플랜과 비교하여 Alias 와 같은 차이점은 있으나, 구조는 동일합니다.)&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; article a
	&lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;OUTER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; article_tag tag1 &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tag1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;article_id
	&lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;OUTER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; article_tag tag2 &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; tag1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tag_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tag2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ? &lt;span class=&quot;token operator&quot;&gt;OR&lt;/span&gt; tag2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ? &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;category_id &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; ?&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ?&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_deleted &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ?
	&lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_block &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ?
&lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 쿼리는 병목이 발생한다고 여겨지는 쿼리입니다. 해당 쿼리를 분석하기 위해 &lt;code class=&quot;language-text&quot;&gt;PostgreSQL&lt;/code&gt; 기준 &lt;code class=&quot;language-text&quot;&gt;EXPLAIN ANALYZE&lt;/code&gt; 구문을 추가해주도록 합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; article a
	&lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;OUTER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; article_tag tag1 &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tag1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;article_id
	&lt;span class=&quot;token keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;OUTER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; article_tag tag2 &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; tag1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tag_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tag2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ? &lt;span class=&quot;token operator&quot;&gt;OR&lt;/span&gt; tag2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ? &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;category_id &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; ?&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ?&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_deleted &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ?
	&lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_block &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ?
&lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/0e50d055870fdc35fc654b009434bb97/cb866/query-plan-result.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 45.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABIUlEQVR42mWSW5aEIAxE3Y1vUREBEV/731OGikLrmY/qRGwuVZHMWEvLspD3nuZ5JiklTdNEs1KkgtBDsUdt25aKoqCyLD+qqooyIQTDtm3jqvXMG4e+J7zrQx2GgWvshegS4K26rilDs66ejuNgKHpUaxd2O45jgv2Agtebpv64Y2Ce5xz1uq4E3fednHPJbde1Qd0/NU3D8SEAAc7wgwWOHbQHIKDGmFvWMNyGWePZPjPH2lt4h0Q3MJzk3Jo2YgMqnMcPBSEuosI13L3jfmYIaa3D/H5Q5xZa/crrgEgZdYPjfAGJcRMQD5gJXG6b5xkienQK6ScuDuD42gSn8jls4g/G1+b92fFnH1xinnCKep5nuqNKzXwP7159rlR0+gdYHB+DZsGp7AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;query plan result&apos; title=&apos;&apos; src=&apos;/static/0e50d055870fdc35fc654b009434bb97/ca1dc/query-plan-result.png&apos; srcset=&apos;/static/0e50d055870fdc35fc654b009434bb97/e7570/query-plan-result.png 170w,
/static/0e50d055870fdc35fc654b009434bb97/f46e7/query-plan-result.png 340w,
/static/0e50d055870fdc35fc654b009434bb97/ca1dc/query-plan-result.png 680w,
/static/0e50d055870fdc35fc654b009434bb97/02d09/query-plan-result.png 1020w,
/static/0e50d055870fdc35fc654b009434bb97/cb866/query-plan-result.png 1056w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;처음 본다면 다소 당황스러울 수 있습니다. 그래서 가장 먼저 읽는 순서를 알아야 합니다. 그래야 어떤 방식으로 데이터를 조회하는지에 대한 쿼리 실헹 계획을 알아갈 수 있습니다. 실행 계획이 조금 길기 때문에 여러 구역으로 분리해서 알아보도록 합니다.&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/07ab5699eee14ef4d80aff3e7f32971d/7f607/divide-query-result.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 45.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVR42lXNWW+CQBQFYP5SW43swqDDAKIs1idtWn2o7JuKpn++h442bfLl5jDMuSOcdP1sGD0hrabVigKNqsKQVXyq/CSbTI6jUfJHOh4LhSiiebUIZqcP/UqWSmlQyTKUkohZSCJuJ+P/ZaJsVyyNvSJwMoTQzX16dMwDMw50+sHZxn6uvzNjbylvprwFIu+IshOeponstCS4Gct+6l8wVbeTWCPa9YjkI5L9uIcXMx0myZ7N9NlIBOXT1RKPNmtg3cZuX60qnFUR4GRex7M6mtUxAr9D2wH+mvlKUAuqlYz2oX0N6SVAmF9W1skHs/V+kW6hlwyXOa20QVBzG+bngF1j1sf0Etp9hIwT0vikXT4g+2bja4Wj5Yy3hrKSUb10nNsa3K+Ne1uzPsIKLMIKmJ1WPJNmYdSe2SymlXsvc1a7tB8d/jgmXrO6JYfMm8Bf/gZI0qzfrn2yKAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;divide query result&apos; title=&apos;&apos; src=&apos;/static/07ab5699eee14ef4d80aff3e7f32971d/ca1dc/divide-query-result.png&apos; srcset=&apos;/static/07ab5699eee14ef4d80aff3e7f32971d/e7570/divide-query-result.png 170w,
/static/07ab5699eee14ef4d80aff3e7f32971d/f46e7/divide-query-result.png 340w,
/static/07ab5699eee14ef4d80aff3e7f32971d/ca1dc/divide-query-result.png 680w,
/static/07ab5699eee14ef4d80aff3e7f32971d/02d09/divide-query-result.png 1020w,
/static/07ab5699eee14ef4d80aff3e7f32971d/9d567/divide-query-result.png 1360w,
/static/07ab5699eee14ef4d80aff3e7f32971d/7f607/divide-query-result.png 2112w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;초록색-구역&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B4%88%EB%A1%9D%EC%83%89-%EA%B5%AC%EC%97%AD&quot; aria-label=&quot;초록색 구역 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;초록색 구역&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;가장 먼저 &lt;code class=&quot;language-text&quot;&gt;초록색 구간&lt;/code&gt;에 대해 알아보는 이유는 보통 위에서 아래로 절차적으로 실행되는 것이라고 생각할 수 있겠지만 쿼리 플랜은 그렇지 않습니다. 각각의 작업들은 일련의 계층 구조를 가지며 부분적으로 절차적으로 진행됩니다. &lt;/p&gt;
&lt;p&gt;그 말은 즉, 어떠한 계층이 여러 하위 계층들을 가진다면 그 하위 계층들은 순차적으로 실행된다는 의미입니다. 각각의 계층은 화살표 (→) 로 구분되는데, &lt;code class=&quot;language-text&quot;&gt;파란색 계층&lt;/code&gt; 아래에는 2개의 계층이 존재합니다.&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/8b670ef5123a24704aff9cb9b1f20c66/7f607/blue-has-two-depth.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 45.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYUlEQVR42lXNa0+DMBQGYH6Tbhn3lRbawsZtTD+pUfdlAwoUtsHin/dg1WjypHkLfc/Rzq57QWjEuHeczrKAtG0wZxuutvpSrVbHxeL0R7lcakLXR4IngqE/uHO/NY3GmLWmCRpDh1MYOrw+Lf+XPfMpYWWxEVlYpbzMozqmx9A7cHSg6zeFoffAfeXonVgv8B5g8xlbz9qSCGdzwdmEkmkdX1Ey2tFgcKmzboHrBa6+fId7r5xPXN155R06aUTkWGSBLJh84MMj6x9Im/vtDlC5D7rC73Z+V0CA66yfwV+vTrVgSP0hDsaMTTm9ZnTMg2tKzjHw+s0vPGzdhtuCKk7DgOY2kSvC4JyF056PBb3mbNzxqQguGZYx7pMfkGNPxo4InZrbNQOaVVOrom4Thrc9iD4eoxtM2cEIGAQjgH9OVcZyi7qNJ7frNprLagYgfcJ+Omo5nLCNDIkCWTWB2vwJtoatRffJR+EAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;blue has two depth&apos; title=&apos;&apos; src=&apos;/static/8b670ef5123a24704aff9cb9b1f20c66/ca1dc/blue-has-two-depth.png&apos; srcset=&apos;/static/8b670ef5123a24704aff9cb9b1f20c66/e7570/blue-has-two-depth.png 170w,
/static/8b670ef5123a24704aff9cb9b1f20c66/f46e7/blue-has-two-depth.png 340w,
/static/8b670ef5123a24704aff9cb9b1f20c66/ca1dc/blue-has-two-depth.png 680w,
/static/8b670ef5123a24704aff9cb9b1f20c66/02d09/blue-has-two-depth.png 1020w,
/static/8b670ef5123a24704aff9cb9b1f20c66/9d567/blue-has-two-depth.png 1360w,
/static/8b670ef5123a24704aff9cb9b1f20c66/7f607/blue-has-two-depth.png 2112w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt; &lt;code class=&quot;language-text&quot;&gt;Seq Scan on article article0_&lt;/code&gt; 로 시작하는 작업은 첫 번째 하위 계층이기 때문에 가장 먼저 실행됩니다.
작업이 끝나면 다음 하위 계층인 &lt;code class=&quot;language-text&quot;&gt;Seq Scan on article_tag tags1_&lt;/code&gt; 작업이 실행됩니다.&lt;/p&gt;
&lt;p&gt;이제 번호를 통해 어떤 순서로 시작하는 지 감을 잡아보도록 하겠습니다.&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/6df5fd1a9aa54c872b12139f06d03800/7f607/query-plan-sequence.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 25.294117647058822%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0ElEQVR42lWPaRKCMAyFuRfigtJSBdkcL+GCogh47R4g5kXK6I/XZl6SL4kX1MaGTWpVX1jdlzZ+VzYeSqu6YlQuPvKInQ9P6nvUVzbiXPhIrTe/GtJtQVxEnCT1Kkh3JUVtTuvHXsQDaXVPvmoS9lJC3+ysJwWXWDzPPytSz5xihpjhINI/McAAOrgb4IYAAhig/kkxkJ9VvaOkP9KmzcjwlgBN275K+QGGNs/sG/MSAC5vO/kX9Vagnls5vKfSHOH8EQI5MPJ/p48QAB0MwA9FUMh2t/k0fAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;query plan sequence&apos; title=&apos;&apos; src=&apos;/static/6df5fd1a9aa54c872b12139f06d03800/ca1dc/query-plan-sequence.png&apos; srcset=&apos;/static/6df5fd1a9aa54c872b12139f06d03800/e7570/query-plan-sequence.png 170w,
/static/6df5fd1a9aa54c872b12139f06d03800/f46e7/query-plan-sequence.png 340w,
/static/6df5fd1a9aa54c872b12139f06d03800/ca1dc/query-plan-sequence.png 680w,
/static/6df5fd1a9aa54c872b12139f06d03800/02d09/query-plan-sequence.png 1020w,
/static/6df5fd1a9aa54c872b12139f06d03800/9d567/query-plan-sequence.png 1360w,
/static/6df5fd1a9aa54c872b12139f06d03800/7f607/query-plan-sequence.png 2112w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Filter&lt;/code&gt; 를 보면 조건절이 있습니다. Article 테이블을 &lt;code class=&quot;language-text&quot;&gt;Seq Scan (Full Scan)&lt;/code&gt; 하여 해당 조건에 적합한 &lt;code class=&quot;language-text&quot;&gt;article&lt;/code&gt; 데이터를 조회합니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;LEFT JOIN&lt;/code&gt; 을 위해 article_tag 테이블의 데이터를 스캔합니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;LEFT JOIN&lt;/code&gt; 을 위해 tag 테이블의 데이터를 스캔합니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;JOIN&lt;/code&gt; 을 위해 &lt;code class=&quot;language-text&quot;&gt;Hash Table&lt;/code&gt; 을 생성합니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;article_tag&lt;/code&gt; 테이블과 &lt;code class=&quot;language-text&quot;&gt;tag&lt;/code&gt; 테이블을 조인합니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;JOIN&lt;/code&gt; 을 하기 위한 &lt;code class=&quot;language-text&quot;&gt;Hash Table&lt;/code&gt; 을 생성합니다.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;파란색-구역&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%8C%8C%EB%9E%80%EC%83%89-%EA%B5%AC%EC%97%AD&quot; aria-label=&quot;파란색 구역 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;파란색 구역&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/45b04a5c94d72e570040e41f52ab2800/7f607/blue-section.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 8.823529411764705%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVElEQVR42mOwdSty9q108i4HIkevMle/KhffSjv3YqC4jWuRtUuBjWshkA1hAElTuyw4YrB0ynf2qQAioE4gAmqzcs43d8gxc8gxsk7HRMY2GXAEABCQJOR6kXQQAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;blue section&apos; title=&apos;&apos; src=&apos;/static/45b04a5c94d72e570040e41f52ab2800/ca1dc/blue-section.png&apos; srcset=&apos;/static/45b04a5c94d72e570040e41f52ab2800/e7570/blue-section.png 170w,
/static/45b04a5c94d72e570040e41f52ab2800/f46e7/blue-section.png 340w,
/static/45b04a5c94d72e570040e41f52ab2800/ca1dc/blue-section.png 680w,
/static/45b04a5c94d72e570040e41f52ab2800/02d09/blue-section.png 1020w,
/static/45b04a5c94d72e570040e41f52ab2800/9d567/blue-section.png 1360w,
/static/45b04a5c94d72e570040e41f52ab2800/7f607/blue-section.png 2112w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이제까지 기본적인 조건과 적합한 &lt;code class=&quot;language-text&quot;&gt;article&lt;/code&gt; 데이터를 조회했고, &lt;code class=&quot;language-text&quot;&gt;article_tag&lt;/code&gt; 테이블과 &lt;code class=&quot;language-text&quot;&gt;tag&lt;/code&gt; 테이블을 &lt;code class=&quot;language-text&quot;&gt;JOIN&lt;/code&gt; 한 &lt;code class=&quot;language-text&quot;&gt;Hash Table&lt;/code&gt; 을 생성했습니다. 그리고 &lt;code class=&quot;language-text&quot;&gt;파란색 구역&lt;/code&gt; 은 JOIN을 하게 되는 구간입니다.&lt;/p&gt;
&lt;p&gt;그 과정에서
&lt;code class=&quot;language-text&quot;&gt;article.user_id = ? OR tag.id = ?&lt;/code&gt;
조건절을 만족하는 레코드를 필터링 하게 됩니다. 이 과정을 &lt;code class=&quot;language-text&quot;&gt;파란색 구역&lt;/code&gt;에서 수행하게 됩니다.&lt;/p&gt;
&lt;h3 id=&quot;빨간색-구간&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%B9%A8%EA%B0%84%EC%83%89-%EA%B5%AC%EA%B0%84&quot; aria-label=&quot;빨간색 구간 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;빨간색 구간&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/c4ed62f8658aa4c73e2f92f71b95c442/7f607/red-section.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 11.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAUElEQVR42mMotrcvd3KqdHEpsbcvtLEpsLEpsrUFMkAIyACzgSI55uaZJibIKMvUlCHXwqLC2RmoucLJqdjOrsDaGigCVApH2TASTXOmqSkAn9sjQyxOZRgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;red section&apos; title=&apos;&apos; src=&apos;/static/c4ed62f8658aa4c73e2f92f71b95c442/ca1dc/red-section.png&apos; srcset=&apos;/static/c4ed62f8658aa4c73e2f92f71b95c442/e7570/red-section.png 170w,
/static/c4ed62f8658aa4c73e2f92f71b95c442/f46e7/red-section.png 340w,
/static/c4ed62f8658aa4c73e2f92f71b95c442/ca1dc/red-section.png 680w,
/static/c4ed62f8658aa4c73e2f92f71b95c442/02d09/red-section.png 1020w,
/static/c4ed62f8658aa4c73e2f92f71b95c442/9d567/red-section.png 1360w,
/static/c4ed62f8658aa4c73e2f92f71b95c442/7f607/red-section.png 2112w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;빨간색 구간은 그 이후에 있는 &lt;code class=&quot;language-text&quot;&gt;ORDER BY&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GROUP BY&lt;/code&gt; 를 수행하게 됩니다. &lt;/p&gt;
&lt;h3 id=&quot;성능-추적&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%84%B1%EB%8A%A5-%EC%B6%94%EC%A0%81&quot; aria-label=&quot;성능 추적 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;성능 추적&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;이제까지 유저 피드 조회 시에 실행되는 쿼리에 대해 분석해봤습니다. 이제 쿼리를 실행하게 되면 실제로 어떤 순서와 방법으로 데이터를 조회하는지 간략하게나마 알게되었고, 마지막에는 현재 테이블의 데이터를 기준으로 실행되는 쿼리의 시간을 알 수 있습니다. &lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 206px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/f955b43529ac4b1c613298a145cf4b85/56061/query-execution-time.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 27.647058823529413%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABSUlEQVR42j2Q23aCQAxF+RYFlgxIwaLghYtFC1hBQBRE7Gof6v//wWmYah9mnUn2JDkTwTQMyJKE4XAIiVSWZQwGA64T0+Tasz7HGINCZzwew5yYPBZFkXNR/KsV2qZG215R1zWSZI88S9F1VwSBjzDcoKoqXIinHztYlgXX83DIc9zvP9hu37Fev6G9NJhNp3yoINEEy5rCMA2arENlKjULYNOD3rGu6+Rm8u9WVTUYLwZ0ctm7HY0Uqn8FUxTuVNjT5OVyCc/14DgOojjGynWxWMxJPaTpHivige8TtxFFMXa7BL4fIC9KFIcMtj2DH6yphwvhfD6hu93o2y3KosDnrUPdtPzrjjNHWZbUNMP39xfiKEKa5UjiCHGS0JoaVMQ3YYiiPOJ8OkJQyKqqqnzBmqZBURi/s8fyn6zP97yPe32yZ8wefX4BxXzJTqQmSrwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;실제 쿼리 실행 시간은 Execution Time: 67.285ms&apos; title=&apos;&apos; src=&apos;/static/f955b43529ac4b1c613298a145cf4b85/56061/query-execution-time.png&apos; srcset=&apos;/static/f955b43529ac4b1c613298a145cf4b85/e7570/query-execution-time.png 170w,
/static/f955b43529ac4b1c613298a145cf4b85/56061/query-execution-time.png 206w&apos; sizes=&apos;(max-width: 206px) 100vw, 206px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;실제 쿼리 실행 시간은 Execution Time: 67.285ms&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;다만 우리가 궁금한 건 어떤 순서로 작업을 진행하는지가 아닙니다. 최종적으로 생성된 쿼리가 얼마나 효율적으로 높은 성능으로 데이터를 조회해오는지이고, 그렇지 못한다면 어떤 곳에서 성능적으로 유실이 많은 지 알아내는 것 입니다. &lt;/p&gt;
&lt;p&gt;다행히 쿼리 플랜에서 쉽게 병목 구간을 알아낼 수 있습니다. 쿼리 플랜을 보다 보면 &lt;code class=&quot;language-text&quot;&gt;cost&lt;/code&gt; 라는 것이 있다는 것을 알 수 있습니다. 이는 절대적 지표가 아닌, 해당 작업을 수행하는데 상대적인 비용이 얼만큼 들었느냐에 대한 지표입니다. &lt;/p&gt;
&lt;p&gt;그럼 가장 &lt;code class=&quot;language-text&quot;&gt;cost&lt;/code&gt; 가 높게 측정되는 구간은 어디일까요?&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/bbdb9dbdd02fa3178984861065dc6caa/7f607/high-cost-section.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 7.0588235294117645%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMElEQVR42mPQ0tLS09OztbWztbW1BwMrKysLMLC0tASS5ubmIDaMawkGZmZmhoaGAI9TDRdHebXXAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;high cost section&apos; title=&apos;&apos; src=&apos;/static/bbdb9dbdd02fa3178984861065dc6caa/ca1dc/high-cost-section.png&apos; srcset=&apos;/static/bbdb9dbdd02fa3178984861065dc6caa/e7570/high-cost-section.png 170w,
/static/bbdb9dbdd02fa3178984861065dc6caa/f46e7/high-cost-section.png 340w,
/static/bbdb9dbdd02fa3178984861065dc6caa/ca1dc/high-cost-section.png 680w,
/static/bbdb9dbdd02fa3178984861065dc6caa/02d09/high-cost-section.png 1020w,
/static/bbdb9dbdd02fa3178984861065dc6caa/9d567/high-cost-section.png 1360w,
/static/bbdb9dbdd02fa3178984861065dc6caa/7f607/high-cost-section.png 2112w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;해당 작업이 다른 작업들과 &lt;code class=&quot;language-text&quot;&gt;cost&lt;/code&gt; 를 비교했을 때, 가장 높은 &lt;code class=&quot;language-text&quot;&gt;cost&lt;/code&gt; 를 나타내고 있음을 알 수 있습니다. 또한 &lt;code class=&quot;language-text&quot;&gt;cost&lt;/code&gt; 정보 외에도, &lt;code class=&quot;language-text&quot;&gt;actrual time&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;rows&lt;/code&gt; 와 같은 간접적 지표를 통해 작업의 성능을 추측할 수 있습니다.&lt;/p&gt;
&lt;p&gt;위 작업에 대해 설명하자면, 기본적인 조건절을 통해 article 데이터를 조회한 결과, 64276개 달하는 데이터를 조회했습니다. 이는 &lt;code class=&quot;language-text&quot;&gt;Seq Scan (Full Scan)&lt;/code&gt; 이기 때문에 Index 를 타지 않고, 조회해온다는 것을 알 수 있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;category_id IN ( ?, ? )&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;is_deleted = false&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;is_blocked = false&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;정리하자면 위 조건들이 적용된 쿼리가 Article 테이블을 풀 스캔하여 64276개의 데이터를 조회하게 됩니다.
그리고 원래 쿼리의 조건절을 다시 보게 되면 위 조건절은 제외하고도 한 가지의 조건절이 더 포함되어 있습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;( a.user_id = ? OR t.id = ? )&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위 두 조건 모두 피드를 구분 짓는 중요한 조건들입니다. 전자는 &lt;code class=&quot;language-text&quot;&gt;팔로우 한 크리에이터들의 article&lt;/code&gt;을 구분지을 때 사용하는 조건절이고, 후자는 사용자가 등록한 &lt;code class=&quot;language-text&quot;&gt;관심 태그 ID&lt;/code&gt; 가 들어가는 조건입니다. 그리고 이 둘을 모두 포함하도록 &lt;code class=&quot;language-text&quot;&gt;OR 연산자&lt;/code&gt; 가 붙었습니다.&lt;/p&gt;
&lt;p&gt;즉 &lt;code class=&quot;language-text&quot;&gt;t.id = ?&lt;/code&gt; 이 구간 때문에 &lt;code class=&quot;language-text&quot;&gt;a.user_id&lt;/code&gt; 로 인덱스를 타려고 하지만 &lt;code class=&quot;language-text&quot;&gt;OR 연산자&lt;/code&gt; 때문에 &lt;code class=&quot;language-text&quot;&gt;t.id = ?&lt;/code&gt; 도 포함하는 Article도 가져와야 하기 때문에 인덱스를 타지 못하고, &lt;code class=&quot;language-text&quot;&gt;Table Full Scan&lt;/code&gt; 을 하게 되어 병목이 발생하게 됩니다.&lt;/p&gt;
&lt;p&gt;지금은 &lt;code class=&quot;language-text&quot;&gt;article&lt;/code&gt; 테이블의 전체 데이터 수가 6만여건 밖에 되자 않아, 별로 크게 성능을 저하시키지 않는 것처럼 보이지만, 데이터가 많아지게 되면 치명적입니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;각각 &lt;code class=&quot;language-text&quot;&gt;category_id&lt;/code&gt; , &lt;code class=&quot;language-text&quot;&gt;is_deleted&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;is_blocked&lt;/code&gt;  인덱스를 생성하면 되지 않을까?&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;하지만 해당 인덱스를 생성해도 결과는 똑같습니다. (복합 인덱스라면 이야기가 다를 수 있다.) &lt;code class=&quot;language-text&quot;&gt;PostgreSQL&lt;/code&gt; 은 조회하는 데이터가 해당 테이블의 많은 부분을 차지하면, Index가 아닌 Full-Scan을 통해 데이터를 조회합니다. (카디널리티가 낮으면 인덱스 효과가 떨어지기 때문에)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;그럼 쿼리 플랜을 통해 병목 구간을 확인했으니, 개선 방법을 알아봅시다.&lt;/p&gt;
&lt;h3 id=&quot;쿼리-개선&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%BF%BC%EB%A6%AC-%EA%B0%9C%EC%84%A0&quot; aria-label=&quot;쿼리 개선 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;쿼리 개선&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;위 쿼리를 실행하면 약 &lt;code class=&quot;language-text&quot;&gt;67ms&lt;/code&gt; 의  시간이 소요되었습니다. 전혀 길지 않은 실행시간이지만, 더 단축시키게 되면 많은 요청이 몰렸을 때나 데이터가 많아졌을 때, 하나의 트랜잭션 자체에 Connection을 물고 있는 시간을 개선 할 수 있습니다.&lt;/p&gt;
&lt;p&gt;아직 효율적인 쿼리 작성에 미숙하기에, 가장 빨리 데이터를 조회할 수 있는 방법을 선택했습니다.&lt;/p&gt;
&lt;p&gt;우선 해당 쿼리를 인덱스를 타는 방향으로 개선하는게 좋아보였습니다. 현재 쿼리는 너무나 많은 &lt;code class=&quot;language-text&quot;&gt;article&lt;/code&gt; 을 조회하기 때문에 적절한 개수의 &lt;code class=&quot;language-text&quot;&gt;article&lt;/code&gt; 을 조회하도록 개선이 필요했습니다. 즉 &lt;code class=&quot;language-text&quot;&gt;user_id&lt;/code&gt; 에 대한 &lt;strong&gt;인덱스&lt;/strong&gt;를 타게끔 유도해야 합니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;그래서 쿼리를 분리하기로 결정했습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;article_tag&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;tag&lt;/code&gt; 테이블을 조인하지 않고, &lt;code class=&quot;language-text&quot;&gt;user_id&lt;/code&gt; 처럼 유저가 가지고 있는 관심 태그를 기반한 &lt;code class=&quot;language-text&quot;&gt;article&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt; 를 인자로 받아서 다음과 같은 쿼리로 개선하기로 하였습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt;   article a
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ? &lt;span class=&quot;token operator&quot;&gt;OR&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ? &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;category_id &lt;span class=&quot;token operator&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; ?&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ? &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_deleted &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ?
       &lt;span class=&quot;token operator&quot;&gt;AND&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_block &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ?
&lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt;  &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt;  &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token keyword&quot;&gt;DESC&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;쿼리가 훨씬 간단해졌습니다. 이런식으로 쿼리를 튜닝하게 되면 &lt;code class=&quot;language-text&quot;&gt;user_id&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt; 가 Index를 타게 되어, 전보다 훨씬 빠른 속도로 데이터를 조회하게 되어, 성능이 향상됩니다. 이 결과 역시 쿼리 플랜을 통해 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/f1eca4cc692652b7660fad5cce349c81/c3ac1/fix-query-result.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 38.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABA0lEQVR42pVR25KFIAzzc7yhIoggIP7/T3WbKp4zs/uyD5lQYNKkbY7joBACbc6RtZa2bSPHZ+f2h917Bx7Hkbqu+xPDMFATY6ScEot60lrTuq7C8zzTsiwvUONeqd+Cfd8LRHDfd7pKoSSigVLO5L0nY4w4FkG9vI0AvC3MeDN8r5Sitm1vQXwoj6AwO8YYItcHnyFqrRHB2gTRBXZ7z8ZYadagy3VdlM9Mmd3pVcucpmn6xNaf2GClJnGDfzVqrRvMAF0hep6nuMI5RXYYDq7ZbbwXh3kDwYfbOTs2D9BMIqMDCoghNuIC1Q0Ybr8XBNTFgSH0zhAxS7lErHb7XsB/8QMSX/56Ry6qfwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;fix query result&apos; title=&apos;&apos; src=&apos;/static/f1eca4cc692652b7660fad5cce349c81/ca1dc/fix-query-result.png&apos; srcset=&apos;/static/f1eca4cc692652b7660fad5cce349c81/e7570/fix-query-result.png 170w,
/static/f1eca4cc692652b7660fad5cce349c81/f46e7/fix-query-result.png 340w,
/static/f1eca4cc692652b7660fad5cce349c81/ca1dc/fix-query-result.png 680w,
/static/f1eca4cc692652b7660fad5cce349c81/02d09/fix-query-result.png 1020w,
/static/f1eca4cc692652b7660fad5cce349c81/c3ac1/fix-query-result.png 1057w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;OR 연선자에 해당하는 데이터들은 모두 &lt;code class=&quot;language-text&quot;&gt;Index Scan&lt;/code&gt;을 통해 조회했고, 그 후에 기본 조건들을 적용했습니다.&lt;/p&gt;
&lt;p&gt;최종적으로 &lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;기존 67ms&lt;/code&gt; 쿼리 실행 시간에서 0.5ms 로 134배 향상되었음을 확인할 수 있습니다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;하지만 JOIN을 통해 태그 정보를 가져오는 것이아닌, 인자로 유저의 관심 태그를 보유한 &lt;code class=&quot;language-text&quot;&gt;article.id&lt;/code&gt; 목록을 가져오는 것이기 때문에 발생하는 쿼리가 늘어난다는 단점이 존재합니다. &lt;/p&gt;
&lt;p&gt;그럼에도 불구하고 조인을 제거하고, 단일 테이블 조건으로 바꾼 덕분에 쿼리의 속도, 인덱스 효율, 캐시 적중률이 압도적으로 좋아졌고 총 쿼리의 수가 N+1 문제와 같이 치명적인 수준의 쿼리의 개수가 늘어난 것임이 아니기 때문에 적절한 개선 방법이라고 생각합니다.&lt;/p&gt;
&lt;h3 id=&quot;마무리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%A7%88%EB%AC%B4%EB%A6%AC&quot; aria-label=&quot;마무리 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;마무리&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;결과적으로 의미있는 성능 개선의 경험을 할 수 있었습니다. 위 방법처럼 쿼리 플랜을 통해 쿼리를 분석한다면 성능 개선에 더욱 더 도움이 될 수 있습니다. 하지만 저런식으로 나오는 쿼리 플랜의 결과물은 다소 가독성이 떨어집니다. 그래서 이를 보기 좋게 시각화 해주는 툴을 소개해주도록 하겠습니다.&lt;/p&gt;
&lt;p&gt;먼저 분석하고자 하는 쿼리에 다음과 같은 키워드를 추가합니다&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 기존&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SQL&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 변경&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;EXPLAIN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;ANALYZE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; COSTS&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; VERBOSE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; BUFFERS&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; FORMAT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; JSON&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;SQL&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;해당 쿼리의 결과물을 &lt;a href=&quot;https://explain.dalibo.com/&quot;&gt;https://explain.dalibo.com/&lt;/a&gt; 의 Plan 부분에 붙여넣고 전송하게 되면 쿼리 플랜을 시각화하여 볼 수 있습니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Redis-Sentinel에 대해 알아보고 직접 구현해보기]]></title><description><![CDATA[은  의 고가용성 (High Availabiliity)를 보장하기 위한 시스템입니다. 많은 요청을 처리해야 하는 서비스에서 만약 한 대의 Redis만 사용한다면 과도한 부하로 인해 장애가 발생했을 때, Redis…]]></description><link>https://jindaram.site/redis-sentinel/</link><guid isPermaLink="false">https://jindaram.site/redis-sentinel/</guid><pubDate>Mon, 16 Jun 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Redis Sentinel&lt;/code&gt; 은 &lt;code class=&quot;language-text&quot;&gt;Redis&lt;/code&gt; 의 &lt;strong&gt;고가용성 (High Availabiliity)&lt;/strong&gt;를 보장하기 위한 시스템입니다.&lt;/p&gt;
&lt;p&gt;많은 요청을 처리해야 하는 서비스에서 만약 한 대의 Redis만 사용한다면 과도한 부하로 인해 장애가 발생했을 때, Redis에 의존하는 서비스들은 정상적으로 운영하기 어렵고, 성능이 대폭 감소할 수 있습니다. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;고가용성이란?&lt;br&gt;&lt;/strong&gt;
고가용성 (HA, High Availability) 란? 쉽게 말해서 어떠한 서버나 시스템이 오랫 동안 정상 운영이 가능한 정도를 이야기 합니다. 장애가 발생하더라도, 이를 빠른 시간 안에 복구하고, 정상적인 서비스를 운영하여 서비스 신뢰성을 복구한다면 고가용성이 높다라고 말할 수 있습니다.&lt;/p&gt;
&lt;p&gt;고가용성을 높이는 방법과 전략에는 여러가지가 있지만, 본 포스트에서는 &lt;code class=&quot;language-text&quot;&gt;Redis-Sentinel&lt;/code&gt; 을 중심적으로 설명하겠습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Redis-Sentinel&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Redis-Sentinel&quot; aria-label=&quot;Redis Sentinel permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Redis-Sentinel&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;Redis Sentinel 은 앞서 말했듯이 Redis의 고가용성을 보장하기 위한 시스템입니다. 분산 환경에서는 Redis가 여러 노드에 걸쳐 동작됩니다. 모니터링을 통해 &lt;code class=&quot;language-text&quot;&gt;master&lt;/code&gt; 및 &lt;code class=&quot;language-text&quot;&gt;replica&lt;/code&gt; 가 정상적으로 동작하는지 확인하고, 자동으로 장애를 복구할 수 있는 기능을 제공합니다.&lt;/p&gt;
&lt;p&gt;보통의 Sentinel은 3개 이상의 인스턴스를 구성합니다. 이렇게 구성하면 합의를 통해 장애 여부를 판단할 수 있어 더욱 더 안정적인 시스템을 구성할 수 있습니다.&lt;/p&gt;
&lt;h3 id=&quot;주요-개념&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A3%BC%EC%9A%94-%EA%B0%9C%EB%85%90&quot; aria-label=&quot;주요 개념 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;주요 개념&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;Quorum&lt;/strong&gt; &lt;br&gt;
Quorum(합의) 이란 각각의 Sentinel 들이 master 가 죽었다고 판단할 때 &lt;code class=&quot;language-text&quot;&gt;필요한 최소한의 합의 수&lt;/code&gt; 입니다.
만약 &lt;code class=&quot;language-text&quot;&gt;Quorum = 3&lt;/code&gt; 이라면, 최소 3개의 Sentinel 이 &lt;code class=&quot;language-text&quot;&gt;master&lt;/code&gt; 가 죽었다고 판단해야 장애 복구가 시작 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Failover&lt;/strong&gt; &lt;br&gt;
Failover 란 시스템에 한 구성 요소에 장애가 발생했을 때, 즉시 다른 예비 시스템으로 대체하여 서비스를 계속해서 지속하는 기능입니다. Redis Sentinel 에서는 master 에 장애가 발생하였을 때, 여러 replica 인스턴스 중 1개를 master를 승격 시키는 것을 의미합니다.&lt;/p&gt;
&lt;h3 id=&quot;What-is-Sentinel&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#What-is-Sentinel&quot; aria-label=&quot;What is Sentinel permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;What is Sentinel?&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;1개의 Redis 인스턴스만을 사용한다면, 해당 Redis에 부하가 생겨 장애가 발생했을 때, Redis에 의존하는 서비스들은 정상적으로 운영하기 어렵고, 성능이 대폭 감소할 우려가 있습니다. &lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/86496f216a26e2a7e3c0d8546994ccf0/bbbf7/redis-master-slave.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqElEQVR42n1STS8DQRjuHxK/wFEcJA70LMQPaELCzQ+QHpwcSFwdOeDQINRBfLXFso1abD827XY/Zmd3ZvZjZnhXm2gFz+mdmfd5nvdjMh8DSIQ4fdL2S0/nqgbB8cPziVK7rOlHynNR1UpvTSHlYH5m8CClrBrmlVZXW51qyyzrRqXRqbUttdm5eW2ozbb8hwwQnIskYSQQABokbaNHkJxLIaIo+p0MyYwxDhRCuo5r63phanJ3dKSys2O4rmPZlmW5rjtoPuRMKfU8LwxDLmTC2NnSYmF+zlAUTAgoAvlPZwBjIcYeQsjHPkgEjJm2zTmHGHTjJBag+tMZzqJ/ixFGjkOIb1s2BI6VglLfMk0SUBCK43iIzNMlpcxmDW0sX68vXKglnVC/lxEQ/KK0tlfv12aL749O6iX65hloRtnavM3nYca6inJjBysThWqlzkISRTE04hNPLdeXxwu5sUPtvguThRJ7ZWaw5+1lZ3az09BrWrbLiB9ynsAzFAkTgi3APfEjjEi6soRLLvrOkIQ86BTLnuCXpBDix3/4/kg0CO7KDgIG/gREoWNn3XsudQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;Redis Master-Replica&apos; title=&apos;&apos; src=&apos;/static/86496f216a26e2a7e3c0d8546994ccf0/ca1dc/redis-master-slave.png&apos; srcset=&apos;/static/86496f216a26e2a7e3c0d8546994ccf0/e7570/redis-master-slave.png 170w,
/static/86496f216a26e2a7e3c0d8546994ccf0/f46e7/redis-master-slave.png 340w,
/static/86496f216a26e2a7e3c0d8546994ccf0/ca1dc/redis-master-slave.png 680w,
/static/86496f216a26e2a7e3c0d8546994ccf0/02d09/redis-master-slave.png 1020w,
/static/86496f216a26e2a7e3c0d8546994ccf0/bbbf7/redis-master-slave.png 1280w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;Redis Master-Replica&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;이를 해결하기 &lt;code class=&quot;language-text&quot;&gt;Master-Replica&lt;/code&gt; 구조로 Redis 환경을 구성하는데요, 이는 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 를 통해 데이터를 쓰고, 다수의 &lt;code class=&quot;language-text&quot;&gt;Replica Redis 인스턴스&lt;/code&gt;에서 데이터를 읽는 구조인 것 입니다. 상대적으로 읽기 처리를 해야 하는 서비스가 많기 때문에 읽기 전용 &lt;code class=&quot;language-text&quot;&gt;Replica Redis 인스턴스&lt;/code&gt; 를 늘리는 구조입니다.&lt;/p&gt;
&lt;p&gt;데이터가 여러 인스턴스에 복제되어 있어, 읽기 요청 처리를 분산 시킬 수 있어 부하를 줄일 수 있다는 장점이 있습니다.&lt;/p&gt;
&lt;p&gt;그런데 만약 이러한 구조에서 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 에 문제가 생기면 어떻게 될까요?&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/53c34ea4bce50be889c11e42b2574e88/ec6be/net-connected.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 10.588235294117647%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdElEQVR42lWNWxKCMAxF2Y2OVqRNS5sALTII7n9D15g/P87kOfd0T5pAZUXIDZFfkPZBnt9IvBlDXPDwgj6IVoYbivaMWz/i6iIud/qj+z3laQfXQ4N2DTwh9URZDpWshh8bkmx2J51J5UF3PlUTGTTDecEXgOVBcg2i1yUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;net connected&apos; title=&apos;&apos; src=&apos;/static/53c34ea4bce50be889c11e42b2574e88/ca1dc/net-connected.png&apos; srcset=&apos;/static/53c34ea4bce50be889c11e42b2574e88/e7570/net-connected.png 170w,
/static/53c34ea4bce50be889c11e42b2574e88/f46e7/net-connected.png 340w,
/static/53c34ea4bce50be889c11e42b2574e88/ca1dc/net-connected.png 680w,
/static/53c34ea4bce50be889c11e42b2574e88/02d09/net-connected.png 1020w,
/static/53c34ea4bce50be889c11e42b2574e88/9d567/net-connected.png 1360w,
/static/53c34ea4bce50be889c11e42b2574e88/ec6be/net-connected.png 2352w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Application 운영 도중 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 에 장에가 발생하면 위와 같이 Connection 끊깁니다.&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/da27ebc45a1d47496a8769dfb0a8b74b/8badf/reconnecting.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 4.117647058823529%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAASklEQVR42h2KUQ6AIAzFPI8KBjYYOhA03v9Kz+lHk6bplPYL+bhBUkGxI+QTX/PcsEiHM1/LgKsPZlKE1MDWSMb/cTHMfVRspHgBIf4g9ocRU7MAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;reconnecting&apos; title=&apos;&apos; src=&apos;/static/da27ebc45a1d47496a8769dfb0a8b74b/ca1dc/reconnecting.png&apos; srcset=&apos;/static/da27ebc45a1d47496a8769dfb0a8b74b/e7570/reconnecting.png 170w,
/static/da27ebc45a1d47496a8769dfb0a8b74b/f46e7/reconnecting.png 340w,
/static/da27ebc45a1d47496a8769dfb0a8b74b/ca1dc/reconnecting.png 680w,
/static/da27ebc45a1d47496a8769dfb0a8b74b/02d09/reconnecting.png 1020w,
/static/da27ebc45a1d47496a8769dfb0a8b74b/9d567/reconnecting.png 1360w,
/static/da27ebc45a1d47496a8769dfb0a8b74b/8badf/reconnecting.png 2750w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이후, &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 가 정상적으로 동적하게 되면 재연결하여 이전처럼 정상적으로 Redis를 사용할 수 있게됩니다. &lt;/p&gt;
&lt;p&gt;하지만 이렇게 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 에 장애가 생기면 사람이 직접 장애를 복구해야 하고, 이로 인해 긴 시간 동안 Redis를 사용 하지 못하면서 DB에 부하가 생겨 **전체 시스템에 장애가 전파될 수도 있습니다. **&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/4d816936d6794f5104f555abd4715bd1/e5adc/problem-ocurred.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 34.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABOElEQVR42k2QS0vDQBSF8/9x69JV68KdSrHQRdFaS20lVaFIH0aF5v2YvCbJJJO5HqMFz2L47nDPfWnUSTZ1GvhlnnKepUmcpmme52EYMsYACJMkybIMEMcxHaUJRRbj66RYecmHkDbj8qdWU1UVnPAAmqZBKqAoClTknIPbttX2kgazze39S7+gyejxUv+yFWVRaDtO1MlxHFQRQgB83wcHQQAuy1J756qf0PVwujw5vZqte4zsSmUxOxxMXddXq5VlWRgVqfDsdrv5fI7X8zxMoe0LOvdpOJhMzy5uxnovIEvAHJmW9dzJNM1fM9oahrFYLLbb7Z/5U9Lo4W283PQE3U1eh0+GS5SxyHVd1gkAc13XADQHY20w1tZaRWFZ21J5QjlNy8paEbVSIlschdvgYP9/wET0DeUSgSxwtgBrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;Master Redis Instance에 장애가 발생한 상황&apos; title=&apos;&apos; src=&apos;/static/4d816936d6794f5104f555abd4715bd1/ca1dc/problem-ocurred.png&apos; srcset=&apos;/static/4d816936d6794f5104f555abd4715bd1/e7570/problem-ocurred.png 170w,
/static/4d816936d6794f5104f555abd4715bd1/f46e7/problem-ocurred.png 340w,
/static/4d816936d6794f5104f555abd4715bd1/ca1dc/problem-ocurred.png 680w,
/static/4d816936d6794f5104f555abd4715bd1/e5adc/problem-ocurred.png 826w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;Master Redis Instance에 장애가 발생한 상황&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;하지만 여전히 &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt; 는 정상적으로 운영이 가능합니다. &lt;code class=&quot;language-text&quot;&gt;Redis-Sentinel&lt;/code&gt; 은 바로 이 여분의 Replica를 Master로 승격시켜, 장애를 복구하는 시스템을 의미합니다. &lt;/p&gt;
&lt;p&gt;하지만 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 에 장애가 발생했다고 어떻게 판단할까요? 그것을 판단하는 것이 바로 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 이란 존재입니다.&lt;/p&gt;
&lt;h3 id=&quot;Sentinel의-역할&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Sentinel%EC%9D%98-%EC%97%AD%ED%95%A0&quot; aria-label=&quot;Sentinel의 역할 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Sentinel의 역할&lt;/h3&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;모니터링&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;자동 장애 조치&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;알림&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 은 대략적으로 위와 같은 역할을 합니다. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Master Instance&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;Replica Instance&lt;/code&gt; 를 주기적으로 모니터링하여 장애가 발생했는지 확인합니다. &lt;/p&gt;
&lt;p&gt;이에 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 가 응답하지 않으면 &lt;code class=&quot;language-text&quot;&gt;주관적 다운&lt;/code&gt; 상태로 판단합니다.
또한 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 가 여러 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 등에 다운됐다고 판단되면 &lt;code class=&quot;language-text&quot;&gt;Quorum&lt;/code&gt; 을 통해 &lt;code class=&quot;language-text&quot;&gt;객관적 다운&lt;/code&gt; 상태로 판단하여, 여러 &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt; 중 하나를 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 로 승격합니다. &lt;/p&gt;
&lt;p&gt;그리고 나머지 &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt; 들은 새롭게 승격된 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 를 바라보게 만듭니다. 이 외에도 장애 및 복구와 같은 이벤트가 있을 때, 사용자가 설정한 것을 토대로 알림을 전송해주기도 합니다.&lt;/p&gt;
&lt;h3 id=&quot;몇-대의-Sentinel이-필요할까&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%AA%87-%EB%8C%80%EC%9D%98-Sentinel%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%A0%EA%B9%8C&quot; aria-label=&quot;몇 대의 Sentinel이 필요할까 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;몇 대의 Sentinel이 필요할까?&lt;/h3&gt;
&lt;p&gt;앞서, &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 은 여러 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 들에 의해 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 가 다운된 것을 합의한다고 했습니다.
하지만 &lt;code class=&quot;language-text&quot;&gt;단일 Sentinel&lt;/code&gt; 을 운용하고 만약 그 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 에 네트워크 문제가 발생했다면
이를 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt;의 주관적 다운이라고 판단하고 이는 &lt;code class=&quot;language-text&quot;&gt;단일 Sentinel&lt;/code&gt; 이기 때문에 객관적 다운으로 이어집니다. &lt;/p&gt;
&lt;p&gt;그렇게 되면 실제로 장애가 발생하지 않았는데도, &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt;를 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt;로 승격시켜버리는 문제가 발생합니다. 이에 Sentinel 은 &lt;code class=&quot;language-text&quot;&gt;최소 3대&lt;/code&gt; 가 존재해야 이를 객관적으로 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 가 다운됐다고 판단할 수 있기에 과반이 형성될 수 있는 &lt;code class=&quot;language-text&quot;&gt;최소 3대의 Sentinel&lt;/code&gt; 을 운용해야 효과적으로 자동 장애 복구 및 감지 기능을 발휘할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/e5adc/redis-sentinel.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 61.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVR42jWPbVPTQBDH86l96VcQZKQtUqhNC9MC+rLKDLaCtToKFBwFUWrSPNzlLpc0z5dLmnOLurNz+ed3+9+9VeRDlGURuqTMUiHyNImTNM05XywWYRhyztM0TZIkyzIQQOT/UHIp723/wglGLLsO+C+LZdBL5FDt+z74QQghqqoCZxzHjDHwgwCi4KU8+k7PBh/6pBwdfzq4mGuFjDxmI8QeAiEEXWAsCEopaDgxxnmeK4Qv9xPZHU/PHz1+OfzciqWRVkmwmBvmcDgcjUamacIoGAuNptPpYDC4ublxXXdlRkLuW+LkzeT45Mvw9bijJZqQke9ZCGm6puk6PAEeD5Ox4ximOfs9s2wb9MocSDn5Zr2/Nl4JeXqLx5calZJHse/6oR9CgkjjtCiKFfGCyI8CFiy8RVmWipQVEnRWOPPEmAlsCiKrZbSMdW7OMwtSz8yoTCpZWTmaZ6axgiYWBIjiFqxNeqrb6/qHXdZvOioSzrtgvE3VFfEPnxP1NJyYub1D9jreAZA267VpjwpXQbmjsn79bndtWmvc7TZJR+fG2/CsbrQ2vm5tXDe27PYoHM+4DubabXP9qta4b4EZCfzPXPux8+T8Gdw1afevuWG0nl7V1y9rW9YLMN9zbZfubd421y436z932m4P5VhhhafSvuod7PlHXe+wSbqwz2kw2aYdIJDbpHMWfoSFW2QfCoDAsA7tu4IpsDd8LI4QxzbHRFAgyTK1cgy9EXfgCn4BOoJCAUA4qWCVrP4AeI9xnEZb6JkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;redis-sentinel의 대략적인 구조&apos; title=&apos;&apos; src=&apos;/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/ca1dc/redis-sentinel.png&apos; srcset=&apos;/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/e7570/redis-sentinel.png 170w,
/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/f46e7/redis-sentinel.png 340w,
/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/ca1dc/redis-sentinel.png 680w,
/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/e5adc/redis-sentinel.png 826w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;redis-sentinel의 대략적인 구조&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;구현해보기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B5%AC%ED%98%84%ED%95%B4%EB%B3%B4%EA%B8%B0&quot; aria-label=&quot;구현해보기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;구현해보기&lt;/h2&gt;
&lt;p&gt;간단하게 Docker를 통해 구현해보도록 하겠습니다. 총 6개의 컨테이너의 분류는 다음과 같습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-replica-1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-replica-2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-sentinel-1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-sentinel-2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-sentinel-3&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;먼저 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 를 올려주도록 하겠습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; run &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt; redis-master &lt;span class=&quot;token parameter variable&quot;&gt;--network&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;NETWORK_NAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;PORT&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;:6379 redis:&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;TAG&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; redis-server &lt;span class=&quot;token parameter variable&quot;&gt;--apendonly&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--appendonly&lt;/code&gt; : 데이터를 영구적으로 저장하기 위한 옵션입니다. &lt;code class=&quot;language-text&quot;&gt;appendonly.aof&lt;/code&gt; 파일에 기록하고 서버 재시작 시 해당 내용을 기반으로 데이터를 복원합니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;다음은 &lt;code class=&quot;language-text&quot;&gt;redis-replica-n&lt;/code&gt; 입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; run &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt; redis-replica-n &lt;span class=&quot;token parameter variable&quot;&gt;--network&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;NETWORK_NAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;PORT&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;:6379 redis:latest redis-server &lt;span class=&quot;token parameter variable&quot;&gt;--slaveof&lt;/span&gt; redis-master &lt;span class=&quot;token number&quot;&gt;6379&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--slaveof&lt;/code&gt; : 호스트가 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 이고 포트가 &lt;code class=&quot;language-text&quot;&gt;6379&lt;/code&gt; 인 마스터를 따른다는 옵션입니다. 즉 해당 Master의 Replica로 설정됩니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;원하는 개수의 &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt; 만큼 생성하면 됩니다.&lt;/p&gt;
&lt;p&gt;이제 마지막으로 &lt;code class=&quot;language-text&quot;&gt;redis-sentinel&lt;/code&gt;을 생성할 차례입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; run &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt; sentinel-1 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--network&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;NETWORK_NAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;PORT&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;:26379 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;/sentinel.conf:/etc/sentinel/sentinel.conf &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
redis:latest &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sleep 5 &amp;amp;&amp;amp; redis-sentinel /etc/sentinel/sentinel.conf&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Sentinel의 경우 옵션을 넣는 파일을 Volume을 잡았다. 이에 &lt;code class=&quot;language-text&quot;&gt;sentinel.conf&lt;/code&gt; 내용은 다음과 같습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;sentinel monitor mymaster {MASTER_IP} 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 10000
# sentinel auth-pass mymaster {MASTER_PASS}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;monitor mymaster redis-master 6379 2&lt;/code&gt; : 내부에서 mymaster 라는 이름으로 redis-master:6379 라는 master를 모니터링 하고, &lt;code class=&quot;language-text&quot;&gt;최소 2개의 Sentinel&lt;/code&gt; 이 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 가 다운되었다고 판단해야 &lt;code class=&quot;language-text&quot;&gt;Failover&lt;/code&gt; 를 수행한다는 설정입니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;down-after-milliseconds mymaster 5000&lt;/code&gt; : Master가 5(5000ms)초 동안 응답이 없으면 다운된 것으로 판단합니다. (주관적 판단)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;failover-timeout mymaster 10000&lt;/code&gt; : Failover 시 전체 프로세스에 적용될 Timeout의 설정값 (새 마스터 승격, 클러스터 재구성 등등)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;auth-pass mymaster {PASSWORD}&lt;/code&gt; : Master 생성 시 &lt;code class=&quot;language-text&quot;&gt;Pass&lt;/code&gt;를 설정했다면 기록되는 값&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위 과정을 따랐다면, 총 &lt;code class=&quot;language-text&quot;&gt;6개의 컨테이너&lt;/code&gt;가 성공적으로 동작할 것 입니다.. 이제 Master가 다운되었을 때, 각각의 Sentinel 들이 합의를 통해 Replica 중 하나를 Master로 승격하는지 확인하는 과정이 남았습니다.&lt;/p&gt;
&lt;h2 id=&quot;확인하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0&quot; aria-label=&quot;확인하기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;확인하기&lt;/h2&gt;
&lt;p&gt;먼저 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;redis-replica-n&lt;/code&gt; 잘 연결되어있는지 확인해봅니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; redis-master redis-cli info replication&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 439px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/1c5e6457766f68a27036ac7c5a655c66/54b61/replication-result.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 45.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTElEQVR42oWSyYrCUBBF30eIUZwHIqKC4gDO8wi6cUBFF/r//3CbUxLpXoReHOq+VHJzKxU3nU612Wy0Xq/V6/WUyWQUi8UUjUZD8TwvtOfa7bbG47H6/b7Q3W5XzWbTjLPZrAqFgvL5vOlcLvfVVCgWiwY9rrvFYqH9fq/VaiU0iZfLpWazmbbbrcGZKYL+aDQy0NxH5T4mdIPBwJKRCk1CKqmpw+FQk8nE+uVy2SiVSlar1apqtZpSqZTi8bjhTqeTpZvP5zocDsbj8dD7/dbr9dLlctHxeDRut5vO57Ou16vu97udn8+nvTgSiXwMMSI+SWigSYT2fV+JRELpdNpSJJPJP9ALNIsEx9yMhwlwBkbEhM3x9mC7YXwN+eCw2+3s1wk+MqOziFarpUqlYil/PxiGazQa36V0Oh2r9XpdXOfMr4EZ4/1nhuEPsFQWbpaw+DIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;redis-master 컨테이너의 Replication 정보&apos; title=&apos;&apos; src=&apos;/static/1c5e6457766f68a27036ac7c5a655c66/54b61/replication-result.png&apos; srcset=&apos;/static/1c5e6457766f68a27036ac7c5a655c66/e7570/replication-result.png 170w,
/static/1c5e6457766f68a27036ac7c5a655c66/f46e7/replication-result.png 340w,
/static/1c5e6457766f68a27036ac7c5a655c66/54b61/replication-result.png 439w&apos; sizes=&apos;(max-width: 439px) 100vw, 439px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;redis-master 컨테이너의 Replication 정보&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;해당 명령어를 통해 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 와 연결된 &lt;code class=&quot;language-text&quot;&gt;Replication Redis Instance&lt;/code&gt; 들의 정보를 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;그리고 Sentinel 목록 중 하나의 컨테이너에서 마스터를 잘 바라보고 있는지 확인합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sentinel-n redis-cli &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;PORT&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; sentinel get-master-addr-by-name &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;MASTER_NAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 117px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/c3ebd2f68241e67ff5735e67d25c31c3/b6338/get-master-addr-by-name-result.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 28.205128205128204%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVR42nWP24qCYBSFfQUPqVlEocFQGhGUmUdEjbLmJiyiCIKGnqCbevg17g0TMxdz8fH/sPdaey0hiiLM53NY/T7yPMdqtcJisUCapiiKArZtYzQaIc0yFOsS/XrPdV2QzjRNJEmCz+0WUZbjw3Yg7Pd7FkuShPF4jOVyiaqqsNlscDqdWDwYDPB1u+H1fGI4HOJ6veLxeMAwDJB+XZawanNJFCGEYQjHcaBpGpt2Oh0EQQDLstiMjpAJJfF9H9PpFLPZDJ7nYTKZII5j6LoOpdHgAwJVpKEsy1z5crlwVUpIs/P5zGR1ZbFOoCgK7xL0pxDNZpMhY2G323FlSkiUdfz7/Y7j8cj1qdLhcODlVqv1Fv+GZj8IvV4P7Xb7bUh0u12GFqgGvaqq/hH+xzfkSrvxK32IoQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;결과로 Master Redis Instance의 IP 주소가 나온다.&apos; title=&apos;&apos; src=&apos;/static/c3ebd2f68241e67ff5735e67d25c31c3/b6338/get-master-addr-by-name-result.png&apos; srcset=&apos;/static/c3ebd2f68241e67ff5735e67d25c31c3/b6338/get-master-addr-by-name-result.png 117w&apos; sizes=&apos;(max-width: 117px) 100vw, 117px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;결과로 Master Redis Instance의 IP 주소가 나온다.&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt; 이제 Master를 다운 시켜서 각각의 Sentinel 들의 합의를 통해 Replica 중 하나를 Master 로 승격시키는 지 확인해봅시다. &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 를 다운 시키기 위해서 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 컨테이너를 정지 시켜 봅시다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; stop redis-master&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그리고 여러 &lt;code class=&quot;language-text&quot;&gt;Sentinel 컨테이너&lt;/code&gt; 중 하나의 로그를 살펴봅니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; logs &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sentinel-1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;10:X 16 Jun 2025 06:52:14.841 # +vote-for-leader c193c15f0a95f7b655f6ab0225f0042a958d11e1 1
10:X 16 Jun 2025 06:52:15.785 # +odown master mymaster 172.18.0.2 6379 #quorum 3/2
10:X 16 Jun 2025 06:52:15.785 * Next failover delay: I will not start a failover before Mon Jun 16 06:52:35 2025
10:X 16 Jun 2025 06:52:16.014 # +config-update-from sentinel c193c15f0a95f7b655f6ab0225f0042a958d11e1 172.18.0.5 26379 @ mymaster 172.18.0.2 6379
10:X 16 Jun 2025 06:52:16.014 # +switch-master mymaster 172.18.0.2 6379 172.18.0.4 6379&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 컨테이너를 중지시키게 되면, 각각의 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 이 투표를 통해 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 가 다운됐다는 것을 공식적으로 확인합니다. 그리고 투표의 값이 우리가 &lt;a href=&quot;&quot;&gt;설정한 임계값&lt;/a&gt; 을 넘어가게 되면, (로그에서는 3/2로 과반을 넘었다.) &lt;code class=&quot;language-text&quot;&gt;Replica Redis Instance&lt;/code&gt; 중 하나를 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 로 승격시킵니다.&lt;/p&gt;
&lt;p&gt;승격이 완료된 뒤에 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 에서 다음 명령어를 통해 바라보고 있는 Master 를 확인할 수 있습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;redis-cli &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; SENTINEL get-master-addr-by-name &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;모니터링_하고_있는_Master_이름&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음과 같이 다른 &lt;code class=&quot;language-text&quot;&gt;Replica Redis Instance&lt;/code&gt; 의 주소가 저장되어 있는 것을 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/7c85dc0fbb0c3db261009e2a1930daf5/e5adc/new-structure.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 61.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACRklEQVR42j1Qa0/bUAzNv97H/YFJA6bRFpFSkqZVC2zal3VDYkChdBNjbUHjNVGged3k5kHeyW0Sz9Vg1pGvfexjy5eDZytf8D+FJI4C186TKI1CtDiO0fu+/9IDXAZwpzkTKzxNYewmt7KFjJaWv0IYmvGJGY8i0JAqizCKgiCwLAv1OKUsS44UsHNJ+59P2iQ/3P2xNZLlHA7ckifQcaHjQF2DvSfI0kTTdUqp67roCSFZlnFmWrQjkAaTs1evP+yfNkJQ4uLYA0HO3uyPlgeXkpYfepAksW3b4/G41+tdXV3h/oVYZ9BW2d7X4e7ez/0vg+ZDNGOLzQ292JzFgpxs6gVuTpKEGIasKNP7qappGC/EHsDwt3p8Ln9k0L8mx6MHB+AiKD9Z0HMXwGASQjGfu5brOV7gBp7tPTlPeZ5z+BU6o9O5MYvkKSMKM/FvgiK6T5XHREXcJ0qQhyWUaqbPEkVOVPSEmchw1twWzI5odSR3W7K7vCHqzDj0BjwVW+42Yt0U+/5QybS6KTWdLWwT7I5AO5RZnJ4Zot2t3m4sjSu12w3ebD6m8jf/qCo33l2srZzX1jThwB9M08e62apc88uTSu2ugWKdkWdx5ab+9uw91ngq/RPX5MbKpLo8qqypmyi+Sx82aGv1ml8arVb/1AWro2eEs+eOSLuis9VydyRnmzclvKfvDddpExnEutk88r/jwQ2zjQ3I4LIm7VrM5vBufNRU11OipcRkFJmoiNWM4Gw9NbCEKZIGo9iAJHrK7BLKv9ACbgFFzsf8AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;새롭게 승격된 Master Redis Instance의 구조&apos; title=&apos;&apos; src=&apos;/static/7c85dc0fbb0c3db261009e2a1930daf5/ca1dc/new-structure.png&apos; srcset=&apos;/static/7c85dc0fbb0c3db261009e2a1930daf5/e7570/new-structure.png 170w,
/static/7c85dc0fbb0c3db261009e2a1930daf5/f46e7/new-structure.png 340w,
/static/7c85dc0fbb0c3db261009e2a1930daf5/ca1dc/new-structure.png 680w,
/static/7c85dc0fbb0c3db261009e2a1930daf5/e5adc/new-structure.png 826w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;새롭게 승격된 Master Redis Instance의 구조&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;정확히 확인하기 위해서, 새롭게 승격된 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 에 접속하여 &lt;code class=&quot;language-text&quot;&gt;info replication&lt;/code&gt; 명령어를 확인하면 &lt;code class=&quot;language-text&quot;&gt;role:master&lt;/code&gt; 임을 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 654px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/66db108af6504f0cf3f75173e786b57f/ba4a2/after-master-down-sentinel-master-addr.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 9.411764705882353%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAX0lEQVR42k2KOQoAIRAEPQITRRPPASMzYf3/63qZgV0MCvoo9ZyDvTdaa4gxgoiQUkIpRfDeY4yBWquQcxaHc+9dHP7nnAghQK21ZHDOQWsNay2MMT+83Z3/2/k6w+4LdDguyyk9QtgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;after master down sentinel master addr&apos; title=&apos;&apos; src=&apos;/static/66db108af6504f0cf3f75173e786b57f/ba4a2/after-master-down-sentinel-master-addr.png&apos; srcset=&apos;/static/66db108af6504f0cf3f75173e786b57f/e7570/after-master-down-sentinel-master-addr.png 170w,
/static/66db108af6504f0cf3f75173e786b57f/f46e7/after-master-down-sentinel-master-addr.png 340w,
/static/66db108af6504f0cf3f75173e786b57f/ba4a2/after-master-down-sentinel-master-addr.png 654w&apos; sizes=&apos;(max-width: 654px) 100vw, 654px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;그리고 이전에 중지된 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 를 정상적으로 복구 시키게 되면 현재 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt;로 붙게 됩니다.&lt;/p&gt;
&lt;p&gt;자세한 코드 내용은 &lt;a href=&quot;https://github.com/jin-daram/tech-blog-code-lab&quot;&gt;블로그 코드 저장소&lt;/a&gt; 에서 내용을 확인하실 수 있습니다.&lt;/p&gt;
&lt;h2 id=&quot;마무리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%A7%88%EB%AC%B4%EB%A6%AC&quot; aria-label=&quot;마무리 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;마무리&lt;/h2&gt;
&lt;p&gt;이렇게 &lt;code class=&quot;language-text&quot;&gt;Redis Sentinel&lt;/code&gt; 에 대해 알아보고, 직접 테스트하여 &lt;code class=&quot;language-text&quot;&gt;Quorum&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Failover&lt;/code&gt; 의 처리를 눈으로 확인해보았습니다. 학습하면서 알게 된 사실인데, Master-Replica 구조로 Redis를 구성했을 때, 읽기 요청 시 자동으로 로드밸런싱을 해주는 것이 아니더군요. &lt;em&gt;( &lt;code class=&quot;language-text&quot;&gt;Lettuce&lt;/code&gt;와 같은 Redis Client 에서도 지원을 안하는 것 같았습니다. )&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;그래서 &lt;a href=&quot;https://github.com/twitter/twemproxy&quot;&gt;Twemproxy&lt;/a&gt; 나 &lt;a href=&quot;https://github.com/joyieldInc/predixy&quot;&gt;Predixy&lt;/a&gt; 와 같은 프록시를 거쳐야 한다는 것을 알았습니다. &lt;a href=&quot;https://github.com/redis/lettuce/issues/834&quot;&gt;참조&lt;/a&gt; &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Lettuce selects a slave per slot hash and uses the selected slave for read operations until the next topology refresh. This is by design to reduce CPU overhead.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;이를 통해 Redis의 구성이 변경되지 않는 한 &lt;em&gt;(e.g 새로운 Replica Redis가 추가된다거나 등)&lt;/em&gt; 지정된 Replica에 대해서만 읽기 요청을 보낸다는 것 같았습니다.&lt;/p&gt;
&lt;p&gt;사실 이러한 설정은 굉장히 복잡하고, 네트워크도 설정해야 하니, 수지타산을 고려하여 이런 것들을 상대적으로 쉽게 설정할 수 있는 &lt;code class=&quot;language-text&quot;&gt;AWS ElastiCache&lt;/code&gt; 와 같은 서비스를 이용하는 것도 좋을 것 같습니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[NestJS @Transactional 구현하기]]></title><description><![CDATA[이전 글 (NestJS 트랜잭션 적용 원리 알아보기) 에서는 NestJS와 Node.js 환경에서 TypeORM을 통해 어떤식으로  을 적용할 수 있는지 실제  코드와 함께 살펴봤다. 본 포스트에서는 typeorm-transactional…]]></description><link>https://jindaram.site/nestjs-tx-implement/</link><guid isPermaLink="false">https://jindaram.site/nestjs-tx-implement/</guid><pubDate>Thu, 12 Jun 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;&quot;&gt;이전 글 (NestJS 트랜잭션 적용 원리 알아보기)&lt;/a&gt; 에서는 NestJS와 Node.js 환경에서 TypeORM을 통해 어떤식으로 &lt;code class=&quot;language-text&quot;&gt;Transaction&lt;/code&gt; 을 적용할 수 있는지 실제 &lt;code class=&quot;language-text&quot;&gt;TypeORM&lt;/code&gt; 코드와 함께 살펴봤다.&lt;/p&gt;
&lt;p&gt;본 포스트에서는 &lt;a href=&quot;https://www.npmjs.com/package/typeorm-transactional&quot;&gt;typeorm-transactional&lt;/a&gt;을 사용하지 않고, 직접 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; Decorator를 구현하여 간편하게 트랜잭션을 적용하는 법을 보이겠다.&lt;/p&gt;
&lt;h2 id=&quot;Nodejs의-Thread-Local-Storage&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Nodejs%EC%9D%98-Thread-Local-Storage&quot; aria-label=&quot;Nodejs의 Thread Local Storage permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Node.js의 Thread Local Storage&lt;/h2&gt;
&lt;p&gt;Thread Local Storage는 쉽게 말해서 각 Thread 마다 따로 저장되는 값이다. 멀티 스레드 환경에서 데이터 충돌을 방지하는 목적으로 사용하는 데 유용하다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* Java에서 ThreadLocalStorage를 생성하고 사용하기 */&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;ThreadLocal&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; threadLocal &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ThreadLocal&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

threadLocal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;A&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; threadLocal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// return &quot;A&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다른 스레드에서는 &lt;code class=&quot;language-text&quot;&gt;threadLocal&lt;/code&gt; 변수에 저장된 &lt;code class=&quot;language-text&quot;&gt;&quot;A&quot;&lt;/code&gt; 라는 값을 조회할 수 없다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Spring Boot&lt;/code&gt;는 &lt;code class=&quot;language-text&quot;&gt;멀티 스레드&lt;/code&gt; 환경이기에 &lt;code class=&quot;language-text&quot;&gt;ThreadPool&lt;/code&gt; 에서 요청 하나 당 1개의 Thread를 할당 받아 처리하기 때문에 &lt;code class=&quot;language-text&quot;&gt;ThreadLocal&lt;/code&gt; 클래스를 통해 &lt;code class=&quot;language-text&quot;&gt;ThreadLocalStorage&lt;/code&gt; 를 사용할 수 있다.&lt;/p&gt;
&lt;p&gt;하지만 &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 환경은 &lt;code class=&quot;language-text&quot;&gt;싱글 스레드 기반&lt;/code&gt; 으로 동작하기 때문에 요청별 컨텍스트를 분리할 수 없어 기본적으로 Thread Local Storage를 만들 수 없다.&lt;/p&gt;
&lt;h3 id=&quot;cls-hooked&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cls-hooked&quot; aria-label=&quot;cls hooked permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;cls-hooked&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.npmjs.com/package/cls-hooked&quot;&gt;cls-hooked&lt;/a&gt; 는 &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 에서 &lt;code class=&quot;language-text&quot;&gt;ThreadLocal&lt;/code&gt; 처럼 동작하는 &lt;code class=&quot;language-text&quot;&gt;Continuation-Local-Storage&lt;/code&gt; 를 만들기 위해 나온 모듈이다. 이는 내부 &lt;code class=&quot;language-text&quot;&gt;Namespace&lt;/code&gt; 를 하나 생성하여, 내부적으로 &lt;code class=&quot;language-text&quot;&gt;Map&amp;lt;asyncId, Context&gt;&lt;/code&gt; 구조로 저장소를 갖는다. &lt;/p&gt;
&lt;p&gt;하지만 마지막 업데이트가 너무 오래전이고, 비공식 구현체이다.&lt;/p&gt;
&lt;h3 id=&quot;Async-Local-Storage&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Async-Local-Storage&quot; aria-label=&quot;Async Local Storage permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Async Local Storage&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;async_hooks&lt;/code&gt; 기반으로 동작되는 공식 &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;Async Local Storage&lt;/code&gt; 이다. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;async_hooks 란?&lt;/strong&gt;
&lt;code class=&quot;language-text&quot;&gt;async_hooks&lt;/code&gt; 는 &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 에서 제공하는 비동기 콜백의 생명주기를 추적할 수 있는 API 이다. 싱글 스레드 기반인 Node.js 에서는 비동기 함수들의 흐름이 섞일 경우, 이를 추적하기 어렵다. 이를 쉽게하기 위해서 구현된 것이 &lt;code class=&quot;language-text&quot;&gt;async_hooks&lt;/code&gt; 이다.
다만 이 &lt;code class=&quot;language-text&quot;&gt;async_hook&lt;/code&gt; 는 사용이 금지시 되고 있다. 비동기 컨텍스트 추적 용도로는 &lt;code class=&quot;language-text&quot;&gt;AsyncLocalStorage&lt;/code&gt; 를 사용하도록 권고되고 있다. &lt;a href=&quot;https://nodejs.org/api/async_hooks.html?utm_source=chatgpt.com#async-hooks&quot;&gt;참고&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;AsyncLocalStorage&lt;/code&gt; 는 비동기 컨텍스트 유지가 가능하고, Node.js 에서 공식적으로 지원하는 비동기 컨텍스트 추적 객체이다. 다음과 같이 사용할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* async-context.ts */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; AsyncLocalStorage &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;node:async_hooks&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; asyncLocalStorage &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AsyncLocalStorage&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    asyncLocalStorage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  get&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; asyncLocalStorage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getStore&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* runner.ts */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; context &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./async-context&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;hello jin-daram&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 기반 서버와 응용하여 사용하면 &lt;code class=&quot;language-text&quot;&gt;Spring Boot&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;ThreadLocal&lt;/code&gt; 처럼 활용할 수 있다.&lt;/p&gt;
&lt;h2 id=&quot;Transactional&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Transactional&quot; aria-label=&quot;Transactional permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;@Transactional&lt;/h2&gt;
&lt;p&gt;위에서, 알게 된 내용을 바탕으로 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; Decorator를 생성하여 본다. 먼저 트랜잭션이 필요한 &lt;code class=&quot;language-text&quot;&gt;Post&lt;/code&gt; 요청을 처리하는 &lt;code class=&quot;language-text&quot;&gt;Service&lt;/code&gt;를 생성하도록 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;요청 정보로 &lt;code class=&quot;language-text&quot;&gt;User&lt;/code&gt; 를 생성하는 매우 간단한 코드이다. 지금은 &lt;code class=&quot;language-text&quot;&gt;UserRepository&lt;/code&gt; 생성 시 선언된 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt;를 통해 트랜잭션을 유지하기 때문에 &lt;code class=&quot;language-text&quot;&gt;createUser()&lt;/code&gt; 함수에 다른 엔티티에 대한 &lt;code class=&quot;language-text&quot;&gt;INSERT&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;UPDATE&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;DELETE&lt;/code&gt; 쿼리가 추가된다면 트랜잭션이 유지될 수 없는 상황이다.&lt;/p&gt;
&lt;p&gt;이제 &lt;code class=&quot;language-text&quot;&gt;createUser()&lt;/code&gt; 함수가 실행되기 전에 &lt;code class=&quot;language-text&quot;&gt;em.transaction()&lt;/code&gt; 콜백 함수의 인자로 들어오는 manager를 해당 요청 내에서 사용해야한다. 즉 &lt;code class=&quot;language-text&quot;&gt;UserRepository&lt;/code&gt; 에서 접근하는 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 가 변경되어야 하고, 이 접근 방식을 다르게 설정해야 한다. &lt;/p&gt;
&lt;p&gt;이는 &lt;code class=&quot;language-text&quot;&gt;typeorm-transactional&lt;/code&gt; 에서 구현했던 방식과 비슷하게 &lt;code class=&quot;language-text&quot;&gt;Object.defineProperty(...)&lt;/code&gt; 함수를 이용해서 설정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* init.ts */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defineProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Repository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prototype&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        configurable&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;entityManager&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;우리는 &lt;code class=&quot;language-text&quot;&gt;CustomRepository&lt;/code&gt; 를 만들 때, 반드시 &lt;code class=&quot;language-text&quot;&gt;Repository&amp;lt;Entity extends ObjectLiteral&gt;&lt;/code&gt; 를 상속받아 사용한다. &lt;code class=&quot;language-text&quot;&gt;Repository&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;prototype&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;manager&lt;/code&gt; 라는 속성에 접근할 때, &lt;code class=&quot;language-text&quot;&gt;Repository.manager&lt;/code&gt; 에 접근하는 것이 아닌, 우리가 나중에 생성할 &lt;code class=&quot;language-text&quot;&gt;Request Context&lt;/code&gt; 에서 접근하도록 설정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* user.repository.ts */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserRepository&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Repository&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그리고 해당 함수를 &lt;code class=&quot;language-text&quot;&gt;main.ts&lt;/code&gt; 에서 App이 실행되기 전에 싫맹한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* main.ts */&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;bootstrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;Context-만들기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Context-%EB%A7%8C%EB%93%A4%EA%B8%B0&quot; aria-label=&quot;Context 만들기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Context 만들기&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;cls-hooked&lt;/code&gt; 는 오래 전에 업데이트 되었기 때문에 상대적으로 최근에 생기고, &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 에서 지원하는 &lt;code class=&quot;language-text&quot;&gt;Async-Local-Storage&lt;/code&gt; 를 전격 활용하여 개발하도록 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* context.ts */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Context&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; dataSource&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; DataSource&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; asyncLocalStorage &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AsyncLocalStorage&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Map&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;EntityManager&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataSource&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setDataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;targetDataSource&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; DataSource&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; targetDataSource&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataSource &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; targetDataSource&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;store&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Map&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;asyncLocalStorage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;store&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;asyncLocalStorage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getStore&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;먼저 간단한 &lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt; 클래스를 생성한다. 내부에는 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;AsyncLocalStorage&lt;/code&gt; 로 이루어져 있다.&lt;/p&gt;
&lt;p&gt;DataSource는 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; Decorator 에서 트랜잭션를 생성하기 위해 저장한다. 그렇기 때문에 &lt;code class=&quot;language-text&quot;&gt;main.ts&lt;/code&gt;에서 해당 &lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt; 에 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt; Mapping이 필요하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setDataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  type &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;postgres&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  host &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;localhost&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  port &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5433&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  username&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;postgres&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  password &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mypassword&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  database&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;postgres&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  entities&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;User&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  logging&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;bootstrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;지금은 수동으로 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt; 를 지정해주었지만, 향후 &lt;code class=&quot;language-text&quot;&gt;TypeORM&lt;/code&gt; 모듈을 통해 &lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt; 에 자동으로 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt; 를 설정하는 것도 가능할 것 같다.&lt;/p&gt;
&lt;h3 id=&quot;Transactional-Decorator-생성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Transactional-Decorator-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;Transactional Decorator 생성하기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;@Transactional Decorator 생성하기&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Transactional&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; MethodDecorator &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _propertyKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; descriptor&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; PropertyDescriptor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; original &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; descriptor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    descriptor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; dataSource &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; dataSource&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;transaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;transactionManager&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;entityManager&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; transactionManager&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;original&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;코드 구성은 간단하다. 전역적으로 접근할 수 있는 Context 로 부터, DataSource를 가져온다.&lt;/p&gt;
&lt;p&gt;그런 후에 DataSource의 EntityManager의 transaction() 함수를 통해 콜백 함수의 인자로 주어진 EntityManager를 &lt;code class=&quot;language-text&quot;&gt;Map&amp;lt;string, EntityManager&gt;&lt;/code&gt; 형태의 Store에 저장한다.&lt;/p&gt;
&lt;p&gt;그리고 실행하고자 하는 함수를 실행한다.&lt;/p&gt;
&lt;h3 id=&quot;적용하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0&quot; aria-label=&quot;적용하기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;적용하기&lt;/h3&gt;
&lt;p&gt;기존에 트랜잭션을 적용하고자 했던 함수에 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; Decorator를 붙인다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Transactional&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이후 결과를 확인해보면 성공적으로 트랜잭션이 원하는 대로 적용되는 것을 확인할 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/94a69a28b90709628e32365482dd3f61/c807c/transaction-success.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 5.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAASElEQVR42h2IQQ6AIAzA/IaGARshUdxB9Kj//1ZFD02bTr431n6znQ9Hv3B3zAxVxUphTpU0WnJi0YZoJUYZRPL4IYS/P4sIL3z8HDJqpQ14AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;Transaction이 정상적으로 적용되는 모습&apos; title=&apos;&apos; src=&apos;/static/94a69a28b90709628e32365482dd3f61/ca1dc/transaction-success.png&apos; srcset=&apos;/static/94a69a28b90709628e32365482dd3f61/e7570/transaction-success.png 170w,
/static/94a69a28b90709628e32365482dd3f61/f46e7/transaction-success.png 340w,
/static/94a69a28b90709628e32365482dd3f61/ca1dc/transaction-success.png 680w,
/static/94a69a28b90709628e32365482dd3f61/02d09/transaction-success.png 1020w,
/static/94a69a28b90709628e32365482dd3f61/9d567/transaction-success.png 1360w,
/static/94a69a28b90709628e32365482dd3f61/c807c/transaction-success.png 1850w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;Transaction이 정상적으로 적용되는 모습&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;문제점&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%AC%B8%EC%A0%9C%EC%A0%90&quot; aria-label=&quot;문제점 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;문제점&lt;/h3&gt;
&lt;p&gt;하지만 여전히 부족한 점이 많다. 트랜잭션이 정상적으로 적용되기는 하지만, 로직이 복잡해지고, 함수가 분리되는 경우의 트랜잭션 전략에 대한 전략책이 없다. &lt;code class=&quot;language-text&quot;&gt;typeorm-transactional&lt;/code&gt; 에서는 이런 것 까지 잘 지원하고 있으니, 결국 좋은 라이브러리를 사용하는 것이 좋은 것 같다.&lt;/p&gt;
&lt;p&gt;본 포스트는 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;EntityManger&lt;/code&gt; 와 관련하여 &lt;code class=&quot;language-text&quot;&gt;TypeORM&lt;/code&gt; 환경에서 &lt;code class=&quot;language-text&quot;&gt;Transaction&lt;/code&gt; 이 어떻게 적용되는지에 대한 학습을 목적으로 작성한 글이기 때문에 부족한 부분이 있을 수 있다. 피드백은 언제나 환영이기에 하단의 &lt;strong&gt;Discussion&lt;/strong&gt; 을 적극적으로 활용해주시기 바란다.&lt;/p&gt;
&lt;p&gt;자세한 코드는 &lt;a href=&quot;https://github.com/jin-daram/tech-blog-code-lab&quot;&gt;블로그 코드 Repository&lt;/a&gt; 에서 확인 할 수 있다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[NestJS 트랜잭션 적용 원리 알아보기]]></title><description><![CDATA[Spring Boot 에서는 다음과 같은 코드로 간단하게  을 적용할 수 있다.  자세한 적용 원리나 옵션에 대해서는 의 @Transactional Annotation…]]></description><link>https://jindaram.site/nestjs-tx-principle/</link><guid isPermaLink="false">https://jindaram.site/nestjs-tx-principle/</guid><pubDate>Thu, 05 Jun 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;Spring Boot&lt;/strong&gt; 에서는 다음과 같은 코드로 간단하게 &lt;code class=&quot;language-text&quot;&gt;트랜잭션&lt;/code&gt; 을 적용할 수 있다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserRepository&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Transactional&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 트랜잭션 적용&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;UserCreateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;자세한 적용 원리나 옵션에 대해서는 &lt;code class=&quot;language-text&quot;&gt;Spring Boot&lt;/code&gt;의 &lt;a href=&quot;https://docs.spring.io/spring-framework/reference/data-access/transaction/declarative/annotations.html&quot;&gt;@Transactional&lt;/a&gt; Annotation에 대해 학습이 필용하지만, 위 방법으로 단순하고 간단하게 &lt;code class=&quot;language-text&quot;&gt;트랜잭션&lt;/code&gt;을 적용할 수 있다.&lt;/p&gt;
&lt;p&gt;이것이 가능하게 하는 것이 바로 &lt;strong&gt;AOP (Aspect-Oriented Programming, 관점 지향 프로그래밍, 이하 AOP)&lt;/strong&gt; 이다.&lt;/p&gt;
&lt;h2 id=&quot;AOP&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#AOP&quot; aria-label=&quot;AOP permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;AOP?&lt;/h2&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;AOP 설명을 목적으로 하는 포스트는 아니기 때문에 단순하게 설명함으로 양해 부탁드립니다. 자세한 이론적인 내용은 &lt;a href=&quot;https://ko.wikipedia.org/wiki/%EA%B4%80%EC%A0%90_%EC%A7%80%ED%96%A5_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D&quot;&gt;위키백과 - AOP&lt;/a&gt; 를 참고 하길 바랍니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;쉽게 말하자면 &lt;code class=&quot;language-text&quot;&gt;비즈니스 로직은  건들지 않고, 공통적으로 해야 하는 일을 앞, 뒤로 끼워넣는 프로그래밍 기법&lt;/code&gt; 이다.
&lt;br&gt;&lt;/p&gt;
&lt;p&gt;만약 프로젝트 내 모든 메소드의 실행 시간을 기록해야 한다면 어떨까?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; startTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 비즈니스 로직&lt;/span&gt;
	log endTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;endTime &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; startTime &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ms&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 코드와 같은 포맷이 모든 메소드에 추가 되어야 할 것이다. 하지만 다음과 같이 구현한다면?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Measure&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 비즈니스 로직&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;단순히 &lt;code class=&quot;language-text&quot;&gt;@Measure&lt;/code&gt; 을 붙이는 것만으로 해결할 수 있다면 우리는 비즈니스 로직 앞 뒤에 아무것도 붙이지 않고, 깨끗하게 비즈니스 로직에만 집중 할 수 있다. 사실 메소드 소요 시간 측정은 정말 가벼운 기능이 추가되는 것이지만, 더 복잡한 로직이 생기게 된다면, 비즈니스 로직보다 공통 로직이 더 많은 부분을 차지하는 기이한 현상이 벌어질 수 있다.&lt;/p&gt;
&lt;p&gt;그렇기 때문에 Spring Boot 환경에서는 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; Annotation을 통해 간단하게 &lt;code class=&quot;language-text&quot;&gt;트랜잭션&lt;/code&gt; 을 적용할 수 있는 방법을 제공한다.&lt;/p&gt;
&lt;h2 id=&quot;Nodejs-환경에서의-트랜잭션&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Nodejs-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98&quot; aria-label=&quot;Nodejs 환경에서의 트랜잭션 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Node.js 환경에서의 트랜잭션&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;트랜잭션은 Node.js 환경에서도 물론 필요하다. 그렇기 때문에 적용할 수 있어야 한다. 하지만 관심을 가지지 않으면 단독적으로 트랜잭션이 적용될 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; userRepository&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UsreRepository&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; UserDetailRepository&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserDetailRepositoty
	&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;	&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; userDetail &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userDetailRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;우리의 기대와 달리, 트랜잭션이 &lt;code class=&quot;language-text&quot;&gt;userRepository.save()&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;userDetailRepository.save()&lt;/code&gt; 에 각각 적용된다.
어느 하나라도 실패가 된다면, 다른 쿼리도 &lt;code class=&quot;language-text&quot;&gt;Rollback&lt;/code&gt;  이 되어야 하지만, 실패해도 롤백이 이루어지지 않는다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/13bf03fb35bdb35abb81099c00d48758/39b47/double-tx-image.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 12.352941176470589%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdUlEQVR42jXNSw7CMAwE0N6kKP7FpE0TCZCAsoT732hwVFhYY1vW89R7w2X/4PZ64/HcUWuFiCJnQxIHWwap4qRLpCOxQGJm5rgT6K8fRUSYemuw7Q5ZryjLilLOgeWjzODumHnABgpgti0ynlCCxe4PDXyAX7i0OuFJj26iAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;개별적으로 트랜잭션이 적용되는 모습&apos; title=&apos;&apos; src=&apos;/static/13bf03fb35bdb35abb81099c00d48758/ca1dc/double-tx-image.png&apos; srcset=&apos;/static/13bf03fb35bdb35abb81099c00d48758/e7570/double-tx-image.png 170w,
/static/13bf03fb35bdb35abb81099c00d48758/f46e7/double-tx-image.png 340w,
/static/13bf03fb35bdb35abb81099c00d48758/ca1dc/double-tx-image.png 680w,
/static/13bf03fb35bdb35abb81099c00d48758/02d09/double-tx-image.png 1020w,
/static/13bf03fb35bdb35abb81099c00d48758/9d567/double-tx-image.png 1360w,
/static/13bf03fb35bdb35abb81099c00d48758/39b47/double-tx-image.png 2034w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;개별적으로 트랜잭션이 적용되는 모습&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;TypeORM 설정에서 &lt;code class=&quot;language-text&quot;&gt;logging&lt;/code&gt; 옵션을 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt; 로 두고 &lt;code class=&quot;language-text&quot;&gt;데이터베이스 로그&lt;/code&gt; 를 확인해보면 트랜잭션이 각각 분리되어 전송되는 것을 확인할 수 있다. &lt;/p&gt;
&lt;p&gt;만약 둘 중 하나가 실패한다면? 정상적으로 롤백이 이루어질까? 일부러 둘 중 하나의 로직이 실패하게 유도하고 결과를 지켜보자.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 374px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/c39cd1c8c9a267193cf6f59e629867c9/b0af8/no-rollback-result.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 73.52941176470587%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACyUlEQVR42pVTa28SQRTd/2AfRi2PPsSyy5vdhe3yhiUs77bQQmlLa4ECTasxVqNJE6OJ8YuJf5aPe7wzWyypX/TDyd07O/fMmXvPCLrZQqZURaW5B92oYqe0i87xJfqjW1xd3WIyvcVp/wonp1OcnExw/PodWr0RtGIDhdo+Ggc9ZM2apRk16KXmTIgTYcKoEOE+4jkT8UIVB70pehcfcHP9GZPJR3Q7ExvdMTq9G7Q6I+jlNsy9LlpHZ8iVG5aaKSGer84ELRaDz+eDKErw+/0UvSibJoaDAcbjCUajEQb0PZ1OcHZ+juFwiFwui3qthna7jVAoDK8oWoFAgPHMhEAgSCQiJEnixPOoKAo0TYMsy5CjUZ5HIhGes/8MwWCQi6Aai9URz0wIh8Ng7Ozn/SLfxDA/YH7IIuZ7WC2BK6R8JmxtbcHpdHIwcqZifX0dbrebY67kvhD21R7I/DaRZQsgQpfTgaerq1haWkY6lYJRyOPF82dYWX6ClZUleDwv4fVuU5+8pH4bEt3AxyCJvN8890lWgCkXvTNBSeSgJDJIZbKIxHT4FB2JbBHVZgfV+iGaux3st45Qr7fJCUcwzCZkPYN4Kod0vohEpoB4MmsptCanCjNBr3SgVQ7R6vZQouKo0US53cfFzXdcv/+Bb19/4e7uJ8aXn3A+/oLu2VvEKl00ewNcTN+gf3mNRqdvMbtp5UPyoZ6ErMYRVTUosR3ISgzaTpKubiKfn6OEPOVsLUOKlJjGEaU6mSLBUnmtSlOmIbB++Pn0JB5ZX1jfRN63v2Hvs/fakCxeL0kzIRKV+cSCoZANmujjqS6C22U+3QdYLPqYbcKRKPlMpGl6wCzE4ubmJvfjot8Wvfl47cE29FLcGxtYW1tDilnGMFAsFmHS02Pkq2QnRvxH2b8Qel5tw+VyQVVVJJNJ/tzS6TQndDgc/JX8D+FvUX33GYQBovMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;User 테이블은 데이터 저장, UserDetail 테이블은 Rollback&apos; title=&apos;&apos; src=&apos;/static/c39cd1c8c9a267193cf6f59e629867c9/b0af8/no-rollback-result.png&apos; srcset=&apos;/static/c39cd1c8c9a267193cf6f59e629867c9/e7570/no-rollback-result.png 170w,
/static/c39cd1c8c9a267193cf6f59e629867c9/f46e7/no-rollback-result.png 340w,
/static/c39cd1c8c9a267193cf6f59e629867c9/b0af8/no-rollback-result.png 374w&apos; sizes=&apos;(max-width: 374px) 100vw, 374px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;User 테이블은 데이터 저장, UserDetail 테이블은 Rollback&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;예상했던 결과처럼 &lt;code class=&quot;language-text&quot;&gt;User&lt;/code&gt; 테이블에는 데이터가 성공적으로 삽입되었고, 에러가 발생한 &lt;code class=&quot;language-text&quot;&gt;UserDetail&lt;/code&gt; 데이터는 삽입되지 않았다.&lt;/p&gt;
&lt;h2 id=&quot;트랜잭션-적용하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0&quot; aria-label=&quot;트랜잭션 적용하기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;트랜잭션 적용하기&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;지금까지 트랜잭션이 정상적으로 적용되지 않는다는 것을 알 수 있었다. 이제 NestJS과 TypeORM에서 지원하는 트랜잭션 적용 방법을 알아보도록 하겠다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; dataSource&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; DataSource&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; queryRunner &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataSource&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createQueryRunner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	
		&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;startTransaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// TRANSACTION START&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;User&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// User 저장&lt;/span&gt;
			
			&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; detail &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;UserDetail&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;detail&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// UserDetail 저장&lt;/span&gt;
			
			&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;commitTransaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// COMMIT&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;rollbackTransaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;release&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;심히 당황스럽다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;핵심 로직은 엔티티를 생성하고, 저장하는 &lt;code class=&quot;language-text&quot;&gt;4줄&lt;/code&gt; 밖에 되지 않는다. 하지만 트랜잭션 로직 때문에 간단한 &lt;code class=&quot;language-text&quot;&gt;createUser()&lt;/code&gt; 함수가 거대해졌다. 혹시라도 함수의 내용이 방대해지거나, 분리가 필요하면 트랜잭션의 추적도 쉽지 않을 것이다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;DataSource를 의존성 주입을 받을 수 있는 이유&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;@nestjs/typeorm&lt;/code&gt; 의존성을 통해 &lt;code class=&quot;language-text&quot;&gt;TypeOrmModule&lt;/code&gt; 을 import 하면 내부에서 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt; , &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 등을 기본적으로 &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;로 추가한다.
&lt;br&gt; 실제 코드는 &lt;a href=&quot;https://github.com/nestjs/typeorm/blob/master/lib/typeorm-core.module.ts&quot;&gt;@nestjs/typeorm typeorm-core-module.ts&lt;/a&gt; 에서 확인할 수 있다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;그럼 다음과 같은 코드는 작동하지 않을까? &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; em&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; EntityManager&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; userRepository&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserRepository&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;em&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;transaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/72d02875930c5b3a7dc34d79088a7f26/a52c7/nested-tx-image.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 8.823529411764705%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAbElEQVR42j2M0Q3CQAxDOwkksdODEz8doRJVJSTYfxtzOQm+nmM7Xvbzo/P11nE81XsXSbXW5Gwy3oSEPJuu60McjIiZZ6YATNZP+cUltl3mmMcvzKQsUoZVIIamLrgrODyz2akxd//rGix+AZrSOgltq3QdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;트랜잭션이 중첩되는 모습&apos; title=&apos;&apos; src=&apos;/static/72d02875930c5b3a7dc34d79088a7f26/ca1dc/nested-tx-image.png&apos; srcset=&apos;/static/72d02875930c5b3a7dc34d79088a7f26/e7570/nested-tx-image.png 170w,
/static/72d02875930c5b3a7dc34d79088a7f26/f46e7/nested-tx-image.png 340w,
/static/72d02875930c5b3a7dc34d79088a7f26/ca1dc/nested-tx-image.png 680w,
/static/72d02875930c5b3a7dc34d79088a7f26/02d09/nested-tx-image.png 1020w,
/static/72d02875930c5b3a7dc34d79088a7f26/9d567/nested-tx-image.png 1360w,
/static/72d02875930c5b3a7dc34d79088a7f26/a52c7/nested-tx-image.png 2024w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;트랜잭션이 중첩되는 모습&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;결과는 기대했던 결과와는 달리 &lt;code class=&quot;language-text&quot;&gt;트랜잭션&lt;/code&gt;이 중첩되어 실행된다.&lt;/p&gt;
&lt;p&gt;결론부터 말하자면, &lt;code class=&quot;language-text&quot;&gt;UserService의 EntityManager&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;UserRepository의 EntityManager&lt;/code&gt;가 서로 다른 참조를 하고 있다는 것이다.  &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;UserService&lt;/code&gt; 에 주입된 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;transaction&lt;/code&gt;을 통해 생성된 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;UserRepository&lt;/code&gt; 에서 참조하는 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 는 같지 않다. &lt;/p&gt;
&lt;p&gt;이는 &lt;a href=&quot;&quot;&gt;TypeORM 공식 Github&lt;/a&gt; 코드를 통해 확인 할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* typeorm/src/entity-manager/EntityManager.ts  */&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;transaction&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 만약 해당 클래스에 QueryRunner가 이미 할당되어있다면, EntityManager가&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 이미 Single Connection을 생성한 것 입니다.&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 만약 정의되지 않은 경우, 모든 작업을 실행할 새로운 Single Connection을 생성합니다.&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; queryRunner &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;queryRunner &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;connection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createQueryRunner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 코드는 공식 &lt;code class=&quot;language-text&quot;&gt;TypeORM&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;EntityManager.ts&lt;/code&gt; 의 코드 중 &lt;code class=&quot;language-text&quot;&gt;transaction()&lt;/code&gt; 함수 중 일부를 발췌한 것이다. 해당 코드는 쿼리 시에 사용할 &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 를 정의하는데, 이미 사용하고 있는 &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 가 없다면 새로운 &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 를 생성한다. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;this.connection.createQueryRunner()&lt;/code&gt; 함수를 통해 새로운 &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 를 생성하게 되는데 이는 &lt;code class=&quot;language-text&quot;&gt;DataSource.ts&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;createQueryRunner()&lt;/code&gt; 와 같다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* typeorm/src/data-source/DataSource.ts */&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;createQueryRunner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mode&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ReplicationMode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;master&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; QueryRunner &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; queryRunner &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createQueryRunner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; manager &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createEntityManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;queryRunner&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;assign&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;queryRunner&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; manager&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; manager &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; queryRunner
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;createEntityManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;queryRunner&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; QueryRunner&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; EntityManager &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EntityManagerFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;실질적인 &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 는 각 &lt;code class=&quot;language-text&quot;&gt;Database Driver&lt;/code&gt; 를 구현한 구현체에 맡기고, &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 는 &lt;code class=&quot;language-text&quot;&gt;DataSource.ts&lt;/code&gt; 에 정의된 &lt;code class=&quot;language-text&quot;&gt;createEntityManager()&lt;/code&gt; 함수를 통해 생성하여, &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;manager&lt;/code&gt; 에 저장한다. &lt;/p&gt;
&lt;p&gt;그렇기 때문에 &lt;code class=&quot;language-text&quot;&gt;UserService&lt;/code&gt; 에 주입된 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;UserRepository에서&lt;/code&gt; 참조하는 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 가 서로 다른 객체를 참조하고 있는 것이다.&lt;/p&gt;
&lt;p&gt;그럼 어떻게 &lt;code class=&quot;language-text&quot;&gt;EntityManager.transaction()&lt;/code&gt; 의 인자로 주어진 함수에서 같은 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 를 사용할 수 있을까? &lt;/p&gt;
&lt;p&gt;이 내용은 앞서 이야기 했던 &lt;code class=&quot;language-text&quot;&gt;AOP&lt;/code&gt; 라는 주제와 함꼐 직접 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; 을 구현하여, 적용해보는 내용을 &lt;a href=&quot;&quot;&gt;다음 글&lt;/a&gt; 에 소개하도록 하겠다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[IntelliJ Mouse Wheel Zoom 이슈]]></title><description><![CDATA[어느 날, 마우스 휠 Up, Down을 통해 IntelliJ Editor의 Font Size 조절이 갑자기 되지 않았다.  옵션을 건드려봐도, Mac 자체에서 지원하는 Zoom이 될 뿐, Editor의 Font Size…]]></description><link>https://jindaram.site/intellij-zoom-issue/</link><guid isPermaLink="false">https://jindaram.site/intellij-zoom-issue/</guid><pubDate>Thu, 15 May 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;어느 날, 마우스 휠 Up, Down을 통해 IntelliJ Editor의 Font Size 조절이 갑자기 되지 않았다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;IntelliJ IDEA -&gt; Settings -&gt; Editor -&gt; General -&gt; Change font size in Command + Mouse Wheel in&lt;/code&gt; 옵션을 건드려봐도, Mac 자체에서 지원하는 Zoom이 될 뿐, Editor의 Font Size가 변경되지는 않았다.&lt;/p&gt;
&lt;h2 id=&quot;해결방법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95&quot; aria-label=&quot;해결방법 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;해결방법&lt;/h2&gt;
&lt;h3 id=&quot;1-손쉬운-사용-설정-켜져있는지-확인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%EC%86%90%EC%89%AC%EC%9A%B4-%EC%82%AC%EC%9A%A9-%EC%84%A4%EC%A0%95-%EC%BC%9C%EC%A0%B8%EC%9E%88%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8&quot; aria-label=&quot;1 손쉬운 사용 설정 켜져있는지 확인 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;1. 손쉬운 사용 설정 켜져있는지 확인&lt;/h3&gt;
&lt;p&gt;나의 경우 &lt;code class=&quot;language-text&quot;&gt;손쉬운 사용 -&gt; 확대/축소&lt;/code&gt; 에서 &lt;code class=&quot;language-text&quot;&gt;스크롤 제스처를 위한 보조 키&lt;/code&gt; 에 &lt;code class=&quot;language-text&quot;&gt;Command(⌘)&lt;/code&gt;가 매핑되어 있었다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 484px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/b28f5b5a4971fa7438807e660a95741a/6ad3c/image.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 74.11764705882352%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+ElEQVR42o2T6VIaURBG510iss0KyD6ssm8mKoIISZXJ+z/ClzltTcpSsPLjq54L93af3pww8BT4rgr5rJaLuU6no3rd2M5uMa9iIfdfSu86vldMHueUy2Z0UymrE7cTW7Iz4pLnFr4UzriLdaLQ13QySTTWYj5PNNNsOjXazWatVrORXCzI99yz8tyiojDQ97s7lUuRnEo50sP9vdarpcajW03GIzXqddWqN6rXqipFoT265BAFvmeBw8CXw4Nut6O43ZbvusrnslYCxHexkP/SWUqZy16bdWhIu9VUs1FXNaEiUqNes3PcbhllSniJFLJuJ34jJO9fP0/a73baPW213+/0cnjW0/ZRh+e9We6QCZZH52q4Wa/sjjWl3+smo9KxKFBBl5IiMoAUWymXPpFyzlx9e0vZcBNng0Ffo9uhOcQOBwOzdJ9mzWczC/ix4ykh02GEaf7MXyeOjfQ9LaTQ8Q0tHcVBKt5jCVqKAgbb1aDfswjDhHKVjA9kOOUxXYYKi+g+JWK8cEJ56HBaZyNkZKBg9hCOPorAbBLE3MHRarmwZmApiQ02mGzEKIlG3c7VCYf8xn+b9doyYt9Px6P+/H7V8eWQLMcPa9i/XUZpepcGmP8YdizN4Ps6c2Vrun18EFtnDsMg+JTepRV7L8qFJTvSpoZ/Ae1g5wJ+1W+RAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;스크롤 제스처를 위한 보조 키에 Command(⌘)가 설정되어 있다.&apos; title=&apos;&apos; src=&apos;/static/b28f5b5a4971fa7438807e660a95741a/6ad3c/image.png&apos; srcset=&apos;/static/b28f5b5a4971fa7438807e660a95741a/e7570/image.png 170w,
/static/b28f5b5a4971fa7438807e660a95741a/f46e7/image.png 340w,
/static/b28f5b5a4971fa7438807e660a95741a/6ad3c/image.png 484w&apos; sizes=&apos;(max-width: 484px) 100vw, 484px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;스크롤 제스처를 위한 보조 키에 Command(⌘)가 설정되어 있다.&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;이러한 경우 &lt;code class=&quot;language-text&quot;&gt;스크롤 제스처를 위한 보조 키&lt;/code&gt; 옵션을 다른 키로 설정하여 주고, IntelliJ의 &lt;code class=&quot;language-text&quot;&gt;IntelliJ IDEA -&gt; Settings -&gt; Editor -&gt; General -&gt; Change font size in Command + Mouse Wheel in&lt;/code&gt; 옵션이 켜져있으면 정상적으로 마우스 휠을 통해 Font Size 조절이 가능하다.&lt;/p&gt;
&lt;h3 id=&quot;2-Keymap&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-Keymap&quot; aria-label=&quot;2 Keymap permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;2. Keymap&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;스크롤 제스처를 위한 보조 키&lt;/code&gt; 옵션을 변경하지 않고 해결하는 방법은 바로 IntelliJ의 &lt;code class=&quot;language-text&quot;&gt;Keymap&lt;/code&gt;을 활용하는 것이다. &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;IntelliJ IDEA&lt;/code&gt; -&gt; &lt;code class=&quot;language-text&quot;&gt;Settings&lt;/code&gt; -&gt; &lt;code class=&quot;language-text&quot;&gt;Keymap&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Increase Font Size&lt;/code&gt; 검색 &lt;br&gt;
a. &lt;code class=&quot;language-text&quot;&gt;Add ... Shortcut&lt;/code&gt; 선택 후 단축키 입력&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Decrease Font Size&lt;/code&gt; 검색 &lt;br&gt;
a. &lt;code class=&quot;language-text&quot;&gt;Add ... Shortcut&lt;/code&gt; 선택 후 단축키 입력&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/c1489db4075d67cec2be0f9a1c6d5fd4/06066/image-1.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 19.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA30lEQVR42k3QyU7DMBSF4bwKTatmcAZndqa2SROEEF0SISQkWPA4LFkgxIYH/XFIF1l8sn1kWdfHsESIo+0sVxP/63Zls3fIQkmvKoa6YWxahrKi1FkpI5TWxDEyjNnaHkbd31L0d8jqxI2IsIIEJ0xxgoXtpxSpom9PjN3AcDxzPnRUmaLKS0qtLSqiRLHRAxm5Pny+PPL9OvExXThkBaYrsT39+NVOSJ2FmE6w0Ps5W/OjlL0bYAjX52u65/f5ws/TA6NSuFGOrWsw9/O3xVKFveZd61nM997fOuom4Q9/q4Hj4Ta/ywAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;Keymap - Increase Font Size 검색 화면&apos; title=&apos;&apos; src=&apos;/static/c1489db4075d67cec2be0f9a1c6d5fd4/ca1dc/image-1.png&apos; srcset=&apos;/static/c1489db4075d67cec2be0f9a1c6d5fd4/e7570/image-1.png 170w,
/static/c1489db4075d67cec2be0f9a1c6d5fd4/f46e7/image-1.png 340w,
/static/c1489db4075d67cec2be0f9a1c6d5fd4/ca1dc/image-1.png 680w,
/static/c1489db4075d67cec2be0f9a1c6d5fd4/06066/image-1.png 729w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;Keymap - Increase Font Size 검색 화면&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;해당 설정은 &lt;code class=&quot;language-text&quot;&gt;스크롤 제스처를 위한 보조 키&lt;/code&gt; 옵션에 &lt;code class=&quot;language-text&quot;&gt;Command(⌘)&lt;/code&gt;가 설정되어 있고, 바꾸고 싶지 않을 때 사용할 수 있는 설정이다. 단축키 설정 시, &lt;code class=&quot;language-text&quot;&gt;Command(⌘)&lt;/code&gt;가 들어가지 않게 설정하여야 유효하게 사용할 수 있다.&lt;/p&gt;</content:encoded></item></channel></rss>