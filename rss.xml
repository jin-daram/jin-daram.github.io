<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[RSS Feed of Let's solve it]]></title><description><![CDATA[문제들을 한번 해결해봅시다.]]></description><link>https://jin-daram.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Mon, 16 Jun 2025 07:20:23 GMT</lastBuildDate><item><title><![CDATA[Redis-Sentinel에 대해 알아보고 직접 구현해보기]]></title><description><![CDATA[은  의 고가용성 (High Availabiliity)를 보장하기 위한 시스템입니다. 많은 요청을 처리해야 하는 서비스에서 만약 한 대의 Redis만 사용한다면 과도한 부하로 인해 장애가 발생했을 때, Redis…]]></description><link>https://jin-daram.github.io/redis-sentinel/</link><guid isPermaLink="false">https://jin-daram.github.io/redis-sentinel/</guid><pubDate>Mon, 16 Jun 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Redis Sentinel&lt;/code&gt; 은 &lt;code class=&quot;language-text&quot;&gt;Redis&lt;/code&gt; 의 &lt;strong&gt;고가용성 (High Availabiliity)&lt;/strong&gt;를 보장하기 위한 시스템입니다.&lt;/p&gt;
&lt;p&gt;많은 요청을 처리해야 하는 서비스에서 만약 한 대의 Redis만 사용한다면 과도한 부하로 인해 장애가 발생했을 때, Redis에 의존하는 서비스들은 정상적으로 운영하기 어렵고, 성능이 대폭 감소할 수 있습니다. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;고가용성이란?&lt;br&gt;&lt;/strong&gt;
고가용성 (HA, High Availability) 란? 쉽게 말해서 어떠한 서버나 시스템이 오랫 동안 정상 운영이 가능한 정도를 이야기 합니다. 장애가 발생하더라도, 이를 빠른 시간 안에 복구하고, 정상적인 서비스를 운영하여 서비스 신뢰성을 복구한다면 고가용성이 높다라고 말할 수 있습니다.&lt;/p&gt;
&lt;p&gt;고가용성을 높이는 방법과 전략에는 여러가지가 있지만, 본 포스트에서는 &lt;code class=&quot;language-text&quot;&gt;Redis-Sentinel&lt;/code&gt; 을 중심적으로 설명하겠습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Redis-Sentinel&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Redis-Sentinel&quot; aria-label=&quot;Redis Sentinel permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Redis-Sentinel&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;Redis Sentinel 은 앞서 말했듯이 Redis의 고가용성을 보장하기 위한 시스템입니다. 분산 환경에서는 Redis가 여러 노드에 걸쳐 동작됩니다. 모니터링을 통해 &lt;code class=&quot;language-text&quot;&gt;master&lt;/code&gt; 및 &lt;code class=&quot;language-text&quot;&gt;replica&lt;/code&gt; 가 정상적으로 동작하는지 확인하고, 자동으로 장애를 복구할 수 있는 기능을 제공합니다.&lt;/p&gt;
&lt;p&gt;보통의 Sentinel은 3개 이상의 인스턴스를 구성합니다. 이렇게 구성하면 합의를 통해 장애 여부를 판단할 수 있어 더욱 더 안정적인 시스템을 구성할 수 있습니다.&lt;/p&gt;
&lt;h3 id=&quot;주요-개념&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A3%BC%EC%9A%94-%EA%B0%9C%EB%85%90&quot; aria-label=&quot;주요 개념 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;주요 개념&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;Quorum&lt;/strong&gt; &lt;br&gt;
Quorum(합의) 이란 각각의 Sentinel 들이 master 가 죽었다고 판단할 때 &lt;code class=&quot;language-text&quot;&gt;필요한 최소한의 합의 수&lt;/code&gt; 입니다.
만약 &lt;code class=&quot;language-text&quot;&gt;Quorum = 3&lt;/code&gt; 이라면, 최소 3개의 Sentinel 이 &lt;code class=&quot;language-text&quot;&gt;master&lt;/code&gt; 가 죽었다고 판단해야 장애 복구가 시작 됩니다.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Failover&lt;/strong&gt; &lt;br&gt;
Failover 란 시스템에 한 구성 요소에 장애가 발생했을 때, 즉시 다른 예비 시스템으로 대체하여 서비스를 계속해서 지속하는 기능입니다. Redis Sentinel 에서는 master 에 장애가 발생하였을 때, 여러 replica 인스턴스 중 1개를 master를 승격 시키는 것을 의미합니다.&lt;/p&gt;
&lt;h3 id=&quot;What-is-Sentinel&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#What-is-Sentinel&quot; aria-label=&quot;What is Sentinel permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;What is Sentinel?&lt;/h3&gt;
&lt;hr&gt;
&lt;p&gt;1개의 Redis 인스턴스만을 사용한다면, 해당 Redis에 부하가 생겨 장애가 발생했을 때, Redis에 의존하는 서비스들은 정상적으로 운영하기 어렵고, 성능이 대폭 감소할 우려가 있습니다. &lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/86496f216a26e2a7e3c0d8546994ccf0/bbbf7/redis-master-slave.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqElEQVR42n1STS8DQRjuHxK/wFEcJA70LMQPaELCzQ+QHpwcSFwdOeDQINRBfLXFso1abD827XY/Zmd3ZvZjZnhXm2gFz+mdmfd5nvdjMh8DSIQ4fdL2S0/nqgbB8cPziVK7rOlHynNR1UpvTSHlYH5m8CClrBrmlVZXW51qyyzrRqXRqbUttdm5eW2ozbb8hwwQnIskYSQQABokbaNHkJxLIaIo+p0MyYwxDhRCuo5r63phanJ3dKSys2O4rmPZlmW5rjtoPuRMKfU8LwxDLmTC2NnSYmF+zlAUTAgoAvlPZwBjIcYeQsjHPkgEjJm2zTmHGHTjJBag+tMZzqJ/ixFGjkOIb1s2BI6VglLfMk0SUBCK43iIzNMlpcxmDW0sX68vXKglnVC/lxEQ/KK0tlfv12aL749O6iX65hloRtnavM3nYca6inJjBysThWqlzkISRTE04hNPLdeXxwu5sUPtvguThRJ7ZWaw5+1lZ3az09BrWrbLiB9ynsAzFAkTgi3APfEjjEi6soRLLvrOkIQ86BTLnuCXpBDix3/4/kg0CO7KDgIG/gREoWNn3XsudQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;Redis Master-Replica&apos; title=&apos;&apos; src=&apos;/static/86496f216a26e2a7e3c0d8546994ccf0/ca1dc/redis-master-slave.png&apos; srcset=&apos;/static/86496f216a26e2a7e3c0d8546994ccf0/e7570/redis-master-slave.png 170w,
/static/86496f216a26e2a7e3c0d8546994ccf0/f46e7/redis-master-slave.png 340w,
/static/86496f216a26e2a7e3c0d8546994ccf0/ca1dc/redis-master-slave.png 680w,
/static/86496f216a26e2a7e3c0d8546994ccf0/02d09/redis-master-slave.png 1020w,
/static/86496f216a26e2a7e3c0d8546994ccf0/bbbf7/redis-master-slave.png 1280w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;Redis Master-Replica&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;이를 해결하기 &lt;code class=&quot;language-text&quot;&gt;Master-Replica&lt;/code&gt; 구조로 Redis 환경을 구성하는데요, 이는 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 를 통해 데이터를 쓰고, 다수의 &lt;code class=&quot;language-text&quot;&gt;Replica Redis 인스턴스&lt;/code&gt;에서 데이터를 읽는 구조인 것 입니다. 상대적으로 읽기 처리를 해야 하는 서비스가 많기 때문에 읽기 전용 &lt;code class=&quot;language-text&quot;&gt;Replica Redis 인스턴스&lt;/code&gt; 를 늘리는 구조입니다.&lt;/p&gt;
&lt;p&gt;데이터가 여러 인스턴스에 복제되어 있어, 읽기 요청 처리를 분산 시킬 수 있어 부하를 줄일 수 있다는 장점이 있습니다.&lt;/p&gt;
&lt;p&gt;그런데 만약 이러한 구조에서 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 에 문제가 생기면 어떻게 될까요?&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/53c34ea4bce50be889c11e42b2574e88/ec6be/net-connected.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 10.588235294117647%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdElEQVR42lWNWxKCMAxF2Y2OVqRNS5sALTII7n9D15g/P87kOfd0T5pAZUXIDZFfkPZBnt9IvBlDXPDwgj6IVoYbivaMWz/i6iIud/qj+z3laQfXQ4N2DTwh9URZDpWshh8bkmx2J51J5UF3PlUTGTTDecEXgOVBcg2i1yUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;net connected&apos; title=&apos;&apos; src=&apos;/static/53c34ea4bce50be889c11e42b2574e88/ca1dc/net-connected.png&apos; srcset=&apos;/static/53c34ea4bce50be889c11e42b2574e88/e7570/net-connected.png 170w,
/static/53c34ea4bce50be889c11e42b2574e88/f46e7/net-connected.png 340w,
/static/53c34ea4bce50be889c11e42b2574e88/ca1dc/net-connected.png 680w,
/static/53c34ea4bce50be889c11e42b2574e88/02d09/net-connected.png 1020w,
/static/53c34ea4bce50be889c11e42b2574e88/9d567/net-connected.png 1360w,
/static/53c34ea4bce50be889c11e42b2574e88/ec6be/net-connected.png 2352w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Application 운영 도중 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 에 장에가 발생하면 위와 같이 Connection 끊깁니다.&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/da27ebc45a1d47496a8769dfb0a8b74b/8badf/reconnecting.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 4.117647058823529%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAASklEQVR42h2KUQ6AIAzFPI8KBjYYOhA03v9Kz+lHk6bplPYL+bhBUkGxI+QTX/PcsEiHM1/LgKsPZlKE1MDWSMb/cTHMfVRspHgBIf4g9ocRU7MAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;reconnecting&apos; title=&apos;&apos; src=&apos;/static/da27ebc45a1d47496a8769dfb0a8b74b/ca1dc/reconnecting.png&apos; srcset=&apos;/static/da27ebc45a1d47496a8769dfb0a8b74b/e7570/reconnecting.png 170w,
/static/da27ebc45a1d47496a8769dfb0a8b74b/f46e7/reconnecting.png 340w,
/static/da27ebc45a1d47496a8769dfb0a8b74b/ca1dc/reconnecting.png 680w,
/static/da27ebc45a1d47496a8769dfb0a8b74b/02d09/reconnecting.png 1020w,
/static/da27ebc45a1d47496a8769dfb0a8b74b/9d567/reconnecting.png 1360w,
/static/da27ebc45a1d47496a8769dfb0a8b74b/8badf/reconnecting.png 2750w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;이후, &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 가 정상적으로 동적하게 되면 재연결하여 이전처럼 정상적으로 Redis를 사용할 수 있게됩니다. &lt;/p&gt;
&lt;p&gt;하지만 이렇게 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 에 장애가 생기면 사람이 직접 장애를 복구해야 하고, 이로 인해 긴 시간 동안 Redis를 사용 하지 못하면서 DB에 부하가 생겨 **전체 시스템에 장애가 전파될 수도 있습니다. **&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/4d816936d6794f5104f555abd4715bd1/e5adc/problem-ocurred.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 34.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABOElEQVR42k2QS0vDQBSF8/9x69JV68KdSrHQRdFaS20lVaFIH0aF5v2YvCbJJJO5HqMFz2L47nDPfWnUSTZ1GvhlnnKepUmcpmme52EYMsYACJMkybIMEMcxHaUJRRbj66RYecmHkDbj8qdWU1UVnPAAmqZBKqAoClTknIPbttX2kgazze39S7+gyejxUv+yFWVRaDtO1MlxHFQRQgB83wcHQQAuy1J756qf0PVwujw5vZqte4zsSmUxOxxMXddXq5VlWRgVqfDsdrv5fI7X8zxMoe0LOvdpOJhMzy5uxnovIEvAHJmW9dzJNM1fM9oahrFYLLbb7Z/5U9Lo4W283PQE3U1eh0+GS5SxyHVd1gkAc13XADQHY20w1tZaRWFZ21J5QjlNy8paEbVSIlschdvgYP9/wET0DeUSgSxwtgBrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;Master Redis Instance에 장애가 발생한 상황&apos; title=&apos;&apos; src=&apos;/static/4d816936d6794f5104f555abd4715bd1/ca1dc/problem-ocurred.png&apos; srcset=&apos;/static/4d816936d6794f5104f555abd4715bd1/e7570/problem-ocurred.png 170w,
/static/4d816936d6794f5104f555abd4715bd1/f46e7/problem-ocurred.png 340w,
/static/4d816936d6794f5104f555abd4715bd1/ca1dc/problem-ocurred.png 680w,
/static/4d816936d6794f5104f555abd4715bd1/e5adc/problem-ocurred.png 826w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;Master Redis Instance에 장애가 발생한 상황&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;하지만 여전히 &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt; 는 정상적으로 운영이 가능합니다. &lt;code class=&quot;language-text&quot;&gt;Redis-Sentinel&lt;/code&gt; 은 바로 이 여분의 Replica를 Master로 승격시켜, 장애를 복구하는 시스템을 의미합니다. &lt;/p&gt;
&lt;p&gt;하지만 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 에 장애가 발생했다고 어떻게 판단할까요? 그것을 판단하는 것이 바로 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 이란 존재입니다.&lt;/p&gt;
&lt;h3 id=&quot;Sentinel의-역할&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Sentinel%EC%9D%98-%EC%97%AD%ED%95%A0&quot; aria-label=&quot;Sentinel의 역할 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Sentinel의 역할&lt;/h3&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;모니터링&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;자동 장애 조치&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;알림&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 은 대략적으로 위와 같은 역할을 합니다. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Master Instance&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;Replica Instance&lt;/code&gt; 를 주기적으로 모니터링하여 장애가 발생했는지 확인합니다. &lt;/p&gt;
&lt;p&gt;이에 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 가 응답하지 않으면 &lt;code class=&quot;language-text&quot;&gt;주관적 다운&lt;/code&gt; 상태로 판단합니다.
또한 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 가 여러 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 등에 다운됐다고 판단되면 &lt;code class=&quot;language-text&quot;&gt;Quorum&lt;/code&gt; 을 통해 &lt;code class=&quot;language-text&quot;&gt;객관적 다운&lt;/code&gt; 상태로 판단하여, 여러 &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt; 중 하나를 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 로 승격합니다. &lt;/p&gt;
&lt;p&gt;그리고 나머지 &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt; 들은 새롭게 승격된 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 를 바라보게 만듭니다. 이 외에도 장애 및 복구와 같은 이벤트가 있을 때, 사용자가 설정한 것을 토대로 알림을 전송해주기도 합니다.&lt;/p&gt;
&lt;h3 id=&quot;몇-대의-Sentinel이-필요할까&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%AA%87-%EB%8C%80%EC%9D%98-Sentinel%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%A0%EA%B9%8C&quot; aria-label=&quot;몇 대의 Sentinel이 필요할까 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;몇 대의 Sentinel이 필요할까?&lt;/h3&gt;
&lt;p&gt;앞서, &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 은 여러 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 들에 의해 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 가 다운된 것을 합의한다고 했습니다.
하지만 &lt;code class=&quot;language-text&quot;&gt;단일 Sentinel&lt;/code&gt; 을 운용하고 만약 그 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 에 네트워크 문제가 발생했다면
이를 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt;의 주관적 다운이라고 판단하고 이는 &lt;code class=&quot;language-text&quot;&gt;단일 Sentinel&lt;/code&gt; 이기 때문에 객관적 다운으로 이어집니다. &lt;/p&gt;
&lt;p&gt;그렇게 되면 실제로 장애가 발생하지 않았는데도, &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt;를 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt;로 승격시켜버리는 문제가 발생합니다. 이에 Sentinel 은 &lt;code class=&quot;language-text&quot;&gt;최소 3대&lt;/code&gt; 가 존재해야 이를 객관적으로 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 가 다운됐다고 판단할 수 있기에 과반이 형성될 수 있는 &lt;code class=&quot;language-text&quot;&gt;최소 3대의 Sentinel&lt;/code&gt; 을 운용해야 효과적으로 자동 장애 복구 및 감지 기능을 발휘할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/e5adc/redis-sentinel.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 61.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVR42jWPbVPTQBDH86l96VcQZKQtUqhNC9MC+rLKDLaCtToKFBwFUWrSPNzlLpc0z5dLmnOLurNz+ed3+9+9VeRDlGURuqTMUiHyNImTNM05XywWYRhyztM0TZIkyzIQQOT/UHIp723/wglGLLsO+C+LZdBL5FDt+z74QQghqqoCZxzHjDHwgwCi4KU8+k7PBh/6pBwdfzq4mGuFjDxmI8QeAiEEXWAsCEopaDgxxnmeK4Qv9xPZHU/PHz1+OfzciqWRVkmwmBvmcDgcjUamacIoGAuNptPpYDC4ublxXXdlRkLuW+LkzeT45Mvw9bijJZqQke9ZCGm6puk6PAEeD5Ox4ximOfs9s2wb9MocSDn5Zr2/Nl4JeXqLx5calZJHse/6oR9CgkjjtCiKFfGCyI8CFiy8RVmWipQVEnRWOPPEmAlsCiKrZbSMdW7OMwtSz8yoTCpZWTmaZ6axgiYWBIjiFqxNeqrb6/qHXdZvOioSzrtgvE3VFfEPnxP1NJyYub1D9jreAZA267VpjwpXQbmjsn79bndtWmvc7TZJR+fG2/CsbrQ2vm5tXDe27PYoHM+4DubabXP9qta4b4EZCfzPXPux8+T8Gdw1afevuWG0nl7V1y9rW9YLMN9zbZfubd421y436z932m4P5VhhhafSvuod7PlHXe+wSbqwz2kw2aYdIJDbpHMWfoSFW2QfCoDAsA7tu4IpsDd8LI4QxzbHRFAgyTK1cgy9EXfgCn4BOoJCAUA4qWCVrP4AeI9xnEZb6JkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;redis-sentinel의 대략적인 구조&apos; title=&apos;&apos; src=&apos;/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/ca1dc/redis-sentinel.png&apos; srcset=&apos;/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/e7570/redis-sentinel.png 170w,
/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/f46e7/redis-sentinel.png 340w,
/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/ca1dc/redis-sentinel.png 680w,
/static/7d6f6fd468a22a3ebaeb5d7118ed7fc9/e5adc/redis-sentinel.png 826w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;redis-sentinel의 대략적인 구조&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;구현해보기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B5%AC%ED%98%84%ED%95%B4%EB%B3%B4%EA%B8%B0&quot; aria-label=&quot;구현해보기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;구현해보기&lt;/h2&gt;
&lt;p&gt;간단하게 Docker를 통해 구현해보도록 하겠습니다. 총 6개의 컨테이너의 분류는 다음과 같습니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-replica-1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-replica-2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-sentinel-1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-sentinel-2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;redis-sentinel-3&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;먼저 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 를 올려주도록 하겠습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; run &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt; redis-master &lt;span class=&quot;token parameter variable&quot;&gt;--network&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;NETWORK_NAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;PORT&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;:6379 redis:&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;TAG&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; redis-server &lt;span class=&quot;token parameter variable&quot;&gt;--apendonly&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--appendonly&lt;/code&gt; : 데이터를 영구적으로 저장하기 위한 옵션입니다. &lt;code class=&quot;language-text&quot;&gt;appendonly.aof&lt;/code&gt; 파일에 기록하고 서버 재시작 시 해당 내용을 기반으로 데이터를 복원합니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;다음은 &lt;code class=&quot;language-text&quot;&gt;redis-replica-n&lt;/code&gt; 입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; run &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt; redis-replica-n &lt;span class=&quot;token parameter variable&quot;&gt;--network&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;NETWORK_NAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;PORT&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;:6379 redis:latest redis-server &lt;span class=&quot;token parameter variable&quot;&gt;--slaveof&lt;/span&gt; redis-master &lt;span class=&quot;token number&quot;&gt;6379&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--slaveof&lt;/code&gt; : 호스트가 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 이고 포트가 &lt;code class=&quot;language-text&quot;&gt;6379&lt;/code&gt; 인 마스터를 따른다는 옵션입니다. 즉 해당 Master의 Replica로 설정됩니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;원하는 개수의 &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt; 만큼 생성하면 됩니다.&lt;/p&gt;
&lt;p&gt;이제 마지막으로 &lt;code class=&quot;language-text&quot;&gt;redis-sentinel&lt;/code&gt;을 생성할 차례입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; run &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt; sentinel-1 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--network&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;NETWORK_NAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;PORT&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;:26379 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;pwd&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;/sentinel.conf:/etc/sentinel/sentinel.conf &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
redis:latest &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sleep 5 &amp;amp;&amp;amp; redis-sentinel /etc/sentinel/sentinel.conf&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Sentinel의 경우 옵션을 넣는 파일을 Volume을 잡았다. 이에 &lt;code class=&quot;language-text&quot;&gt;sentinel.conf&lt;/code&gt; 내용은 다음과 같습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;conf&quot;&gt;&lt;pre class=&quot;language-conf&quot;&gt;&lt;code class=&quot;language-conf&quot;&gt;sentinel monitor mymaster {MASTER_IP} 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 10000
# sentinel auth-pass mymaster {MASTER_PASS}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;monitor mymaster redis-master 6379 2&lt;/code&gt; : 내부에서 mymaster 라는 이름으로 redis-master:6379 라는 master를 모니터링 하고, &lt;code class=&quot;language-text&quot;&gt;최소 2개의 Sentinel&lt;/code&gt; 이 &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 가 다운되었다고 판단해야 &lt;code class=&quot;language-text&quot;&gt;Failover&lt;/code&gt; 를 수행한다는 설정입니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;down-after-milliseconds mymaster 5000&lt;/code&gt; : Master가 5(5000ms)초 동안 응답이 없으면 다운된 것으로 판단합니다. (주관적 판단)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;failover-timeout mymaster 10000&lt;/code&gt; : Failover 시 전체 프로세스에 적용될 Timeout의 설정값 (새 마스터 승격, 클러스터 재구성 등등)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;auth-pass mymaster {PASSWORD}&lt;/code&gt; : Master 생성 시 &lt;code class=&quot;language-text&quot;&gt;Pass&lt;/code&gt;를 설정했다면 기록되는 값&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위 과정을 따랐다면, 총 &lt;code class=&quot;language-text&quot;&gt;6개의 컨테이너&lt;/code&gt;가 성공적으로 동작할 것 입니다.. 이제 Master가 다운되었을 때, 각각의 Sentinel 들이 합의를 통해 Replica 중 하나를 Master로 승격하는지 확인하는 과정이 남았습니다.&lt;/p&gt;
&lt;h2 id=&quot;확인하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0&quot; aria-label=&quot;확인하기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;확인하기&lt;/h2&gt;
&lt;p&gt;먼저 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;redis-replica-n&lt;/code&gt; 잘 연결되어있는지 확인해봅니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; redis-master redis-cli info replication&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 439px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/1c5e6457766f68a27036ac7c5a655c66/54b61/replication-result.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 45.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTElEQVR42oWSyYrCUBBF30eIUZwHIqKC4gDO8wi6cUBFF/r//3CbUxLpXoReHOq+VHJzKxU3nU612Wy0Xq/V6/WUyWQUi8UUjUZD8TwvtOfa7bbG47H6/b7Q3W5XzWbTjLPZrAqFgvL5vOlcLvfVVCgWiwY9rrvFYqH9fq/VaiU0iZfLpWazmbbbrcGZKYL+aDQy0NxH5T4mdIPBwJKRCk1CKqmpw+FQk8nE+uVy2SiVSlar1apqtZpSqZTi8bjhTqeTpZvP5zocDsbj8dD7/dbr9dLlctHxeDRut5vO57Ou16vu97udn8+nvTgSiXwMMSI+SWigSYT2fV+JRELpdNpSJJPJP9ALNIsEx9yMhwlwBkbEhM3x9mC7YXwN+eCw2+3s1wk+MqOziFarpUqlYil/PxiGazQa36V0Oh2r9XpdXOfMr4EZ4/1nhuEPsFQWbpaw+DIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;redis-master 컨테이너의 Replication 정보&apos; title=&apos;&apos; src=&apos;/static/1c5e6457766f68a27036ac7c5a655c66/54b61/replication-result.png&apos; srcset=&apos;/static/1c5e6457766f68a27036ac7c5a655c66/e7570/replication-result.png 170w,
/static/1c5e6457766f68a27036ac7c5a655c66/f46e7/replication-result.png 340w,
/static/1c5e6457766f68a27036ac7c5a655c66/54b61/replication-result.png 439w&apos; sizes=&apos;(max-width: 439px) 100vw, 439px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;redis-master 컨테이너의 Replication 정보&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;해당 명령어를 통해 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 와 연결된 &lt;code class=&quot;language-text&quot;&gt;Replication Redis Instance&lt;/code&gt; 들의 정보를 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;그리고 Sentinel 목록 중 하나의 컨테이너에서 마스터를 잘 바라보고 있는지 확인합니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sentinel-n redis-cli &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;PORT&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; sentinel get-master-addr-by-name &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;MASTER_NAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 117px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/c3ebd2f68241e67ff5735e67d25c31c3/b6338/get-master-addr-by-name-result.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 28.205128205128204%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVR42nWP24qCYBSFfQUPqVlEocFQGhGUmUdEjbLmJiyiCIKGnqCbevg17g0TMxdz8fH/sPdaey0hiiLM53NY/T7yPMdqtcJisUCapiiKArZtYzQaIc0yFOsS/XrPdV2QzjRNJEmCz+0WUZbjw3Yg7Pd7FkuShPF4jOVyiaqqsNlscDqdWDwYDPB1u+H1fGI4HOJ6veLxeMAwDJB+XZawanNJFCGEYQjHcaBpGpt2Oh0EQQDLstiMjpAJJfF9H9PpFLPZDJ7nYTKZII5j6LoOpdHgAwJVpKEsy1z5crlwVUpIs/P5zGR1ZbFOoCgK7xL0pxDNZpMhY2G323FlSkiUdfz7/Y7j8cj1qdLhcODlVqv1Fv+GZj8IvV4P7Xb7bUh0u12GFqgGvaqq/hH+xzfkSrvxK32IoQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;결과로 Master Redis Instance의 IP 주소가 나온다.&apos; title=&apos;&apos; src=&apos;/static/c3ebd2f68241e67ff5735e67d25c31c3/b6338/get-master-addr-by-name-result.png&apos; srcset=&apos;/static/c3ebd2f68241e67ff5735e67d25c31c3/b6338/get-master-addr-by-name-result.png 117w&apos; sizes=&apos;(max-width: 117px) 100vw, 117px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;결과로 Master Redis Instance의 IP 주소가 나온다.&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt; 이제 Master를 다운 시켜서 각각의 Sentinel 들의 합의를 통해 Replica 중 하나를 Master 로 승격시키는 지 확인해봅시다. &lt;code class=&quot;language-text&quot;&gt;Master&lt;/code&gt; 를 다운 시키기 위해서 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 컨테이너를 정지 시켜 봅시다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; stop redis-master&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그리고 여러 &lt;code class=&quot;language-text&quot;&gt;Sentinel 컨테이너&lt;/code&gt; 중 하나의 로그를 살펴봅니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; logs &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sentinel-1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;10:X 16 Jun 2025 06:52:14.841 # +vote-for-leader c193c15f0a95f7b655f6ab0225f0042a958d11e1 1
10:X 16 Jun 2025 06:52:15.785 # +odown master mymaster 172.18.0.2 6379 #quorum 3/2
10:X 16 Jun 2025 06:52:15.785 * Next failover delay: I will not start a failover before Mon Jun 16 06:52:35 2025
10:X 16 Jun 2025 06:52:16.014 # +config-update-from sentinel c193c15f0a95f7b655f6ab0225f0042a958d11e1 172.18.0.5 26379 @ mymaster 172.18.0.2 6379
10:X 16 Jun 2025 06:52:16.014 # +switch-master mymaster 172.18.0.2 6379 172.18.0.4 6379&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 컨테이너를 중지시키게 되면, 각각의 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 이 투표를 통해 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 가 다운됐다는 것을 공식적으로 확인합니다. 그리고 투표의 값이 우리가 &lt;a href=&quot;&quot;&gt;설정한 임계값&lt;/a&gt; 을 넘어가게 되면, (로그에서는 3/2로 과반을 넘었다.) &lt;code class=&quot;language-text&quot;&gt;Replica Redis Instance&lt;/code&gt; 중 하나를 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 로 승격시킵니다.&lt;/p&gt;
&lt;p&gt;승격이 완료된 뒤에 &lt;code class=&quot;language-text&quot;&gt;Sentinel&lt;/code&gt; 에서 다음 명령어를 통해 바라보고 있는 Master 를 확인할 수 있습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;redis-cli &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; SENTINEL get-master-addr-by-name &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;모니터링_하고_있는_Master_이름&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음과 같이 다른 &lt;code class=&quot;language-text&quot;&gt;Replica Redis Instance&lt;/code&gt; 의 주소가 저장되어 있는 것을 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/7c85dc0fbb0c3db261009e2a1930daf5/e5adc/new-structure.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 61.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAACRklEQVR42j1Qa0/bUAzNv97H/YFJA6bRFpFSkqZVC2zal3VDYkChdBNjbUHjNVGged3k5kHeyW0Sz9Vg1pGvfexjy5eDZytf8D+FJI4C186TKI1CtDiO0fu+/9IDXAZwpzkTKzxNYewmt7KFjJaWv0IYmvGJGY8i0JAqizCKgiCwLAv1OKUsS44UsHNJ+59P2iQ/3P2xNZLlHA7ckifQcaHjQF2DvSfI0kTTdUqp67roCSFZlnFmWrQjkAaTs1evP+yfNkJQ4uLYA0HO3uyPlgeXkpYfepAksW3b4/G41+tdXV3h/oVYZ9BW2d7X4e7ez/0vg+ZDNGOLzQ292JzFgpxs6gVuTpKEGIasKNP7qappGC/EHsDwt3p8Ln9k0L8mx6MHB+AiKD9Z0HMXwGASQjGfu5brOV7gBp7tPTlPeZ5z+BU6o9O5MYvkKSMKM/FvgiK6T5XHREXcJ0qQhyWUaqbPEkVOVPSEmchw1twWzI5odSR3W7K7vCHqzDj0BjwVW+42Yt0U+/5QybS6KTWdLWwT7I5AO5RZnJ4Zot2t3m4sjSu12w3ebD6m8jf/qCo33l2srZzX1jThwB9M08e62apc88uTSu2ugWKdkWdx5ab+9uw91ngq/RPX5MbKpLo8qqypmyi+Sx82aGv1ml8arVb/1AWro2eEs+eOSLuis9VydyRnmzclvKfvDddpExnEutk88r/jwQ2zjQ3I4LIm7VrM5vBufNRU11OipcRkFJmoiNWM4Gw9NbCEKZIGo9iAJHrK7BLKv9ACbgFFzsf8AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;새롭게 승격된 Master Redis Instance의 구조&apos; title=&apos;&apos; src=&apos;/static/7c85dc0fbb0c3db261009e2a1930daf5/ca1dc/new-structure.png&apos; srcset=&apos;/static/7c85dc0fbb0c3db261009e2a1930daf5/e7570/new-structure.png 170w,
/static/7c85dc0fbb0c3db261009e2a1930daf5/f46e7/new-structure.png 340w,
/static/7c85dc0fbb0c3db261009e2a1930daf5/ca1dc/new-structure.png 680w,
/static/7c85dc0fbb0c3db261009e2a1930daf5/e5adc/new-structure.png 826w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;새롭게 승격된 Master Redis Instance의 구조&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;정확히 확인하기 위해서, 새롭게 승격된 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 에 접속하여 &lt;code class=&quot;language-text&quot;&gt;info replication&lt;/code&gt; 명령어를 확인하면 &lt;code class=&quot;language-text&quot;&gt;role:master&lt;/code&gt; 임을 확인할 수 있습니다.&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 654px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/66db108af6504f0cf3f75173e786b57f/ba4a2/after-master-down-sentinel-master-addr.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 9.411764705882353%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAX0lEQVR42k2KOQoAIRAEPQITRRPPASMzYf3/63qZgV0MCvoo9ZyDvTdaa4gxgoiQUkIpRfDeY4yBWquQcxaHc+9dHP7nnAghQK21ZHDOQWsNay2MMT+83Z3/2/k6w+4LdDguyyk9QtgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;after master down sentinel master addr&apos; title=&apos;&apos; src=&apos;/static/66db108af6504f0cf3f75173e786b57f/ba4a2/after-master-down-sentinel-master-addr.png&apos; srcset=&apos;/static/66db108af6504f0cf3f75173e786b57f/e7570/after-master-down-sentinel-master-addr.png 170w,
/static/66db108af6504f0cf3f75173e786b57f/f46e7/after-master-down-sentinel-master-addr.png 340w,
/static/66db108af6504f0cf3f75173e786b57f/ba4a2/after-master-down-sentinel-master-addr.png 654w&apos; sizes=&apos;(max-width: 654px) 100vw, 654px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;그리고 이전에 중지된 &lt;code class=&quot;language-text&quot;&gt;redis-master&lt;/code&gt; 를 정상적으로 복구 시키게 되면 현재 &lt;code class=&quot;language-text&quot;&gt;Master Redis Instance&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;Replica&lt;/code&gt;로 붙게 됩니다.&lt;/p&gt;
&lt;p&gt;자세한 코드 내용은 &lt;a href=&quot;https://github.com/jin-daram/tech-blog-code-lab&quot;&gt;블로그 코드 저장소&lt;/a&gt; 에서 내용을 확인하실 수 있습니다.&lt;/p&gt;
&lt;h2 id=&quot;마무리&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%A7%88%EB%AC%B4%EB%A6%AC&quot; aria-label=&quot;마무리 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;마무리&lt;/h2&gt;
&lt;p&gt;이렇게 &lt;code class=&quot;language-text&quot;&gt;Redis Sentinel&lt;/code&gt; 에 대해 알아보고, 직접 테스트하여 &lt;code class=&quot;language-text&quot;&gt;Quorum&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Failover&lt;/code&gt; 의 처리를 눈으로 확인해보았습니다. 학습하면서 알게 된 사실인데, Master-Replica 구조로 Redis를 구성했을 때, 읽기 요청 시 자동으로 로드밸런싱을 해주는 것이 아니더군요. &lt;em&gt;( &lt;code class=&quot;language-text&quot;&gt;Lettuce&lt;/code&gt;와 같은 Redis Client 에서도 지원을 안하는 것 같았습니다. )&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;그래서 &lt;a href=&quot;https://github.com/twitter/twemproxy&quot;&gt;Twemproxy&lt;/a&gt; 나 &lt;a href=&quot;https://github.com/joyieldInc/predixy&quot;&gt;Predixy&lt;/a&gt; 와 같은 프록시를 거쳐야 한다는 것을 알았습니다. &lt;a href=&quot;https://github.com/redis/lettuce/issues/834&quot;&gt;참조&lt;/a&gt; &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Lettuce selects a slave per slot hash and uses the selected slave for read operations until the next topology refresh. This is by design to reduce CPU overhead.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;이를 통해 Redis의 구성이 변경되지 않는 한 &lt;em&gt;(e.g 새로운 Replica Redis가 추가된다거나 등)&lt;/em&gt; 지정된 Replica에 대해서만 읽기 요청을 보낸다는 것 같았습니다.&lt;/p&gt;
&lt;p&gt;사실 이러한 설정은 굉장히 복잡하고, 네트워크도 설정해야 하니, 수지타산을 고려하여 이런 것들을 상대적으로 쉽게 설정할 수 있는 &lt;code class=&quot;language-text&quot;&gt;AWS ElastiCache&lt;/code&gt; 와 같은 서비스를 이용하는 것도 좋을 것 같습니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[NestJS @Transactional 구현하기]]></title><description><![CDATA[이전 글 (NestJS 트랜잭션 적용 원리 알아보기) 에서는 NestJS와 Node.js 환경에서 TypeORM을 통해 어떤식으로  을 적용할 수 있는지 실제  코드와 함께 살펴봤다. 본 포스트에서는 typeorm-transactional…]]></description><link>https://jin-daram.github.io/nestjs-tx-implement/</link><guid isPermaLink="false">https://jin-daram.github.io/nestjs-tx-implement/</guid><pubDate>Thu, 12 Jun 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;&quot;&gt;이전 글 (NestJS 트랜잭션 적용 원리 알아보기)&lt;/a&gt; 에서는 NestJS와 Node.js 환경에서 TypeORM을 통해 어떤식으로 &lt;code class=&quot;language-text&quot;&gt;Transaction&lt;/code&gt; 을 적용할 수 있는지 실제 &lt;code class=&quot;language-text&quot;&gt;TypeORM&lt;/code&gt; 코드와 함께 살펴봤다.&lt;/p&gt;
&lt;p&gt;본 포스트에서는 &lt;a href=&quot;https://www.npmjs.com/package/typeorm-transactional&quot;&gt;typeorm-transactional&lt;/a&gt;을 사용하지 않고, 직접 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; Decorator를 구현하여 간편하게 트랜잭션을 적용하는 법을 보이겠다.&lt;/p&gt;
&lt;h2 id=&quot;Nodejs의-Thread-Local-Storage&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Nodejs%EC%9D%98-Thread-Local-Storage&quot; aria-label=&quot;Nodejs의 Thread Local Storage permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Node.js의 Thread Local Storage&lt;/h2&gt;
&lt;p&gt;Thread Local Storage는 쉽게 말해서 각 Thread 마다 따로 저장되는 값이다. 멀티 스레드 환경에서 데이터 충돌을 방지하는 목적으로 사용하는 데 유용하다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* Java에서 ThreadLocalStorage를 생성하고 사용하기 */&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;ThreadLocal&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; threadLocal &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ThreadLocal&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

threadLocal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;A&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; threadLocal&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// return &quot;A&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다른 스레드에서는 &lt;code class=&quot;language-text&quot;&gt;threadLocal&lt;/code&gt; 변수에 저장된 &lt;code class=&quot;language-text&quot;&gt;&quot;A&quot;&lt;/code&gt; 라는 값을 조회할 수 없다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Spring Boot&lt;/code&gt;는 &lt;code class=&quot;language-text&quot;&gt;멀티 스레드&lt;/code&gt; 환경이기에 &lt;code class=&quot;language-text&quot;&gt;ThreadPool&lt;/code&gt; 에서 요청 하나 당 1개의 Thread를 할당 받아 처리하기 때문에 &lt;code class=&quot;language-text&quot;&gt;ThreadLocal&lt;/code&gt; 클래스를 통해 &lt;code class=&quot;language-text&quot;&gt;ThreadLocalStorage&lt;/code&gt; 를 사용할 수 있다.&lt;/p&gt;
&lt;p&gt;하지만 &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 환경은 &lt;code class=&quot;language-text&quot;&gt;싱글 스레드 기반&lt;/code&gt; 으로 동작하기 때문에 요청별 컨텍스트를 분리할 수 없어 기본적으로 Thread Local Storage를 만들 수 없다.&lt;/p&gt;
&lt;h3 id=&quot;cls-hooked&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cls-hooked&quot; aria-label=&quot;cls hooked permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;cls-hooked&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.npmjs.com/package/cls-hooked&quot;&gt;cls-hooked&lt;/a&gt; 는 &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 에서 &lt;code class=&quot;language-text&quot;&gt;ThreadLocal&lt;/code&gt; 처럼 동작하는 &lt;code class=&quot;language-text&quot;&gt;Continuation-Local-Storage&lt;/code&gt; 를 만들기 위해 나온 모듈이다. 이는 내부 &lt;code class=&quot;language-text&quot;&gt;Namespace&lt;/code&gt; 를 하나 생성하여, 내부적으로 &lt;code class=&quot;language-text&quot;&gt;Map&amp;lt;asyncId, Context&gt;&lt;/code&gt; 구조로 저장소를 갖는다. &lt;/p&gt;
&lt;p&gt;하지만 마지막 업데이트가 너무 오래전이고, 비공식 구현체이다.&lt;/p&gt;
&lt;h3 id=&quot;Async-Local-Storage&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Async-Local-Storage&quot; aria-label=&quot;Async Local Storage permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Async Local Storage&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;async_hooks&lt;/code&gt; 기반으로 동작되는 공식 &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;Async Local Storage&lt;/code&gt; 이다. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;async_hooks 란?&lt;/strong&gt;
&lt;code class=&quot;language-text&quot;&gt;async_hooks&lt;/code&gt; 는 &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 에서 제공하는 비동기 콜백의 생명주기를 추적할 수 있는 API 이다. 싱글 스레드 기반인 Node.js 에서는 비동기 함수들의 흐름이 섞일 경우, 이를 추적하기 어렵다. 이를 쉽게하기 위해서 구현된 것이 &lt;code class=&quot;language-text&quot;&gt;async_hooks&lt;/code&gt; 이다.
다만 이 &lt;code class=&quot;language-text&quot;&gt;async_hook&lt;/code&gt; 는 사용이 금지시 되고 있다. 비동기 컨텍스트 추적 용도로는 &lt;code class=&quot;language-text&quot;&gt;AsyncLocalStorage&lt;/code&gt; 를 사용하도록 권고되고 있다. &lt;a href=&quot;https://nodejs.org/api/async_hooks.html?utm_source=chatgpt.com#async-hooks&quot;&gt;참고&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;AsyncLocalStorage&lt;/code&gt; 는 비동기 컨텍스트 유지가 가능하고, Node.js 에서 공식적으로 지원하는 비동기 컨텍스트 추적 객체이다. 다음과 같이 사용할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* async-context.ts */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; AsyncLocalStorage &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;node:async_hooks&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; asyncLocalStorage &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AsyncLocalStorage&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    asyncLocalStorage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  get&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; asyncLocalStorage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getStore&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* runner.ts */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; context &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./async-context&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;hello jin-daram&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 기반 서버와 응용하여 사용하면 &lt;code class=&quot;language-text&quot;&gt;Spring Boot&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;ThreadLocal&lt;/code&gt; 처럼 활용할 수 있다.&lt;/p&gt;
&lt;h2 id=&quot;Transactional&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Transactional&quot; aria-label=&quot;Transactional permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;@Transactional&lt;/h2&gt;
&lt;p&gt;위에서, 알게 된 내용을 바탕으로 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; Decorator를 생성하여 본다. 먼저 트랜잭션이 필요한 &lt;code class=&quot;language-text&quot;&gt;Post&lt;/code&gt; 요청을 처리하는 &lt;code class=&quot;language-text&quot;&gt;Service&lt;/code&gt;를 생성하도록 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;요청 정보로 &lt;code class=&quot;language-text&quot;&gt;User&lt;/code&gt; 를 생성하는 매우 간단한 코드이다. 지금은 &lt;code class=&quot;language-text&quot;&gt;UserRepository&lt;/code&gt; 생성 시 선언된 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt;를 통해 트랜잭션을 유지하기 때문에 &lt;code class=&quot;language-text&quot;&gt;createUser()&lt;/code&gt; 함수에 다른 엔티티에 대한 &lt;code class=&quot;language-text&quot;&gt;INSERT&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;UPDATE&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;DELETE&lt;/code&gt; 쿼리가 추가된다면 트랜잭션이 유지될 수 없는 상황이다.&lt;/p&gt;
&lt;p&gt;이제 &lt;code class=&quot;language-text&quot;&gt;createUser()&lt;/code&gt; 함수가 실행되기 전에 &lt;code class=&quot;language-text&quot;&gt;em.transaction()&lt;/code&gt; 콜백 함수의 인자로 들어오는 manager를 해당 요청 내에서 사용해야한다. 즉 &lt;code class=&quot;language-text&quot;&gt;UserRepository&lt;/code&gt; 에서 접근하는 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 가 변경되어야 하고, 이 접근 방식을 다르게 설정해야 한다. &lt;/p&gt;
&lt;p&gt;이는 &lt;code class=&quot;language-text&quot;&gt;typeorm-transactional&lt;/code&gt; 에서 구현했던 방식과 비슷하게 &lt;code class=&quot;language-text&quot;&gt;Object.defineProperty(...)&lt;/code&gt; 함수를 이용해서 설정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* init.ts */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defineProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Repository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prototype&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;manager&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        configurable&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;entityManager&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;우리는 &lt;code class=&quot;language-text&quot;&gt;CustomRepository&lt;/code&gt; 를 만들 때, 반드시 &lt;code class=&quot;language-text&quot;&gt;Repository&amp;lt;Entity extends ObjectLiteral&gt;&lt;/code&gt; 를 상속받아 사용한다. &lt;code class=&quot;language-text&quot;&gt;Repository&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;prototype&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;manager&lt;/code&gt; 라는 속성에 접근할 때, &lt;code class=&quot;language-text&quot;&gt;Repository.manager&lt;/code&gt; 에 접근하는 것이 아닌, 우리가 나중에 생성할 &lt;code class=&quot;language-text&quot;&gt;Request Context&lt;/code&gt; 에서 접근하도록 설정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* user.repository.ts */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserRepository&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Repository&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;User&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그리고 해당 함수를 &lt;code class=&quot;language-text&quot;&gt;main.ts&lt;/code&gt; 에서 App이 실행되기 전에 싫맹한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* main.ts */&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;bootstrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;Context-만들기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Context-%EB%A7%8C%EB%93%A4%EA%B8%B0&quot; aria-label=&quot;Context 만들기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Context 만들기&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;cls-hooked&lt;/code&gt; 는 오래 전에 업데이트 되었기 때문에 상대적으로 최근에 생기고, &lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt; 에서 지원하는 &lt;code class=&quot;language-text&quot;&gt;Async-Local-Storage&lt;/code&gt; 를 전격 활용하여 개발하도록 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* context.ts */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Context&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; dataSource&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; DataSource&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; asyncLocalStorage &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AsyncLocalStorage&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Map&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;EntityManager&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataSource&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setDataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;targetDataSource&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; DataSource&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; targetDataSource&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataSource &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; targetDataSource&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;store&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Map&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;asyncLocalStorage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;store&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;asyncLocalStorage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getStore&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;먼저 간단한 &lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt; 클래스를 생성한다. 내부에는 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;AsyncLocalStorage&lt;/code&gt; 로 이루어져 있다.&lt;/p&gt;
&lt;p&gt;DataSource는 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; Decorator 에서 트랜잭션를 생성하기 위해 저장한다. 그렇기 때문에 &lt;code class=&quot;language-text&quot;&gt;main.ts&lt;/code&gt;에서 해당 &lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt; 에 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt; Mapping이 필요하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setDataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  type &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;postgres&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  host &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;localhost&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  port &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5433&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  username&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;postgres&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  password &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mypassword&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  database&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;postgres&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  entities&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;User&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  logging&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;bootstrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;지금은 수동으로 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt; 를 지정해주었지만, 향후 &lt;code class=&quot;language-text&quot;&gt;TypeORM&lt;/code&gt; 모듈을 통해 &lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt; 에 자동으로 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt; 를 설정하는 것도 가능할 것 같다.&lt;/p&gt;
&lt;h3 id=&quot;Transactional-Decorator-생성하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Transactional-Decorator-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0&quot; aria-label=&quot;Transactional Decorator 생성하기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;@Transactional Decorator 생성하기&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Transactional&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; MethodDecorator &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_target&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _propertyKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; descriptor&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; PropertyDescriptor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; original &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; descriptor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    descriptor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;args&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; dataSource &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getDataSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; dataSource&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;transaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;transactionManager&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;entityManager&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; transactionManager&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;original&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;코드 구성은 간단하다. 전역적으로 접근할 수 있는 Context 로 부터, DataSource를 가져온다.&lt;/p&gt;
&lt;p&gt;그런 후에 DataSource의 EntityManager의 transaction() 함수를 통해 콜백 함수의 인자로 주어진 EntityManager를 &lt;code class=&quot;language-text&quot;&gt;Map&amp;lt;string, EntityManager&gt;&lt;/code&gt; 형태의 Store에 저장한다.&lt;/p&gt;
&lt;p&gt;그리고 실행하고자 하는 함수를 실행한다.&lt;/p&gt;
&lt;h3 id=&quot;적용하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0&quot; aria-label=&quot;적용하기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;적용하기&lt;/h3&gt;
&lt;p&gt;기존에 트랜잭션을 적용하고자 했던 함수에 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; Decorator를 붙인다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Transactional&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이후 결과를 확인해보면 성공적으로 트랜잭션이 원하는 대로 적용되는 것을 확인할 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/94a69a28b90709628e32365482dd3f61/c807c/transaction-success.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 5.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAASElEQVR42h2IQQ6AIAzA/IaGARshUdxB9Kj//1ZFD02bTr431n6znQ9Hv3B3zAxVxUphTpU0WnJi0YZoJUYZRPL4IYS/P4sIL3z8HDJqpQ14AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;Transaction이 정상적으로 적용되는 모습&apos; title=&apos;&apos; src=&apos;/static/94a69a28b90709628e32365482dd3f61/ca1dc/transaction-success.png&apos; srcset=&apos;/static/94a69a28b90709628e32365482dd3f61/e7570/transaction-success.png 170w,
/static/94a69a28b90709628e32365482dd3f61/f46e7/transaction-success.png 340w,
/static/94a69a28b90709628e32365482dd3f61/ca1dc/transaction-success.png 680w,
/static/94a69a28b90709628e32365482dd3f61/02d09/transaction-success.png 1020w,
/static/94a69a28b90709628e32365482dd3f61/9d567/transaction-success.png 1360w,
/static/94a69a28b90709628e32365482dd3f61/c807c/transaction-success.png 1850w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;Transaction이 정상적으로 적용되는 모습&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;문제점&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%AC%B8%EC%A0%9C%EC%A0%90&quot; aria-label=&quot;문제점 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;문제점&lt;/h3&gt;
&lt;p&gt;하지만 여전히 부족한 점이 많다. 트랜잭션이 정상적으로 적용되기는 하지만, 로직이 복잡해지고, 함수가 분리되는 경우의 트랜잭션 전략에 대한 전략책이 없다. &lt;code class=&quot;language-text&quot;&gt;typeorm-transactional&lt;/code&gt; 에서는 이런 것 까지 잘 지원하고 있으니, 결국 좋은 라이브러리를 사용하는 것이 좋은 것 같다.&lt;/p&gt;
&lt;p&gt;본 포스트는 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;EntityManger&lt;/code&gt; 와 관련하여 &lt;code class=&quot;language-text&quot;&gt;TypeORM&lt;/code&gt; 환경에서 &lt;code class=&quot;language-text&quot;&gt;Transaction&lt;/code&gt; 이 어떻게 적용되는지에 대한 학습을 목적으로 작성한 글이기 때문에 부족한 부분이 있을 수 있다. 피드백은 언제나 환영이기에 하단의 &lt;strong&gt;Discussion&lt;/strong&gt; 을 적극적으로 활용해주시기 바란다.&lt;/p&gt;
&lt;p&gt;자세한 코드는 &lt;a href=&quot;https://github.com/jin-daram/tech-blog-code-lab&quot;&gt;블로그 코드 Repository&lt;/a&gt; 에서 확인 할 수 있다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[NestJS 트랜잭션 적용 원리 알아보기]]></title><description><![CDATA[Spring Boot 에서는 다음과 같은 코드로 간단하게  을 적용할 수 있다.  자세한 적용 원리나 옵션에 대해서는 의 @Transactional Annotation…]]></description><link>https://jin-daram.github.io/nestjs-tx-principle/</link><guid isPermaLink="false">https://jin-daram.github.io/nestjs-tx-principle/</guid><pubDate>Thu, 05 Jun 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;Spring Boot&lt;/strong&gt; 에서는 다음과 같은 코드로 간단하게 &lt;code class=&quot;language-text&quot;&gt;트랜잭션&lt;/code&gt; 을 적용할 수 있다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserRepository&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Transactional&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 트랜잭션 적용&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;UserCreateRequest&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;자세한 적용 원리나 옵션에 대해서는 &lt;code class=&quot;language-text&quot;&gt;Spring Boot&lt;/code&gt;의 &lt;a href=&quot;https://docs.spring.io/spring-framework/reference/data-access/transaction/declarative/annotations.html&quot;&gt;@Transactional&lt;/a&gt; Annotation에 대해 학습이 필용하지만, 위 방법으로 단순하고 간단하게 &lt;code class=&quot;language-text&quot;&gt;트랜잭션&lt;/code&gt;을 적용할 수 있다.&lt;/p&gt;
&lt;p&gt;이것이 가능하게 하는 것이 바로 &lt;strong&gt;AOP (Aspect-Oriented Programming, 관점 지향 프로그래밍, 이하 AOP)&lt;/strong&gt; 이다.&lt;/p&gt;
&lt;h2 id=&quot;AOP&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#AOP&quot; aria-label=&quot;AOP permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;AOP?&lt;/h2&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;AOP 설명을 목적으로 하는 포스트는 아니기 때문에 단순하게 설명함으로 양해 부탁드립니다. 자세한 이론적인 내용은 &lt;a href=&quot;https://ko.wikipedia.org/wiki/%EA%B4%80%EC%A0%90_%EC%A7%80%ED%96%A5_%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D&quot;&gt;위키백과 - AOP&lt;/a&gt; 를 참고 하길 바랍니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;쉽게 말하자면 &lt;code class=&quot;language-text&quot;&gt;비즈니스 로직은  건들지 않고, 공통적으로 해야 하는 일을 앞, 뒤로 끼워넣는 프로그래밍 기법&lt;/code&gt; 이다.
&lt;br&gt;&lt;/p&gt;
&lt;p&gt;만약 프로젝트 내 모든 메소드의 실행 시간을 기록해야 한다면 어떨까?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; startTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 비즈니스 로직&lt;/span&gt;
	log endTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;endTime &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; startTime &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ms&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 코드와 같은 포맷이 모든 메소드에 추가 되어야 할 것이다. 하지만 다음과 같이 구현한다면?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Measure&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 비즈니스 로직&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;단순히 &lt;code class=&quot;language-text&quot;&gt;@Measure&lt;/code&gt; 을 붙이는 것만으로 해결할 수 있다면 우리는 비즈니스 로직 앞 뒤에 아무것도 붙이지 않고, 깨끗하게 비즈니스 로직에만 집중 할 수 있다. 사실 메소드 소요 시간 측정은 정말 가벼운 기능이 추가되는 것이지만, 더 복잡한 로직이 생기게 된다면, 비즈니스 로직보다 공통 로직이 더 많은 부분을 차지하는 기이한 현상이 벌어질 수 있다.&lt;/p&gt;
&lt;p&gt;그렇기 때문에 Spring Boot 환경에서는 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; Annotation을 통해 간단하게 &lt;code class=&quot;language-text&quot;&gt;트랜잭션&lt;/code&gt; 을 적용할 수 있는 방법을 제공한다.&lt;/p&gt;
&lt;h2 id=&quot;Nodejs-환경에서의-트랜잭션&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Nodejs-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98&quot; aria-label=&quot;Nodejs 환경에서의 트랜잭션 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Node.js 환경에서의 트랜잭션&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;트랜잭션은 Node.js 환경에서도 물론 필요하다. 그렇기 때문에 적용할 수 있어야 한다. 하지만 관심을 가지지 않으면 단독적으로 트랜잭션이 적용될 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; userRepository&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UsreRepository&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; UserDetailRepository&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserDetailRepositoty
	&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;	&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; userDetail &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userDetailRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;우리의 기대와 달리, 트랜잭션이 &lt;code class=&quot;language-text&quot;&gt;userRepository.save()&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;userDetailRepository.save()&lt;/code&gt; 에 각각 적용된다.
어느 하나라도 실패가 된다면, 다른 쿼리도 &lt;code class=&quot;language-text&quot;&gt;Rollback&lt;/code&gt;  이 되어야 하지만, 실패해도 롤백이 이루어지지 않는다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/13bf03fb35bdb35abb81099c00d48758/39b47/double-tx-image.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 12.352941176470589%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdUlEQVR42jXNSw7CMAwE0N6kKP7FpE0TCZCAsoT732hwVFhYY1vW89R7w2X/4PZ64/HcUWuFiCJnQxIHWwap4qRLpCOxQGJm5rgT6K8fRUSYemuw7Q5ZryjLilLOgeWjzODumHnABgpgti0ynlCCxe4PDXyAX7i0OuFJj26iAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;개별적으로 트랜잭션이 적용되는 모습&apos; title=&apos;&apos; src=&apos;/static/13bf03fb35bdb35abb81099c00d48758/ca1dc/double-tx-image.png&apos; srcset=&apos;/static/13bf03fb35bdb35abb81099c00d48758/e7570/double-tx-image.png 170w,
/static/13bf03fb35bdb35abb81099c00d48758/f46e7/double-tx-image.png 340w,
/static/13bf03fb35bdb35abb81099c00d48758/ca1dc/double-tx-image.png 680w,
/static/13bf03fb35bdb35abb81099c00d48758/02d09/double-tx-image.png 1020w,
/static/13bf03fb35bdb35abb81099c00d48758/9d567/double-tx-image.png 1360w,
/static/13bf03fb35bdb35abb81099c00d48758/39b47/double-tx-image.png 2034w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;개별적으로 트랜잭션이 적용되는 모습&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;TypeORM 설정에서 &lt;code class=&quot;language-text&quot;&gt;logging&lt;/code&gt; 옵션을 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt; 로 두고 &lt;code class=&quot;language-text&quot;&gt;데이터베이스 로그&lt;/code&gt; 를 확인해보면 트랜잭션이 각각 분리되어 전송되는 것을 확인할 수 있다. &lt;/p&gt;
&lt;p&gt;만약 둘 중 하나가 실패한다면? 정상적으로 롤백이 이루어질까? 일부러 둘 중 하나의 로직이 실패하게 유도하고 결과를 지켜보자.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 374px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/c39cd1c8c9a267193cf6f59e629867c9/b0af8/no-rollback-result.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 73.52941176470587%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACyUlEQVR42pVTa28SQRTd/2AfRi2PPsSyy5vdhe3yhiUs77bQQmlLa4ECTasxVqNJE6OJ8YuJf5aPe7wzWyypX/TDyd07O/fMmXvPCLrZQqZURaW5B92oYqe0i87xJfqjW1xd3WIyvcVp/wonp1OcnExw/PodWr0RtGIDhdo+Ggc9ZM2apRk16KXmTIgTYcKoEOE+4jkT8UIVB70pehcfcHP9GZPJR3Q7ExvdMTq9G7Q6I+jlNsy9LlpHZ8iVG5aaKSGer84ELRaDz+eDKErw+/0UvSibJoaDAcbjCUajEQb0PZ1OcHZ+juFwiFwui3qthna7jVAoDK8oWoFAgPHMhEAgSCQiJEnixPOoKAo0TYMsy5CjUZ5HIhGes/8MwWCQi6Aai9URz0wIh8Ng7Ozn/SLfxDA/YH7IIuZ7WC2BK6R8JmxtbcHpdHIwcqZifX0dbrebY67kvhD21R7I/DaRZQsgQpfTgaerq1haWkY6lYJRyOPF82dYWX6ClZUleDwv4fVuU5+8pH4bEt3AxyCJvN8890lWgCkXvTNBSeSgJDJIZbKIxHT4FB2JbBHVZgfV+iGaux3st45Qr7fJCUcwzCZkPYN4Kod0vohEpoB4MmsptCanCjNBr3SgVQ7R6vZQouKo0US53cfFzXdcv/+Bb19/4e7uJ8aXn3A+/oLu2VvEKl00ewNcTN+gf3mNRqdvMbtp5UPyoZ6ErMYRVTUosR3ISgzaTpKubiKfn6OEPOVsLUOKlJjGEaU6mSLBUnmtSlOmIbB++Pn0JB5ZX1jfRN63v2Hvs/fakCxeL0kzIRKV+cSCoZANmujjqS6C22U+3QdYLPqYbcKRKPlMpGl6wCzE4ubmJvfjot8Wvfl47cE29FLcGxtYW1tDilnGMFAsFmHS02Pkq2QnRvxH2b8Qel5tw+VyQVVVJJNJ/tzS6TQndDgc/JX8D+FvUX33GYQBovMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;User 테이블은 데이터 저장, UserDetail 테이블은 Rollback&apos; title=&apos;&apos; src=&apos;/static/c39cd1c8c9a267193cf6f59e629867c9/b0af8/no-rollback-result.png&apos; srcset=&apos;/static/c39cd1c8c9a267193cf6f59e629867c9/e7570/no-rollback-result.png 170w,
/static/c39cd1c8c9a267193cf6f59e629867c9/f46e7/no-rollback-result.png 340w,
/static/c39cd1c8c9a267193cf6f59e629867c9/b0af8/no-rollback-result.png 374w&apos; sizes=&apos;(max-width: 374px) 100vw, 374px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;User 테이블은 데이터 저장, UserDetail 테이블은 Rollback&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;예상했던 결과처럼 &lt;code class=&quot;language-text&quot;&gt;User&lt;/code&gt; 테이블에는 데이터가 성공적으로 삽입되었고, 에러가 발생한 &lt;code class=&quot;language-text&quot;&gt;UserDetail&lt;/code&gt; 데이터는 삽입되지 않았다.&lt;/p&gt;
&lt;h2 id=&quot;트랜잭션-적용하기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0&quot; aria-label=&quot;트랜잭션 적용하기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;트랜잭션 적용하기&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;지금까지 트랜잭션이 정상적으로 적용되지 않는다는 것을 알 수 있었다. 이제 NestJS과 TypeORM에서 지원하는 트랜잭션 적용 방법을 알아보도록 하겠다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; dataSource&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; DataSource&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;request&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; queryRunner &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dataSource&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createQueryRunner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	
		&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;startTransaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// TRANSACTION START&lt;/span&gt;

		&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;User&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// User 저장&lt;/span&gt;
			
			&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; detail &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;UserDetail&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;detail&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// UserDetail 저장&lt;/span&gt;
			
			&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;commitTransaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// COMMIT&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;rollbackTransaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;release&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;심히 당황스럽다.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;핵심 로직은 엔티티를 생성하고, 저장하는 &lt;code class=&quot;language-text&quot;&gt;4줄&lt;/code&gt; 밖에 되지 않는다. 하지만 트랜잭션 로직 때문에 간단한 &lt;code class=&quot;language-text&quot;&gt;createUser()&lt;/code&gt; 함수가 거대해졌다. 혹시라도 함수의 내용이 방대해지거나, 분리가 필요하면 트랜잭션의 추적도 쉽지 않을 것이다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;DataSource를 의존성 주입을 받을 수 있는 이유&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;@nestjs/typeorm&lt;/code&gt; 의존성을 통해 &lt;code class=&quot;language-text&quot;&gt;TypeOrmModule&lt;/code&gt; 을 import 하면 내부에서 &lt;code class=&quot;language-text&quot;&gt;DataSource&lt;/code&gt; , &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 등을 기본적으로 &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;로 추가한다.
&lt;br&gt; 실제 코드는 &lt;a href=&quot;https://github.com/nestjs/typeorm/blob/master/lib/typeorm-core.module.ts&quot;&gt;@nestjs/typeorm typeorm-core-module.ts&lt;/a&gt; 에서 확인할 수 있다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;그럼 다음과 같은 코드는 작동하지 않을까? &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token decorator&quot;&gt;&lt;span class=&quot;token at operator&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Injectable&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; em&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; EntityManager&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; userRepository&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserRepository&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; UserCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;em&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;transaction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;manager&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;userCreateRequest&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/72d02875930c5b3a7dc34d79088a7f26/a52c7/nested-tx-image.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 8.823529411764705%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAbElEQVR42j2M0Q3CQAxDOwkksdODEz8doRJVJSTYfxtzOQm+nmM7Xvbzo/P11nE81XsXSbXW5Gwy3oSEPJuu60McjIiZZ6YATNZP+cUltl3mmMcvzKQsUoZVIIamLrgrODyz2akxd//rGix+AZrSOgltq3QdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;트랜잭션이 중첩되는 모습&apos; title=&apos;&apos; src=&apos;/static/72d02875930c5b3a7dc34d79088a7f26/ca1dc/nested-tx-image.png&apos; srcset=&apos;/static/72d02875930c5b3a7dc34d79088a7f26/e7570/nested-tx-image.png 170w,
/static/72d02875930c5b3a7dc34d79088a7f26/f46e7/nested-tx-image.png 340w,
/static/72d02875930c5b3a7dc34d79088a7f26/ca1dc/nested-tx-image.png 680w,
/static/72d02875930c5b3a7dc34d79088a7f26/02d09/nested-tx-image.png 1020w,
/static/72d02875930c5b3a7dc34d79088a7f26/9d567/nested-tx-image.png 1360w,
/static/72d02875930c5b3a7dc34d79088a7f26/a52c7/nested-tx-image.png 2024w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;트랜잭션이 중첩되는 모습&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;결과는 기대했던 결과와는 달리 &lt;code class=&quot;language-text&quot;&gt;트랜잭션&lt;/code&gt;이 중첩되어 실행된다.&lt;/p&gt;
&lt;p&gt;결론부터 말하자면, &lt;code class=&quot;language-text&quot;&gt;UserService의 EntityManager&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;UserRepository의 EntityManager&lt;/code&gt;가 서로 다른 참조를 하고 있다는 것이다.  &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;UserService&lt;/code&gt; 에 주입된 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;transaction&lt;/code&gt;을 통해 생성된 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;UserRepository&lt;/code&gt; 에서 참조하는 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 는 같지 않다. &lt;/p&gt;
&lt;p&gt;이는 &lt;a href=&quot;&quot;&gt;TypeORM 공식 Github&lt;/a&gt; 코드를 통해 확인 할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* typeorm/src/entity-manager/EntityManager.ts  */&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;transaction&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 만약 해당 클래스에 QueryRunner가 이미 할당되어있다면, EntityManager가&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 이미 Single Connection을 생성한 것 입니다.&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;// 만약 정의되지 않은 경우, 모든 작업을 실행할 새로운 Single Connection을 생성합니다.&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; queryRunner &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;queryRunner &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;connection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createQueryRunner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 코드는 공식 &lt;code class=&quot;language-text&quot;&gt;TypeORM&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;EntityManager.ts&lt;/code&gt; 의 코드 중 &lt;code class=&quot;language-text&quot;&gt;transaction()&lt;/code&gt; 함수 중 일부를 발췌한 것이다. 해당 코드는 쿼리 시에 사용할 &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 를 정의하는데, 이미 사용하고 있는 &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 가 없다면 새로운 &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 를 생성한다. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;this.connection.createQueryRunner()&lt;/code&gt; 함수를 통해 새로운 &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 를 생성하게 되는데 이는 &lt;code class=&quot;language-text&quot;&gt;DataSource.ts&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;createQueryRunner()&lt;/code&gt; 와 같다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* typeorm/src/data-source/DataSource.ts */&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;createQueryRunner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mode&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ReplicationMode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;master&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; QueryRunner &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; queryRunner &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createQueryRunner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; manager &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createEntityManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;queryRunner&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;assign&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;queryRunner&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; manager&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; manager &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; queryRunner
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;createEntityManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;queryRunner&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; QueryRunner&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; EntityManager &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EntityManagerFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; queryRunner&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;실질적인 &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 는 각 &lt;code class=&quot;language-text&quot;&gt;Database Driver&lt;/code&gt; 를 구현한 구현체에 맡기고, &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 는 &lt;code class=&quot;language-text&quot;&gt;DataSource.ts&lt;/code&gt; 에 정의된 &lt;code class=&quot;language-text&quot;&gt;createEntityManager()&lt;/code&gt; 함수를 통해 생성하여, &lt;code class=&quot;language-text&quot;&gt;QueryRunner&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;manager&lt;/code&gt; 에 저장한다. &lt;/p&gt;
&lt;p&gt;그렇기 때문에 &lt;code class=&quot;language-text&quot;&gt;UserService&lt;/code&gt; 에 주입된 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;UserRepository에서&lt;/code&gt; 참조하는 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 가 서로 다른 객체를 참조하고 있는 것이다.&lt;/p&gt;
&lt;p&gt;그럼 어떻게 &lt;code class=&quot;language-text&quot;&gt;EntityManager.transaction()&lt;/code&gt; 의 인자로 주어진 함수에서 같은 &lt;code class=&quot;language-text&quot;&gt;EntityManager&lt;/code&gt; 를 사용할 수 있을까? &lt;/p&gt;
&lt;p&gt;이 내용은 앞서 이야기 했던 &lt;code class=&quot;language-text&quot;&gt;AOP&lt;/code&gt; 라는 주제와 함꼐 직접 &lt;code class=&quot;language-text&quot;&gt;@Transactional&lt;/code&gt; 을 구현하여, 적용해보는 내용을 &lt;a href=&quot;&quot;&gt;다음 글&lt;/a&gt; 에 소개하도록 하겠다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[IntelliJ Mouse Wheel Zoom 이슈]]></title><description><![CDATA[어느 날, 마우스 휠 Up, Down을 통해 IntelliJ Editor의 Font Size 조절이 갑자기 되지 않았다.  옵션을 건드려봐도, Mac 자체에서 지원하는 Zoom이 될 뿐, Editor의 Font Size…]]></description><link>https://jin-daram.github.io/intellij-zoom-issue/</link><guid isPermaLink="false">https://jin-daram.github.io/intellij-zoom-issue/</guid><pubDate>Thu, 15 May 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;어느 날, 마우스 휠 Up, Down을 통해 IntelliJ Editor의 Font Size 조절이 갑자기 되지 않았다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;IntelliJ IDEA -&gt; Settings -&gt; Editor -&gt; General -&gt; Change font size in Command + Mouse Wheel in&lt;/code&gt; 옵션을 건드려봐도, Mac 자체에서 지원하는 Zoom이 될 뿐, Editor의 Font Size가 변경되지는 않았다.&lt;/p&gt;
&lt;h2 id=&quot;해결방법&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%95%B4%EA%B2%B0%EB%B0%A9%EB%B2%95&quot; aria-label=&quot;해결방법 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;해결방법&lt;/h2&gt;
&lt;h3 id=&quot;1-손쉬운-사용-설정-켜져있는지-확인&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-%EC%86%90%EC%89%AC%EC%9A%B4-%EC%82%AC%EC%9A%A9-%EC%84%A4%EC%A0%95-%EC%BC%9C%EC%A0%B8%EC%9E%88%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8&quot; aria-label=&quot;1 손쉬운 사용 설정 켜져있는지 확인 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;1. 손쉬운 사용 설정 켜져있는지 확인&lt;/h3&gt;
&lt;p&gt;나의 경우 &lt;code class=&quot;language-text&quot;&gt;손쉬운 사용 -&gt; 확대/축소&lt;/code&gt; 에서 &lt;code class=&quot;language-text&quot;&gt;스크롤 제스처를 위한 보조 키&lt;/code&gt; 에 &lt;code class=&quot;language-text&quot;&gt;Command(⌘)&lt;/code&gt;가 매핑되어 있었다.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 484px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/b28f5b5a4971fa7438807e660a95741a/6ad3c/image.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 74.11764705882352%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+ElEQVR42o2T6VIaURBG510iss0KyD6ssm8mKoIISZXJ+z/ClzltTcpSsPLjq54L93af3pww8BT4rgr5rJaLuU6no3rd2M5uMa9iIfdfSu86vldMHueUy2Z0UymrE7cTW7Iz4pLnFr4UzriLdaLQ13QySTTWYj5PNNNsOjXazWatVrORXCzI99yz8tyiojDQ97s7lUuRnEo50sP9vdarpcajW03GIzXqddWqN6rXqipFoT265BAFvmeBw8CXw4Nut6O43ZbvusrnslYCxHexkP/SWUqZy16bdWhIu9VUs1FXNaEiUqNes3PcbhllSniJFLJuJ34jJO9fP0/a73baPW213+/0cnjW0/ZRh+e9We6QCZZH52q4Wa/sjjWl3+smo9KxKFBBl5IiMoAUWymXPpFyzlx9e0vZcBNng0Ffo9uhOcQOBwOzdJ9mzWczC/ix4ykh02GEaf7MXyeOjfQ9LaTQ8Q0tHcVBKt5jCVqKAgbb1aDfswjDhHKVjA9kOOUxXYYKi+g+JWK8cEJ56HBaZyNkZKBg9hCOPorAbBLE3MHRarmwZmApiQ02mGzEKIlG3c7VCYf8xn+b9doyYt9Px6P+/H7V8eWQLMcPa9i/XUZpepcGmP8YdizN4Ps6c2Vrun18EFtnDsMg+JTepRV7L8qFJTvSpoZ/Ae1g5wJ+1W+RAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;스크롤 제스처를 위한 보조 키에 Command(⌘)가 설정되어 있다.&apos; title=&apos;&apos; src=&apos;/static/b28f5b5a4971fa7438807e660a95741a/6ad3c/image.png&apos; srcset=&apos;/static/b28f5b5a4971fa7438807e660a95741a/e7570/image.png 170w,
/static/b28f5b5a4971fa7438807e660a95741a/f46e7/image.png 340w,
/static/b28f5b5a4971fa7438807e660a95741a/6ad3c/image.png 484w&apos; sizes=&apos;(max-width: 484px) 100vw, 484px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;스크롤 제스처를 위한 보조 키에 Command(⌘)가 설정되어 있다.&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;이러한 경우 &lt;code class=&quot;language-text&quot;&gt;스크롤 제스처를 위한 보조 키&lt;/code&gt; 옵션을 다른 키로 설정하여 주고, IntelliJ의 &lt;code class=&quot;language-text&quot;&gt;IntelliJ IDEA -&gt; Settings -&gt; Editor -&gt; General -&gt; Change font size in Command + Mouse Wheel in&lt;/code&gt; 옵션이 켜져있으면 정상적으로 마우스 휠을 통해 Font Size 조절이 가능하다.&lt;/p&gt;
&lt;h3 id=&quot;2-Keymap&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-Keymap&quot; aria-label=&quot;2 Keymap permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;2. Keymap&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;스크롤 제스처를 위한 보조 키&lt;/code&gt; 옵션을 변경하지 않고 해결하는 방법은 바로 IntelliJ의 &lt;code class=&quot;language-text&quot;&gt;Keymap&lt;/code&gt;을 활용하는 것이다. &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;IntelliJ IDEA&lt;/code&gt; -&gt; &lt;code class=&quot;language-text&quot;&gt;Settings&lt;/code&gt; -&gt; &lt;code class=&quot;language-text&quot;&gt;Keymap&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Increase Font Size&lt;/code&gt; 검색 &lt;br&gt;
a. &lt;code class=&quot;language-text&quot;&gt;Add ... Shortcut&lt;/code&gt; 선택 후 단축키 입력&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Decrease Font Size&lt;/code&gt; 검색 &lt;br&gt;
a. &lt;code class=&quot;language-text&quot;&gt;Add ... Shortcut&lt;/code&gt; 선택 후 단축키 입력&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/c1489db4075d67cec2be0f9a1c6d5fd4/06066/image-1.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 19.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA30lEQVR42k3QyU7DMBSF4bwKTatmcAZndqa2SROEEF0SISQkWPA4LFkgxIYH/XFIF1l8sn1kWdfHsESIo+0sVxP/63Zls3fIQkmvKoa6YWxahrKi1FkpI5TWxDEyjNnaHkbd31L0d8jqxI2IsIIEJ0xxgoXtpxSpom9PjN3AcDxzPnRUmaLKS0qtLSqiRLHRAxm5Pny+PPL9OvExXThkBaYrsT39+NVOSJ2FmE6w0Ps5W/OjlL0bYAjX52u65/f5ws/TA6NSuFGOrWsw9/O3xVKFveZd61nM997fOuom4Q9/q4Hj4Ta/ywAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;Keymap - Increase Font Size 검색 화면&apos; title=&apos;&apos; src=&apos;/static/c1489db4075d67cec2be0f9a1c6d5fd4/ca1dc/image-1.png&apos; srcset=&apos;/static/c1489db4075d67cec2be0f9a1c6d5fd4/e7570/image-1.png 170w,
/static/c1489db4075d67cec2be0f9a1c6d5fd4/f46e7/image-1.png 340w,
/static/c1489db4075d67cec2be0f9a1c6d5fd4/ca1dc/image-1.png 680w,
/static/c1489db4075d67cec2be0f9a1c6d5fd4/06066/image-1.png 729w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;Keymap - Increase Font Size 검색 화면&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;해당 설정은 &lt;code class=&quot;language-text&quot;&gt;스크롤 제스처를 위한 보조 키&lt;/code&gt; 옵션에 &lt;code class=&quot;language-text&quot;&gt;Command(⌘)&lt;/code&gt;가 설정되어 있고, 바꾸고 싶지 않을 때 사용할 수 있는 설정이다. 단축키 설정 시, &lt;code class=&quot;language-text&quot;&gt;Command(⌘)&lt;/code&gt;가 들어가지 않게 설정하여야 유효하게 사용할 수 있다.&lt;/p&gt;</content:encoded></item></channel></rss>